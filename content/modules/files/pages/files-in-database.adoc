= Хранение файлов в базе данных

// todo Explain how to upload/download files in REST when https://github.com/Haulmont/jmix-core/issues/200 is fixed

В этом разделе приводится пример загрузки и сохранения изображений в базу данных приложения, а также описывается, как можно отображать изображения на экранах UI.

CAUTION: Сохраняйте в базу данных только небольшие файлы: миниатюры, значки и т.д., так как при загрузке или скачивании в память помещается весь файл.

Во-первых, создайте атрибут типа байтового массива (`byte[]`) в сущности, например:

[source,java,indent=0]
----
include::example$/files-ex1/src/main/java/com/company/demo/entity/Person.java[tags=file]
----

При запуске приложения Studio генерирует скрипт миграции базы данных для создания соответствующего столбца подходящего базе типа. Например, для PostgreSQL это `bytea`.

Для загрузки файла из экрана UI используйте компонент xref:flow-ui:vc/components/fileUploadField.adoc[], привязанный к атрибуту сущности. Если файл является изображением, можно использовать компонент xref:flow-ui:vc/html-components/image.adoc[] для его отображения на экране. Например:

[source,xml,indent=0]
----
include::example$/files-ex1/src/main/resources/com/company/demo/view/person/person-detail-view.xml[tags=file]
----

<1> Компонент `fileUploadField` позволяет пользователям загружать файл и сохранять его в атрибуте сущности.
<2> Компонент `image` отображает содержимое атрибута сущности.

Для того, чтобы иметь возможность скачивать файл, добавьте кнопку и определите ее обработчик следующим образом:

[source,java,indent=0]
----
include::example$/files-ex1/src/main/java/com/company/demo/view/person/PersonDetailView.java[tags=file]
----

<1> Используйте бин xref:downloading-files.adoc#downloader[Downloader] для скачивания файлов.
<2> Определите имя скачанного файла.
<3> Если вы знаете формат файла, укажите его в последнем аргументе метода `download()`. В зависимости от формата веб-браузер будет либо скачивать файл, либо отображать его во вкладке.
