= Компонент PivotTable
:table-caption!:

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/pivot-table-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Элемент `pvttbl` представляет компонент `PivotTable` для пользовательского интерфейса. Компонент предоставляет функциональность перетаскивания, которая позволяет преобразовать набор данных в сводную таблицу и управлять ею с помощью 2D-интерфейса перетаскивания.

[cols="2h,8", grid=none]
|===
|XML-элемент
|`pvttbl`
|Java-класс
|`io.jmix.pivottableflowui.component.PivotTable`
|Атрибуты
|xref:flow-ui:vc/common-attributes.adoc#id[id] -
xref:flow-ui:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<autoSortUnusedProperties,autoSortUnusedProperties>> -
xref:flow-ui:vc/common-attributes.adoc#classNames[classNames] -
xref:flow-ui:vc/common-attributes.adoc#colspan[colspan] -
<<columnOrder,columnOrder>> -
xref:flow-ui:vc/common-attributes.adoc#css[css] -
xref:flow-ui:vc/common-attributes.adoc#dataContainer[dataContainer] -
<<emptyDataMessage,emptyDataMessage>> -
xref:flow-ui:vc/common-attributes.adoc#enabled[enabled] -
xref:flow-ui:vc/common-attributes.adoc#height[height] -
xref:flow-ui:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:flow-ui:vc/common-attributes.adoc#maxWidth[maxWidth] -
<<menuLimit,menuLimit>> -
xref:flow-ui:vc/common-attributes.adoc#minHeight[minHeight] -
xref:flow-ui:vc/common-attributes.adoc#minWidth[minWidth] -
<<renderer,renderer>> -
<<rowOrder,rowOrder>> -
<<showColumnTotals,showColumnTotals>> -
<<showRowTotals,showRowTotals>> -
<<showUI,showUI>> -
xref:flow-ui:vc/common-attributes.adoc#visible[visible] -
<<unusedPropertiesVertical,unusedPropertiesVertical>> -
xref:flow-ui:vc/common-attributes.adoc#width[width]
|Обработчики
|xref:flow-ui:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:flow-ui:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<PivotTableCellClickEvent,PivotTableCellClickEvent>> -
<<PivotTableRefreshEvent,PivotTableRefreshEvent>> -
|Элементы
|<<aggregation,aggregation>> -
<<aggregationProperties,aggregationProperties>> -
<<aggregations,aggregations>> -
<<columns,columns>> -
<<derivedProperties,derivedProperties>> -
<<exclusions,exclusions>> -
<<filterFunction,filterFunction>> -
<<hiddenFromAggregations,hiddenFromAggregations>> -
<<hiddenFromDragDrop,hiddenFromDragDrop>> -
<<hiddenProperties,hiddenProperties>> -
<<inclusions,inclusions>> -
<<properties,properties>> -
<<rendererOptions,rendererOptions>> -
<<renderers,renderers>> -
<<rows,rows>> -
<<sortersFunction,sortersFunction>> -
|===

[[basic]]
== Основы

Чтобы создать компонент, используйте XML-элемент `pivotTable` и свяжите его с xref:flow-ui:data/data-containers.adoc[контейнером данных]. Для этого можно использовать Jmix Studio.

image::create-pivottable-component.png[align="center", width="664"]

Новый элемент `pivotTable` будет добавлен как в панель структуры *Jmix UI*, так и в XML. Вы можете настроить атрибуты, такие как xref:flow-ui:vc/common-attributes.adoc#id[id], xref:flow-ui:vc/common-attributes.adoc#height[height], xref:flow-ui:vc/common-attributes.adoc#width[width], и так далее, так же, как это делается для других xref:flow-ui:vc/components.adoc[компонентов UI].

[source,xml,indent=0]
----
<pvttbl:pivotTable id="pivotTable"
                  height="100%"
                  width="100%"/>
----

Если вы не используете дизайнер экранов, объявите пространство имен `pvttbl` в XML-дескрипторе вашего экрана вручную:

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/pivottable/pivottable-view.xml[tags=xmlns]
----

[[collection-container-example]]
Для настройки компонента необходимо предоставить контейнер данных и указать свойства, которые мы хотим отобразить в таблице. Вот как определить данные для компонента:

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/pivottable/pivottable-view.xml[tags=data]
----

В следующем примере показано, как настроить базовый `pivotTable`:

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/pivottable/pivottable-view.xml[tags=simple]
----

image::pivot-table-basics.png[align="center", width="748"]

[CAUTION]
====
Компонент `pivotTable` построен с использованием библиотеки JavaScript https://jquery.com/[jQuery^]. Если вы интегрируете какие-либо компоненты, которые также полагаются на `jQuery`, могут возникнуть потенциальные конфликты между разными версиями библиотеки. Чтобы предотвратить эти конфликты, используйте подход https://api.jquery.com/jQuery.noConflict/#jQuery-noConflict-removeAll[jQuery.noConflict()^].

https://demo.jmix.ru/ui-samples/sample/custom-component-js-library[Пример^] использования `jQuery.noConflict()` можно найти в UI Samples.
====

[[data-binding]]
== Привязка данных

[[collection-container]]
=== Контейнер коллекции

Обычно вы связываете `pivotTable` с данными декларативно в XML-дескрипторе с помощью атрибута `dataContainer`. Этот атрибут должен ссылаться на xref:flow-ui:data/collection-container.adoc[контейнер коллекции], который содержит данные, которые вы хотите отобразить. Смотрите соответствующий <<collection-container-example,пример>> в предыдущем разделе.

[[custom-data-model]]
=== Использование пользовательской модели данных

Вы также можете определить пользовательскую модель данных и использовать ее в компоненте `PivotTable`. Вот как это сделать:

. *Создайте простой POJO*:
+
Начните с создания простого объекта Java (POJO) для представления вашей структуры данных. Этот POJO будет служить основой для вашей пользовательской модели данных.
+
.Показать код
[%collapsible]
====
[source,java,indent=0]
----
include::../examples/pivottable-ex1/src/main/java/com/company/ex1/model/Shape.java[tags=shape]
----
====

. *Реализуйте JmixPivotTableItems*:
+
Затем реализуйте интерфейс `JmixPivotTableItems`. Этот интерфейс имеет решающее значение для предоставления компоненту `PivotTable` необходимой информации о вашей пользовательской модели данных.
+
Создайте класс, реализующий интерфейс `JmixPivotTableItems`. Для демонстрации будут реализованы только основные методы. Например:
+
.Показать код
[%collapsible]
====
[source,java,indent=0]
----
include::../examples/pivottable-ex1/src/main/java/com/company/ex1/model/ShapeListPivotTableItems.java[tags=shape-list]
----
====

. *Настройте PivotTable в дескрипторе*:
+
В XML-дескрипторе экрана настройте компонент `pivotTable` для использования вашей пользовательской модели данных. Например:
+
.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/pivottablecustomdatabinding/pivot-table-custom-data-binding-view.xml[tags=pivot-table]
----
====

. *Создайте элементы и установите в компонент*:
+
Наконец, создайте экземпляры ваших пользовательских объектов данных и установите их в компонент `PivotTable`.
+
.Показать код
[%collapsible]
====
[source,java,indent=0]
----
include::../examples/pivottable-ex1/src/main/java/com/company/ex1/view/pivottablecustomdatabinding/PivotTableCustomDataBindingView.java[tags=create-items]
----
====

[[ui-mode]]
== Режим UI

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/pivot-table-ui" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

[[showUI-attr]]
Атрибут `showUI` позволяет отображать сводную таблицу в режиме UI.

Когда сводная таблица находится в режиме UI, пользователи могут видеть элементы для манипулирования данными.

image::pivot-table-ui-mode.png[align="center", width="1157"]

. *Селектор рендеринга (Renderer Selector)* - определяет, как данные отображаются в сводной таблице.
. *Неиспользуемые свойства (Unused Properties)*. Перетащите эти свойства в область столбца или строки и обратно. По мере изменения структуры таблицы (путем перетаскивания свойств) данные автоматически пересчитываются и обновляются, чтобы отразить новое расположение.
. *Свойства столбца (Column Properties)*. Перетащите свойства в эту область, чтобы использовать их в качестве столбцов.
. *Фильтры (Filters)*. Используйте фильтры, чтобы сосредоточиться на определенных подмножествах данных. Синяя стрелка открывает диалог, который показывает все значения для этого свойства. Вы можете снять флажки с значений, чтобы исключить их из расчетов таблицы.
. *Свойства строки (Row Properties)*. Перетащите свойства в эту область, чтобы использовать их в качестве строк.
. *Свойства агрегации (Aggregation Properties)* - свойства, используемые в агрегации.
. *Селектор агрегации (Aggregation Selector)* - выберите операцию агрегации данных, такую как подсчет, минимум, максимум и т.д.
. *Сортировка* в таблице: по строкам и по столбцам.

[[autoSortUnusedProperties-attr]]
Атрибут `autoSortUnusedProperties` управляет тем, сортируются ли неиспользуемые свойства автоматически в заданном порядке. Этот атрибут применим, если `showUI` установлен в значение `true`.

Когда атрибут установлен в значение `true`, неиспользуемые свойства, отображаемые в панели для перетаскивания в сводную таблицу, будут автоматически отсортированы. Это помогает пользователям быстро находить нужные свойства.

image::auto-sort-unused-properties.png[align="center", width="646"]

[[unusedPropertiesVertical-attr]]

Атрибут `unusedPropertiesVertical` управляет выравниванием неиспользуемых свойств.

Когда `unusedPropertiesVertical` установлен в значение `true`, область неиспользуемых атрибутов всегда отображается вертикально.

Когда `unusedPropertiesVertical` установлен в значение `false`, область неиспользуемых атрибутов всегда отображается горизонтально.

Если установлен в число (как по умолчанию), неиспользуемые атрибуты отображаются вертикально, если суммарная длина их имен в символах превышает указанное число. В противном случае они отображаются горизонтально.

[[menuLimit-attr]]

Атрибут `menuLimit` управляет количеством элементов, отображаемых в раскрывающихся меню для выбора строк и столбцов в сводной таблице. Это помогает управлять размером и удобством использования меню, особенно при работе с большим количеством уникальных значений.

[[using-renderers]]
== Использование рендереров

Без рендерера сводная таблица использует базовое форматирование, обычно показывая числа или текст. Рендерер определяет, как данные отображаются в ячейках сводной таблицы. Дополнение предоставляет следующие предопределенные рендереры:

* `TABLE`: Это рендерер по умолчанию, отображающий данные вашей сводной таблицы в стандартном формате таблицы.
* `TABLE_BAR_CHART`: Этот рендерер сочетает в себе представление таблицы с гистограммой, предоставляя более интерактивный и визуальный способ представления данных.
* `HEATMAP`: Этот рендерер создает тепловую карту, где значения представлены цветами. Он отлично подходит для быстрого определения шаблонов, тенденций или областей с высокими или низкими значениями в ваших данных.
* `COL_HEATMAP`: Этот рендерер отображает тепловую карту, но цветовая схема тепловой карты применяется по столбцам, показывая взаимосвязь значений в каждом столбце. Полезно для выделения трендов или выбросов в столбцах.
* `ROW_HEATMAP`: Аналогично `COL_HEATMAP`, этот рендерер отображает тепловую карту, но цветовая схема применяется по строкам, подчеркивая взаимосвязи в строках.
* `LINE_CHART`: Этот рендерер отображает линейный график, соединяя точки данных линиями. Он отлично подходит для демонстрации тенденций во времени или в непрерывных диапазонах данных.
* `BAR_CHART`: Этот рендерер создает стандартную гистограмму, идеально подходящую для сравнения значений по разным категориям или группам. Высота каждой полосы представляет значение, которое она представляет.
* `STACKED_BAR_CHART`: Этот рендерер создает составную гистограмму, показывая разбивку значений в каждой категории, с полосами, расположенными друг над другом.
* `HORIZONTAL_BAR_CHART`: Этот рендерер создает гистограмму с полосами, ориентированными горизонтально, а не вертикально. Это может быть полезно для повышения удобочитаемости или размещения большего количества меток в ограниченном пространстве.
* `HORIZONTAL_STACKED_BAR_CHART`: Этот рендерер создает составную гистограмму с полосами, ориентированными горизонтально. Он показывает разбивку значений в каждой категории, где полосы расположены друг над другом.
* `AREA_CHART`: Этот рендерер отображает ваши данные в виде облачной диаграммы, показывая тенденции во времени или по категориям. Он полезен для визуализации накопленных значений или для подчеркивания общего роста или спада.
* `SCATTER_CHART`: Этот рендерер создает точечную диаграмму, где каждая точка данных представлена точкой. Полезно для демонстрации связи между двумя переменными и определения потенциальных корреляций.
* `TREEMAP`: Этот рендерер создает древовидную диаграмму, где данные представлены прямоугольниками, причем размер каждого прямоугольника пропорционален представленному им значению. Эффективно для демонстрации иерархических данных или пропорций.
* `TSV_EXPORT`: Это не рендерер визуализации, а функциональный рендерер. Он позволяет пользователям экспортировать данные из сводной таблицы в формате с разделителями-табуляциями (TSV), который легко импортируется в другие табличные программы.

Когда сводная таблица находится в <<ui-mode,режиме UI>>, вы можете определить набор рендереров, которые будут отображаться в выпадающем меню доступных рендереров в пользовательском интерфейсе. Это делается с помощью элемента `renderers`, который содержит вложенные элементы `renderer`.

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/pivottablerenderer/pivot-table-renderer-view.xml[tags=renderers]
----

[[renderer-attr]]
Если сводная таблица не находится в <<ui-mode,режиме UI>>, вы можете декларативно указать рендерер для отображения данных в таблице с помощью атрибута `renderer`.

[[columnOrder-attr]]
Атрибут `columnOrder` устанавливает порядок, в котором данные столбца предоставляются рендереру. Сортировка по значению сортирует по общему итогу столбца.

Атрибут `rowOrder` устанавливает порядок, в котором данные строки предоставляются рендереру. Сортировка по значению сортирует по общему итогу строки.

Доступные значения:

* `KEYS_ASCENDING`("key_a_to_z"): Это значение сортировки указывает, что вы хотите отсортировать строки или столбцы в алфавитном порядке по возрастанию (от А до Я) на основе ключей, используемых в сводной таблице.
* `VALUES_ASCENDING`("value_a_to_z"): Это значение сортировки предписывает `PivotTable` сортировать строки или столбцы в алфавитном порядке по возрастанию (от А до Я) на основе значений, агрегированных в каждой строке или столбце. Эти значения являются результатами вычислений или агрегаций (например, сумма, среднее, количество), примененных к вашим данным.
* `VALUES_DESCENDING`("value_z_to_a"): Это значение сортировки сортирует строки или столбцы в алфавитном порядке по убыванию (от Я до А) на основе агрегированных значений в каждой строке или столбце.

[[data-aggregation]]
== Агрегация данных

Используя специальные элементы и атрибуты, компонент сводной таблицы позволяет определить, как данные агрегируются в каждой ячейке. Эта функциональность объединяет и суммирует значения, создавая основу для глубокого анализа.

Дополнение PivotTable предоставляет следующие предопределенные функции агрегации:

* `COUNT`: Эта функция подсчитывает количество непустых значений в ячейке.
* `COUNT_UNIQUE_VALUES`: Эта функция подсчитывает количество различных (уникальных) значений в ячейке.
* `LIST_UNIQUE_VALUES`: Эта функция возвращает список уникальных значений в ячейке.
* `SUM`: Эта функция вычисляет сумму всех значений в ячейке.
* `INTEGER_SUM`: Эта функция вычисляет сумму всех значений в ячейке, предполагая, что они являются целыми числами.
* `AVERAGE`: Эта функция вычисляет среднее значение всех значений в ячейке.
* `MINIMUM`: Эта функция находит минимальное значение в ячейке.
* `MAXIMUM`: Эта функция находит максимальное значение в ячейке.
* `SUM_OVER_SUM`: Эта функция вычисляет сумму значений в ячейке, деленную на сумму значений в указанном втором столбце.
* `UPPER_BOUND_80`: Эта функция вычисляет 80-й процентиль значений в ячейке. Она помогает определить верхнюю границу распределения.
* `LOWER_BOUND_80`: Эта функция вычисляет 20-й процентиль значений в ячейке. Она помогает определить нижнюю границу распределения.
* `SUM_AS_FRACTION_OF_TOTAL`: Эта функция вычисляет сумму значений в ячейке как процент от общей суммы значений во всей таблице.
* `SUM_AS_FRACTION_OF_ROWS`: Эта функция вычисляет сумму значений в ячейке как процент от общей суммы значений в той же строке.
* `SUM_AS_FRACTION_OF_COLUMNS`: Эта функция вычисляет сумму значений в ячейке как процент от общей суммы значений в том же столбце.
* `COUNT_AS_FRACTION_OF_TOTAL`: Эта функция вычисляет количество значений в ячейке как процент от общего количества значений во всей таблице.
* `COUNT_AS_FRACTION_OF_ROWS`: Эта функция вычисляет количество значений в ячейке как процент от общего количества значений в той же строке.
* `COUNT_AS_FRACTION_OF_COLUMNS`: Эта функция вычисляет количество значений в ячейке как процент от общего количества значений в том же столбце.

Когда сводная таблица находится в <<ui-mode,UI режиме>>, вы можете определить набор функций агрегации, которые будут отображаться в выпадающем меню доступных агрегаторов в интерфейсе пользователя. Это делается с помощью элемента <<aggregations,aggregations>>, который содержит внутренние элементы агрегации.

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/pivottableaggregator/pivot-table-aggregator-view.xml[tags=pivotTable;aggregations]
----

[[aggregationProperties-element]]
Вы также можете установить функцию агрегации по умолчанию, а также атрибуты, используемые в этой функции агрегации.

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/withdefaultaggregation/with-default-aggregation-view.xml[tags=pivotTable;aggregations-default;aggregationProperties]
----
<1> Атрибут <<aggregations-selected,selected>> устанавливает функцию агрегации по умолчанию - `SUM` - в выпадающем списке.
<2> Элемент <<aggregationProperties,aggregationProperties>> и его вложенный элемент `property` используются для установки атрибута `size` для использования в функции агрегации.

image::pivot-table-aggregation-defaults.png[align="center", width="275"]

[[hiddenFromAggregations-element]]
Используя <<hiddenFromAggregations,hiddenFromAggregations>>, вы можете настроить сводную таблицу, чтобы исключить некоторые атрибуты из агрегации:

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/withdefaultaggregation/with-default-aggregation-view.xml[tags=pivotTable;pivotTable2;hiddenFromAggregations]
----

[[aggregation-element-example]]
Если сводная таблица не находится в <<ui-mode,UI режиме>>, вы можете декларативно указать функцию агрегации для отображения данных в таблице с помощью элемента <<aggregation,aggregation>>.

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/withaggregation/with-aggregation-view.xml[tags=pivotTable]
----

// == Filtering Options
//
// == Sorting Options
//
// == Derived Attributes

== Атрибуты

В Jmix есть множество xref:flow-ui:vc/common-attributes.adoc[общих атрибутов], которые выполняют одну и ту же функцию для всех компонентов.

Ниже приведены атрибуты, специфичные для `pivotTable`:

[cols="1h,5,1", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[autoSortUnusedProperties]]autoSortUnusedProperties
|Устанавливает, сохраняются ли неиспользуемые атрибуты отсортированными в пользовательском интерфейсе. Этот атрибут применим, если `showUI` установлен в `true`. Смотрите <<autoSortUnusedProperties-attr, UI режим>>.
|`false`
|[[columnOrder]]columnOrder
|Устанавливает порядок, в котором данные столбца предоставляются рендереру. Сортировка по значению сортирует по общему значению столбца. Смотрите доступные значения в разделе <<columnOrder-attr,Использование рендереров>>. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|`KEYS_ASCENDING`
|[[emptyDataMessage]]emptyDataMessage
|Атрибут `emptyDataMessage` используется для отображения сообщения пользователю, когда сводная таблица не содержит данных для отображения.
|
|[[menuLimit]]menuLimit
|Устанавливает максимальное количество значений для отображения в диалоговом окне значений атрибутов. Этот атрибут применим, если `showUI` установлен в `true`. Смотрите <<menuLimit-attr,Режим UI>>.
|`50`
|[[renderer]]renderer
|Атрибут `renderer` позволяет установить один из предопределенных <<renderer-attr,рендереров>> данных.
|`TABLE`
|[[rowOrder]]rowOrder
|Устанавливает порядок, в котором данные строки предоставляются рендереру. Сортировка по значению сортирует по общему значению строки. Смотрите доступные значения в разделе <<columnOrder-attr,Использование рендереров>>. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|`KEYS_ASCENDING`
|[[showUI]]showUI
|Если атрибут `showUI` установлен в `true`, отображается пользовательский интерфейс сводной таблицы. Смотрите <<showUI-attr,Режим UI>>.
|`false`
|[[showColumnTotals]]showColumnTotals
|Атрибут `showColumnTotals` управляет отображением итогов для каждого столбца в компоненте сводной таблицы. Когда `showColumnTotals` установлен в `true`, сводная таблица будет отображать строку внизу таблицы, которая суммирует данные для каждого столбца. Эта строка, как правило, будет отображать суммарное значение (например, сумму, среднее) каждого столбца. Атрибут `showColumnTotals` работает только для табличных рендереров (`Table`, `Table barchart`, `Heatmap`, `Row heatmap`, `Col heatmap`). Смотрите https://demo.jmix.ru/ui-samples/sample/pivot-table-ui-properties[демонстрацию^].
|`true`
|[[showRowTotals]]showRowTotals
|Атрибут `showRowTotals` управляет отображением итогов для каждой строки в компоненте сводной таблицы. Когда `showRowTotals` установлен в `true`, сводная таблица будет отображать столбец в конце таблицы, который суммирует данные для каждой строки. Этот столбец, как правило, будет отображать суммарное значение (например, сумму, среднее) каждой строки. Атрибут `showRowTotals` работает только для табличных рендереров (`Table`, `Table barchart`, `Heatmap`, `Row heatmap`, `Col heatmap`). Смотрите https://demo.jmix.ru/ui-samples/sample/pivot-table-ui-properties[демонстрацию^].
|`true`
|[[unusedPropertiesVertical]]unusedPropertiesVertical
|Управляет ориентацией области неиспользуемых атрибутов в сводной таблице. Этот атрибут применим, если `showUI` установлен в `true`. Смотрите <<unusedPropertiesVertical-attr, UI режим>>.
|Горизонтальное выравнивание (`85`)
|===

== Обработчики

В Jmix существует множество xref:flow-ui:vc/common-handlers.adoc[общих обработчиков], которые конфигурируются одинаково для всех компонентов.

Ниже приведены обработчики, специфичные для `pivotTable`.

include::../../flow-ui/pages/vc/handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|[[PivotTableCellClickEvent]]PivotTableCellClickEvent
|Событие `io.jmix.pivottableflowui.kit.event.PivotTableCellClickEvent` срабатывает, когда пользователь кликает по ячейке в сводной таблице. Соответствует событию DOM `jmix-pivottable:cellclick`.

Событие `PivotTableCellClickEvent` срабатывает только для табличных <<using-renderers,рендереров>> (`TABLE`, `HEATMAP`, `TABLE_BAR_CHART`, `COL_HEATMAP`, `ROW_HEATMAP`).

Смотрите https://demo.jmix.ru/ui-samples/sample/pivot-table-events[демонстрацию^].
|[[PivotTableRefreshEvent]]PivotTableRefreshEvent
|Событие `io.jmix.pivottableflowui.kit.event.PivotTableRefreshEvent` срабатывает всякий раз, когда данные сводной таблицы обновляются или пересчитываются. Это событие сигнализирует о том, что содержимое сводной таблицы изменилось и предоставляет возможность реагировать на эти обновления. Соответствует событию DOM `jmix-pivottable:refresh`.

Событие `PivotTableRefreshEvent` срабатывает только для сводной таблицы в <<ui-mode,режиме UI>>.

Из события `PivotTableRefreshEvent` доступны следующие значения: <<aggregation,aggregation>>, <<aggregationProperties,aggregationProperties>>, <<columns,columns>>, <<columnOrder,columnOrder>>, <<exclusions,exclusions>>, <<inclusions,inclusions>>, <<renderer,renderer>>, <<rowOrder,rowOrder>>, <<rows,rows>>.

Смотрите https://demo.jmix.ru/ui-samples/sample/pivot-table-events[демонстрацию^].
|===

== Элементы

Элементы `pivotTable` предоставляют широкий спектр возможностей для управления внешним видом, поведением и функциональностью столбцов и строк как в целом, так и по отдельности.

[TIP]
====
Чтобы добавить элемент к выбранному компоненту, нажмите кнопку xref:studio:view-designer.adoc#add-column[Add] в панели инспектора *Jmix UI*.
====

[[aggregation]]
=== aggregation

Элемент `aggregation` устанавливает функцию, которая будет агрегировать результаты для каждой ячейки. Этот элемент применим, если <<showUI,showUI>> установлен в `false`. Смотрите раздел <<aggregation-element-example,Агрегация данных>>.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`aggregation`
|Атрибуты
|<<caption,caption>> - <<custom,custom>> - <<mode,mode>>
|Элементы
|<<function,function>> - <<property,property>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[caption]]caption
|Этот атрибут предоставляет локализованное значение для отображения в пользовательском интерфейсе.
|–
|[[custom]]custom
|Установка этого атрибута в `true` переопределяет атрибут `mode` с помощью JavaScript-кода из вложенного элемента `function`.
|–
|[[mode]]mode
|Включает настройку одной из предопределенных функций агрегации.
|`count`
|===

[[function]]
==== function

Элемент `function` содержит JavaScript-код функции агрегации.

[[property]]
==== property

Указывает имя атрибута, который будет использоваться в качестве входного параметра для выбранной функции агрегации.

[[aggregationProperties]]
=== aggregationProperties

Устанавливает имена атрибутов для предварительного заполнения в выпадающем списке свойств агрегации. Смотрите раздел <<aggregationProperties-element,Агрегация данных>>.

Этот элемент применим для сводных таблиц в <<ui-mode,режиме UI>>.

Состояние этого элемента может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].

[[aggregations]]
=== aggregations

Элемент `aggregations` определяет набор функций агрегации, которые должны отображаться в выпадающем списке доступных агрегаторов в пользовательском интерфейсе. Этот элемент применим, если <<showUI,showUI>> установлен в `true`. Смотрите раздел <<data-aggregation,Агрегация данных>>.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`aggregations`
|Атрибуты
|<<aggregations-selected,selected>>
|Элементы
|<<aggregation-element,aggregation>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[aggregations-selected]]selected
|Атрибут `selected` позволяет выбрать одну из предопределенных <<data-aggregation,функций агрегации>>. Выбранная функция будет использоваться по умолчанию при загрузке компонента. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|–
|===

[[aggregation-element]]
==== aggregation

Этот элемент позволяет вам указать одну из предопределенных функций агрегации с помощью атрибута `mode`. Смотрите раздел <<data-aggregation, Агрегация данных>>.

[[columns]]
=== columns

Список атрибутов, которые будут использоваться в качестве столбцов таблицы. Значение может быть либо ключом <<properties,свойств>>, либо именем сгенерированного атрибута.

Состояние этого элемента может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].

[[derivedProperties]]
=== derivedProperties

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/pivot-table-derived-properties" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Элемент `derivedProperties` позволяет добавить новые атрибуты в исходный контейнер данных, производные от существующих. Этот элемент представляет собой карту ключ-значение, где ключ - это имя сгенерированного атрибута, а значение - это JavaScript-функция, которая генерирует этот атрибут.

* Вложенные элементы `derivedProperty` должны иметь определенный атрибут `caption`, так как значение `caption` будет использоваться в качестве ключа.
* Элемент `function` используется в качестве значения для `derivedProperty`.

[source,xml,indent=0]
----
include::../examples/pivottable-ex1/src/main/resources/com/company/ex1/view/derivedproperty/derived-property-view.xml[tags=simple]
----

[[exclusions]]
=== exclusions

Элемент `exclusions` представляет собой карту ключ-значение, где ключ - это имя атрибута (либо ключ <<properties,свойств>>, либо имя сгенерированного атрибута), а значение - это список значений атрибутов, которые должны быть исключены из рендеринга.

Этот элемент применим для сводных таблиц в <<ui-mode,режиме UI>>.

Состояние этого элемента может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].

[[filterFunction]]
=== filterFunction

Элемент `filterFunction` представляет собой JavaScript-функцию, которая вызывается для каждой записи. Она возвращает `false`, если запись должна быть исключена из входных данных перед рендерингом, или `true` в противном случае.

[[hiddenFromAggregations]]
=== hiddenFromAggregations

Элемент `hiddenFromAggregations` используется для указания, какие атрибуты должны быть исключены из <<aggregations,агрегации>>. Список атрибутов определяется с помощью вложенного элемента `property`. Смотрите раздел <<hiddenFromAggregations-element, Агрегация данных>>.

Этот элемент применим для сводных таблиц в <<ui-mode,режиме UI>>.

[[hiddenFromDragDrop]]
=== hiddenFromDragDrop

Элемент `hiddenFromDragDrop` управляет тем, какие атрибуты исключаются из функциональности перетаскивания в <<ui-mode,пользовательском интерфейсе>> сводной таблицы.

[[hiddenProperties]]
=== hiddenProperties

Этот элемент определяет список атрибутов, которые не должны отображаться в пользовательском интерфейсе. Его значение может быть либо ключом свойств, либо именем сгенерированного атрибута, например, ключом из элемента <<derivedProperties,derivedProperties>>.

Этот элемент применим, когда <<showUI,showUI>> установлен в `true`.

[[inclusions]]
=== inclusions

Элемент `inclusions` представляет собой карту ключ-значение, где ключ - это имя атрибута (либо ключ <<properties,свойств>>, либо имя сгенерированного атрибута), а значение - это список значений атрибутов, которые должны быть отображены.

Этот элемент применим, когда <<showUI,showUI>> установлен в `true`.

Состояние этого элемента может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].

[[properties]]
=== properties

Элемент `properties` представляет собой карту ключ-значение, содержащую свойства, которые будут использоваться в сводной таблице. Ключ - это имя атрибута из xref:flow-ui:data/data-containers.adoc[контейнера данных], а значение - это его локализованный заголовок.

Если сводная таблица находится в <<ui-mode,режиме UI>>, атрибуты, указанные в элементе `properties`, используются для формирования *Свойств столбца (Column Properties)* и *Свойств строки (Row Properties)*.

[[rendererOptions]]
=== rendererOptions

Элемент `rendererOptions` предоставляет способ настройки специфических параметров выбранного рендерера. Только два типа рендереров могут быть настроены:

The `rendererOptions` element provides a way to customize the specific settings of the selected renderer. Only two renderer types can be customized:

* Все типы тепловых карт (`heatmap`). Цвета ячеек могут быть установлены с помощью JavaScript-кода.
+
Элемент `colorScaleGeneratorFunction` используется для установки функции, которая используется в генераторе цветовой шкалы для рендерера тепловой карты.

* Все типы диаграмм (`chart`). Опции могут быть использованы для установки размера диаграммы.

[[renderers]]
=== renderers


Элемент `renderers` управляет выпадающим меню функций рендеринга, представленных пользователям в пользовательском интерфейсе. Этот элемент применим, если <<showUI,showUI>> установлен в `true`. Смотрите раздел <<using-renderers,Использование рендереров>>.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`renderers`
|Атрибуты
|<<selected,selected>>
|Элементы
|<<renderer-element,renderer>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[selected]]selected
|Атрибут `selected` позволяет выбрать один из предопределенных <<using-renderers,рендереров>>. Выбранный рендерер будет использоваться по умолчанию при загрузке компонента. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|–
|===

[[renderer-element]]
==== renderer

Этот элемент позволяет указать один из предопределенных рендереров с помощью его атрибута `type`. Смотрите раздел <<using-renderers,Использование рендереров>>.

[[rows]]
=== rows

Список атрибутов, которые будут использоваться в качестве строк таблицы. Значение может быть либо ключом <<properties,свойств>>, либо именем сгенерированного атрибута.

Состояние этого элемента может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].

[[sortersFunction]]
=== sortersFunction

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/pivot-table-sorter-function" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

JavaScript-функция, которая вызывается с именем атрибута и может вернуть функцию, которая может быть использована в качестве аргумента для метода `Array.sort` для целей вывода. Если функция не возвращается, используется стандартный механизм сортировки - встроенная реализация "естественной сортировки". Это полезно для сортировки атрибутов, например, названий месяцев.

== Смотрите также

Смотрите https://github.com/nicolaskruchten/pivottable/wiki/UI-Tutorial[документацию PivotTable^] для получения дополнительной информации.