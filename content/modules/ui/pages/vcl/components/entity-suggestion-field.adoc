= EntitySuggestionField

++++
<div class="backoffice-ui-live-demo-container">
    <a href="https://demo.jmix.io/sampler/#main/sample?id=entitysuggestionfield-dataaware" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Компонент `EntitySuggestionField` предназначен для поиска экземпляров сущности по строке, вводимой пользователем. Он выполняет действия при нажатии пользователем на кнопку справа.

`EntitySuggestionField` – это поле ввода с дополнительной функциональностью: пользователь вводит несколько символов, и если найдено несколько совпадений, в выпадающем списке будут отображен каждый из них. `EntitySuggestionField` обновляет список опций при каждом вводе символа.

Список опций загружается асинхронно в соответствии с логикой, задаваемой разработчиком на стороне сервера.

`EntitySuggestionField` является по сути гибридом xref:vcl/components/suggestion-field.adoc[SuggestionField] и xref:vcl/components/entity-picker.adoc[EntityPicker].

XML-имя компонента: `entitySuggestionField`.

== Основы

Используйте `EntitySuggestionField`, если:

* Пользователям нужно выбрать один экземпляр xref:data-model:entities.adoc[сущности].
* Список опций в списке предлагаемых значений слишком длинный для использования  xref:vcl/components/entity-combo-box.adoc[EntityComboBox].
* Вы хотите обеспечить высокую производительность при поиске по базе данных без загрузки большого количества данных на уровень UI.

image::vcl/components/entity-suggestion-field.gif[align="center"]

Для создания `EntitySuggestionField`, связанного с данными, используйте атрибуты xref:vcl/xml.adoc#data-container[dataContainer] и xref:vcl/xml.adoc#property[property] и элемент <<query,query>>:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitysuggestionfield/entitysuggestionfield-screen.xml[tags=data-start;instance;data-end;layout-start;basic;layout-end]
----
<1> `InstanceContainer` для сущности `Address`.
<2> Встроенный фетч-план экземпляра сущности, расположенного в контейнере.

В приведенном выше примере экран определяет контейнер данных `addressDc` для сущности `Address`, имеющей атрибут `country`. В элементе `entitySuggestionField` атрибут `dataContainer` содержит ссылку на контейнер данных `addressDc`, а атрибут `property` ссылается на атрибут сущности `country`. Этот атрибут должен быть ссылкой на сущность. В данном примере это `Country`.

[[options]]
== Определение опций

Список опций можно определить либо в XML-дескрипторе с помощью вложенного элемента `query`, либо программно в контроллере с помощью интерфейса `SearchExecutor`.

[[query]]
=== query

`query` – необязательный элемент, позволяющий задать запрос для выбора предлагаемых значений.

Элемент `query` имеет следующие атрибуты:

[[entityClass]]
* `entityClass` (обязательный) - полное квалифицированное имя класса сущности.

[[fetch-plan]]
* `fetchPlan` - дополнительный атрибут, задающий фетч-план, с которым будет загружена сущность.

[[escape-value-for-like]]
* `escapeValueForLike` - позволяет разрешить поиск по значениям, содержащим специальные символы: `%`, `\`, и т.д. По умолчанию `false`.

[[search-string-format]]
* `searchStringFormat` - строка Groovy, что позволяет использовать в запросе валидные Groovy-выражения.

[[search-executor]]
=== SearchExecutor

Если `query` не определен, необходимо задать список опций программно с помощью `SearchExecutor`.

`SearchExecutor` – это функциональный интерфейс, содержащий один метод: `List<E> search(String searchString, Map<String, Object> searchParams)`.

Используйте параметр `searchString` для фильтрации кандидатов по строке, введенной пользователем. Use the `searchString` parameter to filter candidates using the string entered by the user.

Сначала объявите компонент в XML-дескрипторе:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitysuggestionfield/entitysuggestionfield-screen.xml[tags=entity-field]
----

Затем задайте `SearchExecutor` для компонента:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/entitysuggestionfield/EntitySuggestionFieldScreen.java[tags=autowired-data-manager;search-executor]
----

[TIP]
====
Заглушку реализации `SearchExecutor` можно генерировать с помощью Studio.
====

[WARNING]
====
Метод `search()` выполняется в фоновом потоке, поэтому он не может обращаться к визуальным компонентам и компонентам данных. Можно использовать xref:data-access:data-manager.adoc[DataManager], другие бины, или обрабатывать и возвращать данные, предварительно загруженные в экран.
====

Метод `escapeForLike()` можно использовать для поиска значений, содержащих некоторые специальные символы:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/suggestionfield/SuggestionFieldScreen.java[tags=autowired-data-manager;escape-for-like]
----

[[meta-class]]
== metaClass

Компонент `EntitySuggestionField` можно использовать без непосредственной привязки к данным, то есть без указания `dataContainer` и `property`. В этом случае для указания типа сущности, с которой должен работать `EntitySuggestionField`, используется атрибут `metaClass`.

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitysuggestionfield/entitysuggestionfield-screen.xml[tags=meta-class]
----

Логика поиска определяется с помощью <<search-executor,SearchExecutor>>:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/entitysuggestionfield/EntitySuggestionFieldScreen.java[tags=autowired-data-manager;search-executor-metaclass]
----

[[actions]]
== Действия

Для `EntitySuggestionField` можно определить настраиваемые и предопределенные действия, отображаемые в виде кнопок справа. Это можно сделать либо в XML-дескрипторе с помощью вложенного элемента `actions`, либо программно в контроллере с помощью метода `addAction()`.

[[predefined-actions]]
=== Предопределенные действия

Если создать `EntitySuggestionField` без действий, загрузчик XML определит для него только действия `entity_lookup` и `entity_open`. Существуют также действия `entity_clear` и `entity_openComposition`.

Чтобы добавить другое предопределенное действие, например, `entity_clear`, нужно определить элемент `actions` следующим образом:

[source, xml,indent=0]
----
include::example$/ex1/src/main/resources/ui/ex1/screen/component/entitysuggestionfield/entitysuggestionfield-screen.xml[tags=field-with-actions]
----

Элемент `actions` не дополняет, а переопределяет набор стандартных действий. Вам необходимо явно указывать идентификаторы всех требуемых действий.

Используйте `addAction()`, чтобы задать действия программно. Если компонент определен в XML-дескрипторе без вложенного элемента `actions`, достаточно добавить недостающие действия:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/entitysuggestionfield/EntitySuggestionFieldScreen.java[tags=add-action;init-start;add-action-2;init-end]
----

[[custom-actions]]
=== Настраиваемые действия

Настраиваемые действия для `EntitySuggestionField` схожи с xref:vcl/components/entity-picker.adoc#custom-actions[настраиваемые действиями] для `EntityPicker`.

[[handlers]]
== События и слушатели

include::../events-hanlers-generation-tip.adoc[]

[[arrow-down-handler]]
=== ArrowDownHandler

`ArrowDownEvent` отправляется, когда пользователь нажимает клавишу *Arrow Down* при скрытом всплывающем окне с подсказками.

Вы можете настроить свой обработчик событий и использовать метод `EntitySuggestionField.showSuggestions()`, который принимает список сущностей для отображения подсказок:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/entitysuggestionfield/EntitySuggestionFieldScreen.java[tags=arrow-down]
----

[[context-help-icon-click-handler]]
=== ContextHelpIconClickHandler

См. xref:vcl/api.adoc#context-help-icon-click-handler[ContextHelpIconClickHandler].

[[enter-press-handler]]
=== EnterPressHandler

See the example of programmatic registration in the xref:vcl/components/combo-box.adoc#handling-user-input[Handling User Input] section for `ComboBox`.

`EnterPressHandler` can be provided declaratively using the `@Install` annotation in the screen controller. See this example in the xref:vcl/components/entity-combo-box.adoc#handling-user-input[Handling User Input] section for `EntityComboBox`.

[[field-icon-provider]]
=== FieldIconProvider

См. xref:vcl/components/entity-picker.adoc#field-icon-provider[FieldIconProvider].

[[field-value-change-event]]
=== FieldValueChangeEvent

See xref:vcl/components/entity-picker.adoc#field-value-change-event[FieldValueChangeEvent].

[[formatter]]
=== Formatter

Добавляет экземпляр xref:vcl/miscellaneous/formatter.adoc[formatter] в компонент.

В приведенном ниже примере показано использование `formatter` для поля с подсказками сущностей `cityFieldFormat`:

[source,java,indent=0]
----
include::example$/ex1/src/main/java/ui/ex1/screen/component/entitysuggestionfield/EntitySuggestionFieldScreen.java[tags=formatter]
----

Чтобы добавить formatter программно, используйте метод компонента `setFormatter()`.

[[option-caption-provider]]
=== OptionCaptionProvider

See xref:vcl/api.adoc#option-caption-provider[OptionCaptionProvider].

[[search-executor-interface]]
=== SearchExecutor

See <<search-executor, SearchExecutor>>.

[[validator]]
=== Validator

См. xref:vcl/components/combo-box.adoc#validator[Validator].

[[value-change-event]]
=== ValueChangeEvent

See xref:vcl/api.adoc#value-change-event[ValueChangeEvent].

[[xml]]
== XML-атрибуты EntitySuggestionField

include::../xml-studio-tip.adoc[]

xref:vcl/xml.adoc#align[align] -
xref:vcl/components/suggestion-field.adoc#async-search-delay-ms[asyncSearchDelayMs] -
xref:vcl/xml.adoc#caption[caption] -
xref:vcl/xml.adoc#caption-as-html[captionAsHtml] -
xref:vcl/xml.adoc#caption-property[captionProperty] -
xref:vcl/xml.adoc#colspan[colspan] -
xref:vcl/xml.adoc#context-help-text[contextHelpText] -
xref:vcl/xml.adoc#context-help-text-html-enabled[contextHelpTextHtmlEnabled] -
xref:vcl/xml.adoc#css[css] -
xref:vcl/xml.adoc#data-container[dataContainer] -
xref:vcl/xml.adoc#description[description] -
xref:vcl/xml.adoc#description-as-html[descriptionAsHtml] -
xref:vcl/xml.adoc#editable[editable] -
xref:vcl/xml.adoc#enable[enable] -
xref:vcl/xml.adoc#box-expand-ratio[box.expandRatio] -
xref:vcl/xml.adoc#height[height] -
xref:vcl/xml.adoc#html-sanitizer-enabled[htmlSanitizerEnabled] -
xref:vcl/xml.adoc#icon[icon] -
xref:vcl/xml.adoc#id[id] -
xref:vcl/xml.adoc#input-prompt[inputPrompt] -
<<meta-class,metaClass>> -
xref:vcl/components/suggestion-field.adoc#min-search-string-length[minSearchStringLength] -
xref:vcl/components/suggestion-field.adoc#popup-width[popupWidth] -
xref:vcl/xml.adoc#property[property] -
xref:vcl/xml.adoc#required[required] -
xref:vcl/xml.adoc#required-message[requiredMessage] -
xref:vcl/xml.adoc#responsive[responsive] -
xref:vcl/xml.adoc#rowspan[rowspan] -
xref:vcl/xml.adoc#stylename[stylename] -
xref:vcl/components/suggestion-field.adoc#suggestions-limit[suggestionsLimit] -
xref:vcl/xml.adoc#tab-index[tabIndex] -
xref:vcl/xml.adoc#visible[visible] -
xref:vcl/xml.adoc#width[width]

== XML-элементы EntitySuggestionField

<<actions,actions>> -
xref:vcl/miscellaneous/formatter.adoc[formatter] -
<<query,query>> -
xref:vcl/components/entity-combo-box.adoc#validators-element[validators]