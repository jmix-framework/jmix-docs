= Studio 中的 BPMN 建模器


Studio 提供了一个 *BPMN 建模器*，能直接在 IDE 中对业务流程进行建模。仅当项目中包含 xref:bpm:index.adoc[BPM 扩展组件] 时，设计器才可用。

== 概览

以下是一个 BPMN 建模器窗口：

image::process-modeling/studio-modeler.png[,800]

其中显示了下列区域和控制面板：

* *画布（Canvas）* -- 可以设计 BPMN 元素的工作区。
* *BPMN 工具箱*（1）-- BPMN 工具箱提供了构建 BPMN 图的所有元素。工具箱位于建模界面的左侧，用户能够轻松地将各种 BPMN 元素拖放到图表画布上，从而进行直观和高效的流程建模。
* *流程操作*（2）-- 流程操作按钮位于建模器窗口的左上角，依据当前模型是草稿还是可部署的流程提供不同的功能。
* *BPMN 属性面板（Inspector）*（4）-- 用户可以配置和管理流程模型中 BPMN 元素的属性。
* *显示开关*（5）-- 这个开关用于控制 BPMN 属性面板是否展示。

== 导航至代码

使用建模器，可以切换至与所选元素属性相关的 Java 代码，
查看代码如何使用。

image::process-modeling/jump-to-code.png[,800]

* 加号按钮（image:process-modeling/plus-button.png[,20]）-- 在需要编写新代码时，可以用这个按钮创建 Spring bean、Java 代理、Jmix 视图流程或其他组件。
* 向右箭头（image:process-modeling/right-button.png[,20]）-- 如果元素已配置，用该按钮直接跳转到相关的代码。
* 向下箭头（image:process-modeling/down-button.png[,20]）-- 该按钮可以打开一个下拉框，选择一个与所选属性相关的代码组件。

== 属性查找

在 *BPMN 属性面板* 顶部有一个搜索框。输入属性名可以查找需要的属性。

例如，我们搜索名称包含 `id` 的属性：

image::process-modeling/property-finder.png[,400]

则仅显示匹配的属性。

== 参数排序和删除

当元素的属性可以有多个参数时，例如 *输入对话框表单*，在属性面板中可以调整属性的位置。

image::process-modeling/parameters-ordering.png[,400]

通过左上角的上（image:process-modeling/up-button.png[,20] ）下（image:process-modeling/down-button-1.png[,20]） 按钮调整属性的顺序。

如需删除属性，使用减号（image:process-modeling/delete-button.png[,20]）按钮。

== 编辑命令

建模器支持以下编辑命令：

[width="50%"]
|===
|命令 |Windows |Mac OS

|Undo |Ctrl-Z |Cmd-Z
|Redo |Ctrl-Y |Cmd-Y
|Copy |Ctrl-C |Cmd-C
|Paste |Ctrl-V |Cmd-V
|Select all |Ctrl-A |Cmd-A
|Hand tool |H |H
|Lasso tool |L |L
|Space tool |S |S
|Edit label |E |E
|Find |F |F
|===

//todo: group selection doesn't work and there are no buttons/menu for commands
//JST-5290 BPMN Modeler: editing commands work not all

[[processes-and-drafts]]
== 流程和草稿

项目中安装了 BPM 扩展组件后，*Jmix 项目树* 中会显示一个新的 *BPM* 节点。
该节点一开始是空的。
在创建了流程和流程草稿后，会显示两个子节点：*Process Drafts* 和 *Processes*：

image::process-modeling/bpm-jmix-tree.png[,400]

这两个节点的实际文件夹分别位于 `resources/process-drafts` 和 `resources/process`：

image::process-modeling/process-directories.png[,400]

Jmix 项目树中的这两个子节点是为了提升开发人员的体验。
一开始，开发者可以创建流程的草稿并将其保存在 *Process Drafts* 节点中。
然后，当流程准备好进行部署时，就可以复制到 *Processes* 节点。

[NOTE]
====
从技术上讲，_processes_ 和 _process drafts_ 没有区别：都是有效的 BPMN 2.0 XML 文件。
但是流程草稿在文件名中有一个额外的扩展名，按以下格式：
`<process-id>.draft.xml`

将流程模型复制到 *Processes* 节点时，系统会从其名称中删除 `.draft` 扩展名。
====

[IMPORTANT]
====
请不要手动删除 *Process Drafts* 节点中文件的 `.draft` 扩展名。
====

下次应用程序启动时，*Processes* 节点中的所有模型都将部署到服务器。
或者，可以使用 *热部署* 功能，而无需重新启动应用程序。

// image::process-modeling/draft-context-menu.png[,400]
// image::process-modeling/process-context-menu.png[,400]


[[process-creating]]
== 创建流程

在 *Jmix Studio* 中，新流程的创建有几种方式：

. 使用 *Jmix 工具窗口*：
+
image::process-modeling/new-process-from-jmix-menu.png[,400]

. 使用 *BPM* 节点的右键菜单：
+
image::process-modeling/new-process-from-the-tree.png[,400]

. 使用 IntelliJ IDEA 主菜单项：*File*-> *New*-> *BPMN Process*：
+
image::process-modeling/new-process-from-file-menu.png[,500]

. 项目中任何位置的右键菜单：
+
image::process-modeling/new-process-context-menu.png[,400]

在打开的新建流程窗口中，
输入流程的 ID（单词间隔用短横），会自动生成流程名称。

image::bpmn-process/new-process.png[,500]

点击 *OK* 后，会显示 *BPMN 建模器*。

该流程的 XML 文件会创建为 _草稿（draft）_，并放置在 *Process Drafts* 文件夹。

[[uploading-processes]]
== 上传流程模型

可以将外部流程模型上传至项目中。
只需使用操作系统提供的复制粘贴功能即可。

在 IntelliJ IDEA 中切换至 _项目视图（Project view）_，
将复制的 XML 文件粘贴到 `resources/process-drafts` 或 `resources/process` 文件夹。

[WARNING]
====
当复制文件到 *草稿* 目录时，请添在文件名的 `.xml` 前添加 `.draft` 后缀。
====
