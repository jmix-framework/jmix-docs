= 电子邮件任务

[[overview]]
== 概览
*发送电子邮件任务（Email Sending Task）* 可以在流程的执行过程中发送电子邮件。
使用该功能需要安装 xref:email:index.adoc[] 扩展组件。

这是 Jmix 开发的一个自定义任务，并非 BPMN 的标准任务。

.*图形表示*

该任务是一个服务任务，在图中展示为圆角矩形，左上角有一个小的信封图标。
图标已填充表示发送的语义。

image::jmix-email-task/email-task.png[,150]

*属性*

邮件任务有下列属性：

image::jmix-email-task/email-task-properties.png[,700]
配置邮件任务：

* 首先，需要设置 xref:bpmn/bpmn-tasks.adoc#common-task-properties[通用任务属性]。

* 然后，设置邮件相关的参数。

* 按需创建 _执行监听器（Execution listeners）_。

* 关于 _异步（Async）_ 标记，详情参考 xref:bpmn/transactions.adoc[事务]。


[NOTE]
====
电子邮件发送任务没有可用的多实例属性。
但是可用在多实例的嵌入子流程中。
参阅 xref:bpm:bpmn/multi-instance-activities.adoc[多实例]。
====

[[email-parameters]]
== 电子邮件参数

电子邮件任务与普通的发送电子邮件一样，有一些比如收件人、发件人、主题等参数。

[[set-address]]
=== 设置邮件地址

邮件地址有这些字段：
*To*、*Cc*、*Bcc*、*From*。

前三个可以包含多个邮件地址，用 *Email Address Editor* 填写，
点击 image:jmix-email-task/edit-button.png[,25] _Edit_ 按钮。

可以使用流程变量或表达式来提供地址，也可以直接设置地址。
支持设置多个邮件地址，并可以在编辑器中设置：

image::jmix-email-task/address-editor.png[,500]

*From* 是发件人地址，只能有一个地址。这样就不能使用编辑器了，可以直接在字段中填写地址或表达式。

* *Subject* - 邮件主题。主题中可以使用流程变量。
* *Content* - 邮件正文。在编辑器中，可以选择正文的类型：HTML 或纯文本。这里也能使用流程变量。
+
image::jmix-email-task/email-content-editor.png[,500]

* *Content type* - 定义正文的类型，HTML 或纯文本。
+
image::jmix-email-task/content-type.png[,400]


[[async-sending]]
=== 异步发送
* *Send asynchronously* - 默认情况下，邮件是异步发送。
+
image::jmix-email-task/send-async.png[,400]
+
[WARNING]
====
别忘记选择 *Async* 标记，这个标记适用所有任务。
====

[[attachements-content]]
=== 附件
* *Attachments* - 附件。
附件需要通过表达式指定：可以是流程变量或 Spring bean 的方法调用。
支持 `File`、`FileRef`、`byte[]` 和 `FileDescription` 类型。
+
附件的名称是可选的。
如果附件名称未指定，则从文件内容获取。
如果文件是 `byte[]` 类型，则默认使用 `attachment_<incremental_part>` 作为文件名。
+
image::jmix-email-task/create-attachment.png[,400]


