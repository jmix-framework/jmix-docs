= æ¶ˆæ¯åŒ…

æœ¬åœ°åŒ–çš„æœ€å¸¸è§å·¥ä½œå°±æ˜¯æ ¹æ®ç”¨æˆ·æ‰€åœ¨çš„è¯­è¨€ç¯å¢ƒæä¾›æœ¬åœ°åŒ–æ¶ˆæ¯ã€‚å› æ­¤ï¼Œå¿…é¡»ä»ä»£ç ä¸­å°†æ¶ˆæ¯æŠ½å–å‡ºæ¥ï¼Œå¹¶æ”¾ç½®åˆ°ç‰¹æ®Šçš„å±æ€§æ–‡ä»¶å†…ï¼Œä¸€ç§è¯­è¨€å»ºç«‹ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™æ ·çš„ä¸€ç»„æ–‡ä»¶è¢«ç§°ä¸º _æ¶ˆæ¯åŒ…_ã€‚

é™¤äº†æ¶ˆæ¯ä¹‹å¤–ï¼Œæ¶ˆæ¯åŒ…è¿˜å¯ä»¥åŒ…å« xref:data-model:data-types.adoc#localized-format-strings[æœ¬åœ°åŒ–æ•°æ®æ ¼å¼å­—ç¬¦ä¸²]ã€‚

é¡¹ç›®ä¸­é»˜è®¤çš„æ¶ˆæ¯åŒ…ç”±ä¸€ç»„ `messages_<language>.properties` æ–‡ä»¶ç»„æˆï¼Œä½äº `src/main/resources` ç›®å½•ä¸‹çš„æ ¹åŒ…ç›®å½•å†…ã€‚

CAUTION: æ¶ˆæ¯åŒ…æ–‡ä»¶å¿…é¡»æ˜¯ UTF-8 ç¼–ç ã€‚

[[setting-locales]]
== é…ç½®è¯­è¨€ç¯å¢ƒ

å½“ä½¿ç”¨ Studio åˆ›å»ºæ–°é¡¹ç›®æ—¶ï¼Œå¯ä»¥åœ¨é¡¹ç›®åˆ›å»ºå‘å¯¼ä¸­çš„ *Locales* å­—æ®µé…ç½®æ”¯æŒçš„è¯­è¨€ç¯å¢ƒã€‚è¯¥å­—æ®µæ”¯æŒé€‰æ‹©è¯­è¨€åŠå…¶ç¼–ç ã€‚

Studio å°†è¯­è¨€ç¼–ç åˆ—è¡¨å†™å…¥ xref:ROOT:app-properties.adoc#jmix.core.available-locales[jmix.core.available-locales] åº”ç”¨ç¨‹åºå±æ€§ï¼Œå°†è¯­è¨€åç§°ç”¨ `localeDisplayName.<language>` é”®å€¼å†™å…¥å¯¹åº”çš„ `messages_<language>.properties` æ–‡ä»¶ä¸­ã€‚ä¹‹åå¯ä»¥é€šè¿‡ Studio *Project Properties* çª—å£çš„ *Locales* æ ‡ç­¾é¡µä¿®æ”¹ï¼Œæˆ–è€…æ‰‹åŠ¨ä¿®æ”¹ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä¸ºåº”ç”¨ç¨‹åºå®šä¹‰äº†ä¸¤ç§è¯­è¨€ï¼š`Englishï¼ˆenï¼‰` å’Œ `Deutsch (de)`ï¼Œé¡¹ç›®ä¸­åˆ™ä¼šæœ‰å¦‚ä¸‹æ–‡ä»¶ç»“æ„ï¼ˆå‡è®¾æ ¹åŒ…æ˜¯ `com.company.demo`ï¼‰ï¼š

[source, text]
----
src/main/resources/
    com/company/demo/
        messages_en.properties
        messages_de.properties
    application.properties
----

æ–‡ä»¶æœ‰å¦‚ä¸‹å†…å®¹ï¼š

.messages_en.properties
[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=localeDisplayName]
----

.messages_de.properties
[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_de.properties[tags=localeDisplayName]
----

.application.properties
[source,properties]
----
include::example$/localization_ex1/src/main/resources/application.properties[tags=availableLocales]
----

[[creating-messages]]
== åˆ›å»ºæ¶ˆæ¯

[[group-and-key]]
=== åˆ†ç»„å’Œé”®å€¼

é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºåªåŒ…å«å•ä¸€æ¶ˆæ¯åŒ…ã€‚å³ä½¿ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºä¹Ÿå¯èƒ½åŒ…å«å¤§é‡çš„æ¶ˆæ¯ï¼Œå› æ­¤æˆ‘ä»¬æ¨èå±æ€§é”®å€¼ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šåˆ†ç»„å’Œæ¶ˆæ¯é”®å€¼ï¼Œç”¨ `/` åˆ†éš”ã€‚è¿™æ ·å¯ä»¥å¯¹ç›¸å…³çš„æ¶ˆæ¯è¿›è¡Œåˆ†ç»„é¿å…å‘½åå†²çªã€‚ä¸‹é¢ä¾‹å­ä¸­ï¼Œ`com.company.demo.view.main` æ˜¯åˆ†ç»„ï¼Œ`applicationTitle.text` æ˜¯æ¶ˆæ¯é”®å€¼ï¼š

[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=structure]
----

ä¹Ÿå¯ä»¥å®šä¹‰æ— åˆ†ç»„çš„æ¶ˆæ¯ï¼Œç¤ºä¾‹ï¼š

[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=structure-2]
----

[[localizing-data-model]]
=== æ•°æ®æ¨¡å‹æœ¬åœ°åŒ–

Jmix å¼•å…¥äº†ä¸€äº›å…³äºæ•°æ®æ¨¡å‹å…ƒç´ æœ¬åœ°åŒ–çš„çº¦å®šï¼šå®ä½“ã€å±æ€§åç§°å’Œæšä¸¾å€¼ã€‚è¿™äº›çº¦å®šæ”¯æŒæ¡†æ¶åœ¨ UI ç»„ä»¶ä¸­æ˜¾ç¤ºå®ä½“å’Œæšä¸¾æ—¶æ–¹ä¾¿æŸ¥æ‰¾æœ¬åœ°åŒ–åç§°ã€‚

å®ä½“åç§°ä½¿ç”¨ `<package>/<class>` æ ¼å¼æœ¬åœ°åŒ–ï¼Œå±æ€§åç§°ä½¿ç”¨ `<package>/<class>.<attribute>` æ ¼å¼ã€‚ç¤ºä¾‹ï¼š

[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=entity]
----

æšä¸¾ç±»ä½¿ç”¨ `<package>/<class>` æ ¼å¼æœ¬åœ°åŒ–ï¼Œæšä¸¾å€¼ä½¿ç”¨ `<package>/<class>.<value>` æ ¼å¼ã€‚ç¤ºä¾‹ï¼š

[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=enum]
----

TIP: ç”¨ Studio å¯è§†åŒ–è®¾è®¡å™¨å¯ä»¥å¾ˆå®¹æ˜“åˆ›å»ºæ•°æ®æ¨¡å‹å…ƒç´ çš„æœ¬åœ°åŒ–åç§°ã€‚ç‚¹å‡»å…ƒç´ åç§°æ—è¾¹çš„ ğŸŒï¼ˆåœ°çƒï¼‰æŒ‰é’®ï¼Œç„¶ååœ¨ *Localized Message* å¯¹è¯æ¡†ä¸­åˆ†åˆ«è¾“å…¥æœ¬åœ°åŒ–å€¼å³å¯ã€‚

[[additional-bundles]]
=== æ·»åŠ æ¶ˆæ¯åŒ…

åœ¨å¸¦æœ‰å¾ˆå¤šæ¶ˆæ¯çš„å¤§åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯ä»¥å®šä¹‰é™„åŠ æ¶ˆæ¯åŒ…ä»¥ä¿æŒåˆç†çš„å±æ€§æ–‡ä»¶å¤§å°ï¼š

. åœ¨ `src/main/resources` ä¸‹é¢çš„ä»»æ„æ–‡ä»¶å¤¹åˆ›å»ºä¸€ç»„ä»»æ„å‘½åçš„å±æ€§æ–‡ä»¶ã€‚ä¸‹é¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¸»æ¶ˆæ¯åŒ…çš„åŒçº§ç›®å½•ä¸­åˆ›å»ºäº†ä¸€ç»„ `additional_messages` æ–‡ä»¶ï¼š
+
[source]
----
src/main/resources/com/company/demo/
    additional_messages_en.properties
    additional_messages_de.properties
    messages_en.properties
    messages_de.properties
----

. åœ¨é™„åŠ æ¶ˆæ¯åŒ…ä¸­æŒ‰ç…§ä¸»æ¶ˆæ¯åŒ…ä¸€æ ·çš„æ ¼å¼å†™å…¥æœ¬åœ°åŒ–æ¶ˆæ¯ã€‚

. ä¸ºåº”ç”¨ç¨‹åºç±»æ·»åŠ  `@MessageSourceBasenames` æ³¨è§£ï¼Œå¹¶è®¾ç½®é™„åŠ åŒ…çš„è·¯å¾„å’Œåç§°ï¼š
+
[source,java,indent=0]
----
include::example$/localization_ex1/src/main/java/com/company/demo/DemoApplication.java[tags=additional-bundle]
----

CAUTION: æ‰€æœ‰æ¶ˆæ¯åŒ…ä¸­çš„é”®å€¼åŠ è½½è‡³åŒä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œå› æ­¤éœ€è¦ä¿è¯æ‰€æœ‰åŒ…ä¸­é”®å€¼çš„å”¯ä¸€æ€§ã€‚

[[using-messages]]
== ä½¿ç”¨æ¶ˆæ¯

[[using-messages-in-java]]
=== åœ¨ Java ä¸­ä½¿ç”¨

[[messages-interface]]
==== Messages æ¥å£

ä½¿ç”¨ `Messages` bean ä»æ¶ˆæ¯åŒ…è·å–æœ¬åœ°åŒ–æ¶ˆæ¯ã€‚æœ€å¸¸è§ç”¨æ³•æ˜¯è°ƒç”¨ `getMessage()` æ–¹æ³•ï¼Œä¸ºå…¶æä¾›æ¶ˆæ¯åˆ†ç»„å’Œæ¶ˆæ¯é”®å€¼ã€‚æ–¹æ³•è¿”å›å½“å‰ç”¨æˆ·è¯­è¨€ç¯å¢ƒçš„æ¶ˆæ¯ï¼›å¦‚æœæ— æ­¤æ¶ˆæ¯ï¼Œåˆ™è¿”å›ä¼ å…¥çš„é”®å€¼æœ¬èº«ã€‚

ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¶ˆæ¯åŒ…ä¸­å®šä¹‰äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ `Messages` bean çš„ä¸åŒæ–¹æ³•è·å–ï¼š

.messages_en.properties
[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=using-messages]
----

[source,java,indent=0]
----
include::example$/localization_ex1/src/test/java/com/company/demo/MessagesTest.java[tags=using-messages-1]
----

ä¸‰ä¸ªæ–¹æ³•è¿”å›åŒä¸€ä¸ªå€¼ï¼š`Something has happened`ã€‚

<1> æŒ‡å®šå®Œæ•´çš„å±æ€§é”®å€¼ã€‚
<2> åˆ†ç»„å’Œé”®å€¼åˆ†åˆ«æŒ‡å®šã€‚
<3> å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `Class`ï¼Œæ–¹æ³•ä½¿ç”¨ç±»æ‰€åœ¨çš„åŒ…åä½œä¸ºåˆ†ç»„ã€‚

`getMessage()` æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªæ¥æ”¶ `Enum` å‚æ•°çš„é‡è½½ï¼Œç”¨äºè·å–æšä¸¾å€¼çš„æœ¬åœ°åŒ–æ¶ˆæ¯ï¼Œç¤ºä¾‹ï¼š

[source,java,indent=0]
----
include::example$/localization_ex1/src/test/java/com/company/demo/MessagesTest.java[tags=using-messages-enum]
----

[[message-bundle-interface]]
==== MessageBundle æ¥å£

`MessageBundle` æ¥å£å¯ä»¥åœ¨ UI è§†å›¾æ§åˆ¶å™¨ä¸­ä½¿ç”¨ã€‚è¯¥æ¥å£æä¾›è·å–ä¸è§†å›¾å…³è”çš„å•ä¸€æ¶ˆæ¯ç»„å†…æœ¬åœ°åŒ–æ¶ˆæ¯çš„æ–¹æ³•ã€‚åŠŸèƒ½ä¸ <<messages-interface,Messages>> bean æ˜¯æœ‰å·®åˆ«çš„ï¼Œ`MessageBundle` ç›´æ¥è·å–ä¸å½“å‰è§†å›¾ç±»ç›¸å…³çš„æ¶ˆæ¯ç»„ï¼Œå› æ­¤æ— éœ€ä¼ é€’ç»„é”®å€¼æˆ–ç±»åã€‚

å¦‚éœ€ä½¿ç”¨ `MessageBundle`ï¼Œå°†å…¶æ³¨å…¥æ§åˆ¶å™¨ï¼š

[source,java,indent=0]
----
include::example$/localization_ex1/src/main/java/com/company/demo/view/user/UserListView.java[tags=inject-message-bundle]
----

ç„¶åå¯ä»¥é€šè¿‡é”®å€¼è·å–æ¶ˆæ¯ï¼š

[source,java,indent=0]
----
include::example$/localization_ex1/src/main/java/com/company/demo/view/user/UserListView.java[tags=message-bundle]
----

æ¶ˆæ¯çš„ç»„åä»è§†å›¾ç±»çš„åŒ…åæ¨æ–­ï¼Œä¸ä½¿ç”¨ `Messages.getMessage(getClass(), "someMessage")` ç±»ä¼¼ã€‚

å¯ä»¥ä½¿ç”¨ä¸‹é¢æè¿°çš„ `messagesGroup` XML å±æ€§å®šä¹‰ä»»æ„æ¶ˆæ¯ç»„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `setMessageGroup()` æ–¹æ³•åœ¨æ§åˆ¶å™¨ä¸­è®¾ç½®ï¼š

[source,java,indent=0]
----
include::example$/localization_ex1/src/main/java/com/company/demo/view/user/UserListView.java[tags=message-bundle-set-group]
----

`MessageBundle` çš„ `formatMessage()` æ–¹æ³•é€šè¿‡é”®é”®å€¼æ£€ç´¢æœ¬åœ°åŒ–æ¶ˆæ¯ï¼Œç„¶åä½¿ç”¨æ¶ˆæ¯æ¥æ ¼å¼åŒ–è¾“å…¥å‚æ•°ã€‚æ ¼å¼æ˜¯æ ¹æ® `String.format()` æ–¹æ³•è§„åˆ™å®šä¹‰çš„ã€‚ä¾‹å¦‚ï¼š

.messages_en.properties
[source,properties,indent=0]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=format-message]
----

[source,java,indent=0]
----
include::example$/localization_ex1/src/main/java/com/company/demo/view/user/UserListView.java[tags=format-message]
----

[[using-messages-in-ui]]
=== åœ¨ XML æè¿°ä¸­ä½¿ç”¨

Jmix UI è§†å›¾æè¿°å’Œèœå•é…ç½®æ–‡ä»¶éƒ½èƒ½è¯†åˆ« `msg://` å‰ç¼€å¹¶ä»æ¶ˆæ¯åŒ…åŠ è½½æ¶ˆæ¯ã€‚

æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹çœ‹çœ‹ä½¿ç”¨ `msg://` çš„ä¸åŒæƒ…å†µã€‚

. æ¶ˆæ¯åˆ†ç»„é€šè¿‡è§†å›¾çš„åŒ…åæ¨æ–­ã€‚
+
--
ä¾‹å¦‚ï¼Œå¦‚æœå®šä¹‰äº† `com.company.demo.view.user` åˆ†ç»„çš„æ¶ˆæ¯ï¼š

.messages_en.properties
[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=screen]
----

åœ¨ `com.company.demo.view.user` åŒ…å†…çš„è§†å›¾æè¿°æ–‡ä»¶ä¸­å¯ä»¥ç›´æ¥æŒ‡å®šæ¶ˆæ¯é”®å€¼è·å–æ¶ˆæ¯ï¼Œè€Œæ— éœ€æŒ‡å®šåˆ†ç»„ï¼š

.com/company/demo/view/user/user-list-view.xml
[source,xml,indent=0]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/view/user/user-list-view.xml[tags=message-1]
----
--

. è·å–ä»»æ„åˆ†ç»„å†…çš„æ¶ˆæ¯ã€‚
+
--
é€šè¿‡åœ¨ `msg://` åæŒ‡å®šåˆ†ç»„å’Œé”®å€¼ï¼Œå¯ä»¥ä»å…¶ä»–è§†å›¾è·å–ä¸Šé¢ç¤ºä¾‹ä¸­çš„æ¶ˆæ¯ï¼Œç¤ºä¾‹ï¼š

.com/company/demo/view/main/main-view.xml
[source,xml,indent=0]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/view/main/main-view.xml[tags=message]
----

è§†å›¾çº§åˆ«è¿˜å¯ä»¥ä½¿ç”¨ `messagesGroup` å±æ€§è®¾ç½®ä»»æ„æ¶ˆæ¯åŒ…ï¼Œè¿™æ ·çš„è¯ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½é»˜è®¤ä»è®¾ç½®çš„åŒ…ä¸­è·å–ï¼š

.com/company/demo/view/sample/sample-view.xml
[source,xml,indent=0]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/view/sample/sample-view.xml[tags=messages-group]
----
--

. è·å–æ— åˆ†ç»„çš„æ¶ˆæ¯ã€‚
+
--
å¦‚éœ€è·å–æ— åˆ†ç»„çš„æ¶ˆæ¯ï¼Œå¯ä»¥åœ¨å‰ç¼€ä¸­ä½¿ç”¨ä¸‰ä¸ªæ–œæ  `msg:///`ï¼Œç„¶åç›´æ¥è·Ÿæ¶ˆæ¯é”®å€¼ã€‚

ä¾‹å¦‚ï¼Œå®šä¹‰æ¶ˆæ¯ï¼š

[source,properties]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/messages_en.properties[tags=structure-2]
----

è§†å›¾æ§åˆ¶å™¨ä¸­å¯è¿™æ ·è·å–ï¼š

[source,xml,indent=0]
----
include::example$/localization_ex1/src/main/resources/com/company/demo/view/user/user-list-view.xml[tags=message-2]
----
--
