= Компонент Kanban
:table-caption!:

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/kanban-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Компонент пользовательского интерфейса `kanban` представляет собой доску Kanban. Доска отображает рабочий процесс на разных этапах проекта, используя карточки для задач и столбцы для каждого этапа.

[cols="2h,8", grid=none]
|===
|XML-элемент
|`kanban`
|Java-класс
|`io.jmix.kanbanflowui.component.Kanban`
|Атрибуты
|xref:flow-ui:vc/common-attributes.adoc#id[id] -
xref:flow-ui:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<applyColumnColorToTasks,applyColumnColorToTasks>> -
<<autoColumnHeightEnabled,autoColumnHeightEnabled>> -
<<autoSave,autoSave>> -
xref:flow-ui:vc/common-attributes.adoc#classNames[classNames] -
<<collapsible,collapsible>> -
xref:flow-ui:vc/common-attributes.adoc#colspan[colspan] -
<<columnActionsEnabled,columnActionsEnabled>> -
<<columnColorEntireSurfaceEnabled,columnColorEntireSurfaceEnabled>> -
<<columnFooterVisible,columnFooterVisible>> -
<<columnHidingAllowed,columnHidingAllowed>> -
<<columnReorderingAllowed,columnReorderingAllowed>> -
<<columnSummaryEnabled,columnSummaryEnabled>> -
<<columnsWidth,columnsWidth>> -
xref:flow-ui:vc/common-attributes.adoc#css[css] -
xref:flow-ui:vc/common-attributes.adoc#dataContainer[dataContainer] -
<<dragAllowed,dragAllowed>> -
<<dropAllowed,dropAllowed>> -
<<dropPlaceholderAllowed,dropPlaceholderAllowed>> -
xref:flow-ui:vc/common-attributes.adoc#enabled[enabled] -
xref:flow-ui:vc/common-attributes.adoc#height[height] -
<<hierarchyMode,hierarchyMode>> -
xref:flow-ui:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:flow-ui:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:flow-ui:vc/common-attributes.adoc#minHeight[minHeight] -
xref:flow-ui:vc/common-attributes.adoc#minWidth[minWidth] -
<<swimlanesFrom,swimlanesFrom>> -
<<swimlanesTo,swimlanesTo>> -
<<taskColorEntireSurfaceEnabled,taskColorEntireSurfaceEnabled>> -
<<taskDueDateVisible,taskDueDateVisible>> -
<<taskPosition,taskPosition>> -
<<taskPriorityVisible,taskPriorityVisible>> -
<<taskProgressVisible,taskProgressVisible>> -
<<taskTagsVisible,taskTagsVisible>> -
<<taskUserAvatarVisible,taskUserAvatarVisible>> -
xref:flow-ui:vc/common-attributes.adoc#visible[visible] -
xref:flow-ui:vc/common-attributes.adoc#width[width]
|Обработчики
|xref:flow-ui:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:flow-ui:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<KanbanColumnClickEvent,KanbanColumnClickEvent>> -
<<KanbanColumnDoubleClickEvent,KanbanColumnDoubleClickEvent>> -
<<KanbanColumnCollapseEvent,KanbanColumnCollapseEvent>> -
<<KanbanColumnExpandEvent,KanbanColumnExpandEvent>> -
<<KanbanColumnHideEvent,KanbanColumnHideEvent>> -
<<KanbanColumnReorderEvent,KanbanColumnReorderEvent>> -
<<KanbanColumnShowEvent,KanbanColumnShowEvent>> -
<<KanbanDragEndEvent,KanbanDragEndEvent>> -
<<KanbanDragStartEvent,KanbanDragStartEvent>> -
<<KanbanTaskClickEvent,KanbanTaskClickEvent>> -
<<KanbanTaskDoubleClickEvent,KanbanTaskDoubleClickEvent>> -
<<saveDelegate,saveDelegate>>
|Элементы
|<<actions,actions>> -
<<columnFooterRendererFunction,columnFooterRendererFunction>> -
<<columnHeaderRendererFunction,columnHeaderRendererFunction>> -
<<columns,columns>> -
<<column,column>> -
<<swimlanes,swimlanes>> -
<<swimlane,swimlane>> -
<<propertiesMapping,propertiesMapping>> -
<<taskRendererFunction,taskRendererFunction>>
|===

[[basic]]
== Основы

Чтобы создать компонент, используйте XML-элемент `kanban` и свяжите его с xref:flow-ui:data/data-containers.adoc[контейнером данных]. Для этого можно использовать Jmix Studio.

image::create-kanban-component.png[align="center", width="1318"]

Новый элемент `kanban` будет добавлен как в панель структуры *Jmix UI*, так и в XML. Вы можете настроить атрибуты, такие как xref:flow-ui:vc/common-attributes.adoc#id[id], xref:flow-ui:vc/common-attributes.adoc#height[height], xref:flow-ui:vc/common-attributes.adoc#width[width] и так далее, так же, как это делается для других xref:flow-ui:vc/components.adoc[компонентов UI].

[source,xml,indent=0]
----
<kanban:kanban id="kanban"
               height="100%"
               width="100%"/>
----

Если вы не используете дизайнер экранов, объявите пространство имен `kanban` в XML-дескрипторе вашего экрана вручную:

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=xmlns]
----

Затем укажите, какие данные и столбцы вы хотите отобразить:

* Чтобы отобразить столбцы, добавьте элемент <<columns,columns>> с атрибутом `columnsEnum`.
* Чтобы настроить сопоставление полей сущности, используйте элемент <<propertiesMapping,propertiesMapping>>.

В следующем примере показано, как создать базовую доску Kanban:

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=data;collection-container;layout;basic]
----

image::kanban-basic.png[align="center",width="804"]

[[data-binding]]
== Привязка данных

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/kanban-data" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Привязка данных - это связь визуального компонента с контейнером данных. Kanban может отображать данные, загруженные в xref:flow-ui:data/collection-container.adoc[контейнер коллекции] или контейнер xref:flow-ui:data/key-value-containers.adoc[KeyValue].

[[collection-container]]
=== Контейнер коллекции

Обычно вы связываете `kanban` с данными декларативно в XML-дескрипторе с помощью атрибута `dataContainer`. Этот атрибут должен ссылаться на xref:flow-ui:data/collection-container.adoc[контейнер коллекции], который содержит данные, которые вы хотите отобразить. Смотрите соответствующий <<basic, пример>> в предыдущем разделе.

[[key-value-containers-binding]]
=== Контейнер KeyValue

Также возможно связать `kanban` с контейнером xref:flow-ui:data/key-value-containers.adoc[KeyValue]. Например:

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=data;key-value-collection-container;layout;key-value]
----

[[programmatic-binding]]
=== Программное связывание

Если вам нужно определить контейнер данных программно, необходимо удалить атрибут xref:flow-ui:vc/common-attributes.adoc#dataContainer[dataContainer]:

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=programmatically]
----

После этого в контроллере экрана используйте класс `ContainerKanbanItems`, чтобы связать Kanban с контейнером данных:

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanban/KanbanView.java[tags=kanban;tasksDc;onInit;setItems]
----

[[properties-mapping]]
== Сопоставление свойств

Сопоставление свойств позволяет вам определить, как данные из ваших сущностей отображаются на доске Kanban.

* *Сущность Jmix*: У вас есть сущность Jmix (например, `KanbanTask`), которая представляет задачу в вашем приложении. Эта сущность имеет различные атрибуты, такие как `title`, `status`, `dueDate` и так далее.
* *Карточка Kanban*: Вы хотите визуально отобразить эти атрибуты задачи на карточке Kanban в вашем приложении Jmix.
* *Сопоставление*: Компонент Kanban в Jmix предоставляет механизм для связывания атрибутов сущности с соответствующими полями на карточке Kanban.

Элемент `propertiesMapping` определяет сопоставление свойств сущности с набором полей карточки задачи. Карточка задачи, отображаемая на доске Kanban, имеет предопределенный набор полей:

[cols="1h,6", grid=rows]
|===
|*id*
|Уникальный идентификатор задачи. Обязателен для отображения.
|*status*
|Статус задачи. Должен соответствовать <<columnDataField, dataField>> столбца или подстолбца. Обязателен для отображения.
|*text*
|Текст задачи. Обязателен для отображения.
|*color*
|Цвет, используемый для визуального выделения карточки задачи.
|*dueDate*
|Срок задачи.
|*priority*
|Приоритет задачи.
|*progress*
|Прогресс задачи в процентах, число от 0 до 100.
|*swimlane*
|Определяет полосу задачи, к которой относится задача. Оно должно соответствовать атрибуту <<swimlaneDataField, dataField>> полосы задач, если полосы задач настроены.
|*tags*
|Список тегов, разделенных запятыми.
|*userAvatar*
|Аватар пользователя, назначенного задаче.
|*username*
|Имя пользователя, назначенного задаче.
|===

=== Декларативное сопоставление

Обычно вы сопоставляете `kanban` со свойствами сущности в XML-дескрипторе с помощью элемента <<propertiesMapping, propertiesMapping>>.

Обратите внимание, как задаются значения атрибутов. Значение может быть атрибутом корневой сущности (например, `text = "text"`) или атрибутом ее дочерней сущности (например, `username = "assignee.username"`) -  используйте точечную нотацию для обхода графа объектов.

В следующем примере показан `kanban`, который сопоставлен с некоторыми полями его сущности задачи:

image::properties-mapping.png[align="center',width="800"]

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=properties-mapping-declarative]
----

=== Программное сопоставление

Вы можете определить `propertiesMapping` программно. Для этого не указывайте его в XML-разметке `kanban`. После этого в контроллере экрана установите его с помощью метода `setPropertiesMapping(JmixKanban.PropertiesMapping)`.

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=properties-mapping-programmatic]
----

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanban/KanbanView.java[tags=programmaticPropertiesMappingKanban;onInit;programmaticPropertiesMapping]
----

[[save-delegate]]
== Save Delegate

++++
<div class="jmix-ui-live-demo-container">
    <a href="http://demo.jmix.ru/ui-samples/sample/kanban-data-saving" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Существует три способа изменения данных с помощью компонента `kanban`:

* Изменение атрибута, сопоставленного с <<propertyStatus, status>>, путем перетаскивания карточки задачи Kanban из одного столбца в другой.
* Изменение атрибута, сопоставленного с <<swimlane, swimlane>>, путем перетаскивания карточки задачи Kanban из одной полосы задач в другую.
* Изменение атрибута, сопоставленного с <<propertyPriority, priority>>, путем выбора другого приоритета с помощью соответствующей иконки.

Визуальные компоненты, включая `kanban`, хранят временные изменения в контейнере данных до тех пор, пока не будет запущено действие подтверждения для их фиксации в базе данных.

Чтобы автоматически зафиксировать изменения, когда пользователь редактирует задачи, создайте обработчик для <<saveDelegate, saveDelegate>> и сохраните изменения с помощью xref:data-access:data-manager.adoc[DataManager]:

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=data;collection-container;layout;save-delegate;]
----

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanban/KanbanView.java[tags=kanbanSaveDelegate]
----

[TIP]
====
Чтобы автоматически сохранять изменения `kanban`, вы можете использовать атрибут <<autoSave, autoSave>>.
====

[[actions]]
== Действия

Компонент `kanban` реализует интерфейс `HasActions` и может содержать как стандартные xref:flow-ui:actions/list-actions.adoc[действия списка], так и пользовательские действия. Действия вызываются щелчком по назначенной кнопке.

В следующем примере показано добавление действий к компоненту:

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=kanban-actions]
----

<1> Определите контейнер `hbox` для отображения кнопок действий над компонентом.
<2> Определите стандартное действие `list_create`. Это стандартное действие для создания нового элемента.
<3> Определите пользовательское действие `getInfo`. Значение его атрибута xref:flow-ui:vc/common-attributes.adoc#text[text] будет использоваться в качестве текста кнопки.

image::kanban-actions.png[align="center",width="800"]

[TIP]
====
Чтобы добавить `action` в Jmix Studio, выберите компонент в XML-дескрипторе экрана или в панели структуры *Jmix UI* и нажмите кнопку xref:studio:screen-designer.adoc#add-action[Add->Action] на панели инспектора *Jmix UI*.
====

[[hierarchical-columns]]
== Иерархические столбцы

++++
<div class="jmix-ui-live-demo-container">
    <a href="http://demo.jmix.ru/ui-samples/sample/kanban-hierarchical-columns" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Компонент `kanban` поддерживает иерархические столбцы. Подстолбцы имеют те же свойства, что и столбцы верхнего уровня.

[NOTE]
====
Невозможно использовать подстолбцы и <<swimlanes, полосы задач>> или <<columnsEnum, columnsEnum>> одновременно.
====

В следующем примере показан `kanban` с подстолбцами:

image::hierarchical-columns.png[width=800]

.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=hierarchical-columns]
----
====

[[hierarchy-mode]]
=== Режим иерархии

Отображение иерархических столбцов возможно в двух режимах:

* `COLUMNS` - подстолбцы представлены как вложенные столбцы.
* `TABS` - подстолбцы представлены как текстовые вкладки. В этом случае имеет смысл указать атрибут <<columnSelected, selected>>.

Например:

image::hierarchy-mode.png[align="center",width="800"]

.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=hierarchy-mode]
----
====

[[task-position]]
=== Положение задачи

Иерархические столбцы могут быть отображены также на конечных уровнях. Существует два варианта для положения задач:

* `ALL` - задачи могут отображаться на всех уровнях иерархии столбцов.
* `LEAF` - задачи могут отображаться только на конечном уровне.

Например:

image::task-position.png[align="center",width="800"]

.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=task-position]
----
====

[[renderers]]
== Рендереры

Компонент `kanban` поддерживает настройку отображения карточек. Рендеры можно использовать для настройки отображения заголовка столбца, нижнего колонтитула и текста карточки задачи Kanban.

[[taskRendererFunction]]
=== Рендерер задачи

Рендерер задачи определяется функцией обратного вызова, которую можно использовать для настройки рендеринга задачи. Kanban вызывает ее с двумя аргументами: HTML-элемент задачи и данные задачи.

Например:

image::task-renderer.png[align="center",width="800"]

.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=task-renderer]
----
====

[[columnHeaderRendererFunction]]
=== Рендерер заголовка

Рендерер заголовка определяется функцией обратного вызова, которую можно использовать для настройки рендеринга заголовка столбца. Kanban вызывает ее с тремя аргументами: HTML-элемент заголовка столбца, данные столбца и поле данных столбца.

Например:

image::header-renderer.png[align="center",width="800"]

.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=header-renderer]
----
====

[[columnFooterRendererFunction]]
=== Рендерер нижнего колонтитула

Рендерер нижнего колонтитула определяется функцией обратного вызова, которую можно использовать для настройки рендеринга нижнего колонтитула столбца. Kanban вызывает ее с тремя аргументами: HTML-элемент нижнего колонтитула столбца, данные столбца и поле данных столбца.

Например:

image::footer-renderer.png[align="center",width="800"]

.Показать код
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=footer-renderer]
----
====

[[attributes]]
== Атрибуты

В Jmix  существует множество xref:flow-ui:vc/common-attributes.adoc[общих атрибутов], которые выполняют одинаковую функцию для всех компонентов. Ниже приведены атрибуты, специфичные для `kanban`:

[TIP]
====
Вы можете просматривать и редактировать атрибуты, применимые к компоненту, в Jmix Studio с помощью панели инспектора *Jmix UI*.
====

[cols="1h,5,1", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[applyColumnColorToTasks]]applyColumnColorToTasks
|Если установлено значение `true`, <<columnColor,цвет столбца>> будет применен к карточкам, содержащимся в столбце. Если для карточки задан <<propertyColor,цвет>>, он будет иметь приоритет над цветом столбца.
|`false`
|[[autoColumnHeightEnabled]]autoColumnHeightEnabled
|Если установлено значение `true`, обновляет высоту столбцов в зависимости от задач внутри. Эффект этого свойства наблюдается, когда <<columnColorEntireSurfaceEnabled, columnColorEntireSurfaceEnabled>> имеет значение `true`.
|`false`
|[[autoSave]]autoSave
|Если установлено значение `true`, автоматически устанавливает <<saveDelegate, saveDelegate>>, который сохраняет xref:flow-ui:data/data-context.adoc[DataContext] текущего экрана. Может быть определен только декларативно с помощью XML. Для программной настройки используйте <<saveDelegate, saveDelegate>>. Смотрите http://demo.jmix.io/ui-samples/sample/kanban-data-saving[демонстрацию^] в режиме реального времени.
|`false`
|[[collapsible]]collapsible
|Если установлено значение `true`, включает возможность сворачивания столбца с помощью соответствующей кнопки в заголовке столбца, контекстного меню действий в заголовке столбца или двойного щелчка по заголовку столбца. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|`false`
|[[columnActionsEnabled]]columnActionsEnabled
|Если установлено значение `true`, включает контекстное меню с действиями для каждого столбца. Набор действий в контекстном меню будет зависеть от значения атрибутов <<collapsible, collapsible>> и <<columnHidingAllowed, columnHidingAllowed>>.
|`false`
|[[columnColorEntireSurfaceEnabled]]columnColorEntireSurfaceEnabled
|Если установлено значение `true`, отображает фон в столбце Kanban.
|`false`
|[[columnFooterVisible]]columnFooterVisible
|Если установлено значение `true`, отображает нижний колонтитул столбца, который показывает сводку по столбцу. Работает в сочетании со значением атрибута <<columnSummaryEnabled, columnSummaryEnabled>>.
|`false`
|[[columnHidingAllowed]]columnHidingAllowed
|Если установлено значение `true`, добавляет действия скрытия столбца в контекстное меню заголовка столбца. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|`true`
|[[columnReorderingAllowed]]columnReorderingAllowed
|Если установлено значение `true`, включает возможность переупорядочивания столбцов с помощью действия перетаскивания. Состояние этого атрибута может быть сохранено в xref:flow-ui:facets/settings.adoc[настройках пользователя].
|`false`
|[[columnSummaryEnabled]]columnSummaryEnabled
|Если установлено значение `true`, отображает информацию о количестве задач в заголовке каждого столбца. Информация также может отображаться в нижнем колонтитуле столбца. Смотрите <<columnFooterVisible, columnFooterVisible>>.
|`false`
|[[columnsWidth]]columnsWidth
|Устанавливает ширину всех столбцов в пикселях.
|`0`
|[[dragAllowed]]dragAllowed
|Если установлено значение `true`, включает перетаскивание для столбцов и карточек.
|`true`
|[[dropAllowed]]dropAllowed
|Если установлено значение `true`, включает возможность перетаскивания для столбцов и карточек.
|`true`
|[[dropPlaceholderAllowed]]dropPlaceholderAllowed
|Если установлено значение `true`, то если задача перекрывает другую задачу, для нее появляется пустое пространство.
|`false`
|[[hierarchyMode]]hierarchyMode
|Указывает режим иерархии для вложенных столбцов со следующими возможными значениями: `COLUMNS`, `TABS`. Смотрите раздел <<hierarchy-mode,Режим иерархии>>.
|`COLUMNS`
|[[swimlanesFrom]]swimlanesFrom
|Устанавливает индекс столбца, с которого начинаются полосы задач. Смотрите раздел <<swimlanes,Полосы задач>>.
|`0`
|[[swimlanesTo]]swimlanesTo
|Устанавливает индекс столбца, на котором заканчиваются полосы задач.
|–
|[[taskColorEntireSurfaceEnabled]]taskColorEntireSurfaceEnabled
|Если установлено значение `true`, применяет цвет задачи к фону карточки задачи. Атрибут имеет приоритет над <<columnColor, цветом столбца>>.
|`false`
|[[taskDueDateVisible]]taskDueDateVisible
|Если установлено значение `true`, отображает значок срока задачи. Смотрите <<propertyDueDate, dueDate>>.
|`false`
|[[taskPosition]]taskPosition
|Указывает положение задачи для столбцов со следующими возможными значениями: `ALL`, `LEAF`. Смотрите раздел <<task-position,Положение задачи>>.
|`ALL`
|[[taskPriorityVisible]]taskPriorityVisible
|Если установлено значение `true`, отображает значок приоритета для карточки задачи. Смотрите <<propertyPriority, priority>>.
|`true`
|[[taskProgressVisible]]taskProgressVisible
|Если установлено значение `true`, отображает индикатор выполнения для карточки задачи со значением выполнения задачи. Смотрите <<propertyProgress, progress>>.
|`false`
|[[taskTagsVisible]]taskTagsVisible
|Если установлено значение `true`, отображает теги для карточки задачи. Смотрите <<propertyTags, tags>>.
|`true`
|[[taskUserAvatarVisible]]taskUserAvatarVisible
|Если установлено значение `true`, отображает аватар пользователя для карточки задачи. Смотрите <<propertyUserAvatar, userAvatar>>.
|`false`
|===

[[handlers]]
== Обработчики

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/kanban-events" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

В Jmix существует множество xref:flow-ui:vc/common-handlers.adoc[общих обработчиков], которые конфигурируются одинаково для всех компонентов.

Ниже приведены обработчики, специфичные для `kanban`.

include::flow-ui:vc/handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*Name*
|*Description*
|[[KanbanColumnClickEvent]]KanbanColumnClickEvent
|Событие `KanbanColumnClickEvent` возникает при щелчке по заголовку столбца. Соответствует событию `columnClick` в DOM.
|[[KanbanColumnDoubleClickEvent]]KanbanColumnDoubleClickEvent
|Событие `KanbanColumnDoubleClickEvent` возникает при двойном щелчке по заголовку столбца. Соответствует событию `columnDoubleClick` в DOM.
|[[KanbanColumnCollapseEvent]]KanbanColumnCollapseEvent
|Событие `KanbanColumnCollapseEvent` возникает при сворачивании столбца с помощью меню действий столбца, двойного щелчка по заголовку столбца или программного изменения свойства <<columnCollapsed,collapsed>> столбца. Соответствует событию `columnCollapse` в DOM.
|[[KanbanColumnExpandEvent]]KanbanColumnExpandEvent
|Событие `KanbanColumnExpandEvent` возникает при разворачивании столбца с помощью двойного щелчка по заголовку столбца или программного изменения свойства <<columnCollapsed,collapse>> столбца. Соответствует событию `columnExpand` в DOM.
|[[KanbanColumnHideEvent]]KanbanColumnHideEvent
|Событие `KanbanColumnHideEvent` возникает при скрытии столбца с помощью двойного щелчка по заголовку столбца или программного изменения свойства <<columnCollapsed,collapsed>> столбца. Соответствует событию `columnHide` в DOM.
|[[KanbanColumnReorderEvent]]KanbanColumnReorderEvent
|Событие `KanbanColumnReorderEvent` возникает при изменении порядка столбцов. Соответствует событию `columnReorder` в DOM.
|[[KanbanColumnShowEvent]]KanbanColumnShowEvent
|Событие `KanbanColumnShowEvent` возникает при показе столбца с помощью меню действий столбца или программного изменения свойства <<columnVisible,visible>> столбца. Соответствует событию `columnShow` в DOM.
|[[KanbanDragEndEvent]]KanbanDragEndEvent
|Событие `KanbanDragEndEvent` возникает при перетаскивании карточки задачи. Соответствует событию `dragEnd` в DOM.
|[[KanbanDragStartEvent]]KanbanDragStartEvent
|Событие `KanbanDragStartEvent` возникает при начале перетаскивания карточки задачи. Соответствует событию `dragStart` в DOM.
|[[KanbanTaskClickEvent]]KanbanTaskClickEvent
|Событие `KanbanTaskClickEvent` возникает при щелчке по задаче. Соответствует событию `taskClick` в DOM.
|[[KanbanTaskDoubleClickEvent]]KanbanTaskDoubleClickEvent
|Событие `KanbanTaskDoubleClickEvent` возникает при двойном щелчке по задаче. Соответствует событию `taskDoubleClick` в DOM.
|[[saveDelegate]]saveDelegate
|Добавляет функцию делегата сохранения, которая будет использоваться для сохранения данных, которые были обновлены с помощью Kanban. Вызывается, когда карточка задачи перетаскивается по доске и когда приоритет задачи изменяется с помощью соответствующей иконки. Смотрите раздел <<save-delegate,Save Delegate>>.
|===

[[elements]]
== Элементы Kanban

Элементы внутри `kanban` предоставляют широкий набор опций для управления внешним видом, поведением и функциональностью столбцов.

[TIP]
====
Чтобы добавить элемент к выбранному компоненту, нажмите кнопку xref:studio:screen-designer.adoc#add-column[Add] на панели инспектора *Jmix UI*.
====

[[columns]]
=== Columns

Элемент `columns` может определить набор столбцов для отображения, либо явно, либо с помощью перечисления.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`columns`
|Атрибуты
|<<columnsEnum,columnsEnum>>
|Элементы
|<<column,column>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[columnsEnum]]columnsEnum
|Указывает FQN перечисления, которое будет использоваться в качестве значений столбцов. Значения перечисления будут использоваться в качестве <<columnDataField,dataField>> столбца, а его локализованное значение будет использоваться в качестве <<columnLabel,метки>> столбца. Вложенные столбцы недоступны в этом варианте определения. Смотрите http://demo.jmix.io/ui-samples/sample/kanban-columns-enum[демонстрацию^] в режиме реального времени.
|–
|===

[[column]]
=== Column

Элемент `column` определяет отдельный столбец.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`column`
|Java-класс
|`io.jmix.kanbanflowui.kit.component.KanbanColumn`
|Атрибуты
|<<columnDataField, dataField>> -
<<columnCollapsed, collapsed>> -
<<columnCollapsible, collapsible>> -
<<columnColor, color>> -
<<columnLabel, label>> -
<<columnOrientation, orientation>> -
<<columnReorder, reorder>> -
<<columnSelected, selected>> -
<<columnVisible, visible>> -
<<columnWidth, width>>
|Элементы
|<<columns,columns>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[columnDataField]]dataField
|Устанавливает пользовательский идентификатор для сопоставления этого столбца. `dataField` может быть использован для получения столбца позже с помощью метода `getColumnByDataField(String)`.

`dataField` должен быть уникальным в рамках Kanban и не может быть изменен после его установки. Значение атрибута будет установлено в свойство `status` сущности задачи. Обязательный атрибут.
|–
|[[columnCollapsed]]collapsed
|Если установлено значение `true`, сворачивает столбец.
|`false`
|[[columnCollapsible]]collapsible
|Если установлено значение `true`, включает возможность сворачивания столбца. Атрибут работает в сочетании с атрибутом <<collapsible, collapsible>> Kanban.
|`true`
|[[columnColor]]color
|Устанавливает свойство цвета столбца в виде строки CSS. Цвет применяется к заголовку и может также быть применен к карточкам, расположенным в столбце.
|–
|[[columnLabel]]label
|Устанавливает текст заголовка столбца. Значение атрибута может быть либо текстом, либо ключом в xref:localization:message-bundles.adoc[пакете сообщений]. В случае ключа значение должно начинаться с префикса `msg://`.
|–
|[[columnOrientation]]orientation
|Указывает ориентацию карточек задач внутри столбца со следующими возможными значениями: `VERTICAL`, `HORIZONTAL`.
|`VERTICAL`
|[[columnReorder]]reorder
|Если установлено значение `true`, включает возможность переупорядочивания. Атрибут работает в сочетании с атрибутом <<columnReorderingAllowed, columnReorderingAllowed>> Kanban.
|`true`
|[[columnSelected]]selected
|Если установлено значение `true`, выбирает столбец в режиме иерархии вкладок. Применимо только к подстолбцу, когда <<hierarchyMode, hierarchyMode>> имеет значение `TABS`.
|–
|[[columnVisible]]visible
|Если установлено значение `true`, столбец отображается.
|`true`
|[[columnWidth]]width
|Устанавливает ширину столбца в пикселях.
|–
|===

[[swimlanes]]
=== Swimlanes

CAUTION: Это функция в стадии разработки. Ее внешний вид, а также детали реализации могут значительно измениться в будущих релизах.

Элемент `swimlanes` может определить набор полос задач для отображения, либо явно, либо с помощью перечисления. Полосы задач - это горизонтальные полосы, которые делят карточки задач на области ответственности. Вложенные столбцы недоступны при использовании полос задач.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`swimlanes`
|Атрибуты
|<<swimlanesEnum,swimlanesEnum>>
|Элементы
|<<swimlane,swimlane>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[swimlanesEnum]]swimlanesEnum
|Указывает FQN перечисления, которое будет использоваться в качестве значений полос задач. Значения перечисления будут использоваться в качестве <<swimlaneDataField, dataField>> полосы задач, а его локализованное значение будет использоваться в качестве <<swimlaneLabel, метки>> полосы задач.
|–
|===

[[swimlane]]
=== Swimlane

Элемент `swimlane` определяет отдельную полосу задач.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`swimlane`
|Java-класс
|`io.jmix.kanbanflowui.kit.component.KanbanSwimlane`
|Атрибуты
|<<swimlaneDataField, dataField>> -
<<swimlaneColor, color>> -
<<swimlaneLabel, label>>
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[swimlaneDataField]]dataField
|Устанавливает пользовательский идентификатор для сопоставления этой полосы задач. `dataField` может быть использован для получения полосы задач позже с помощью метода `getSwimlaneByDataField(String)`.

`dataField` должен быть уникальным в рамках Kanban и не может быть изменен после его установки. Обязательный атрибут.
|–
|[[swimlaneColor]]color
|Устанавливает свойство цвета полосы задач в виде строки CSS. Цвет применяется к горизонтальным полосам полосы задач.
|–
|[[swimlaneLabel]]label
|Устанавливает текст заголовка полосы задач. Значение атрибута может быть либо текстом, либо ключом в xref:localization:message-bundles.adoc[пакете сообщений]. В случае ключа значение должно начинаться с префикса `msg://`.
|–
|===

[[propertiesMapping]]
=== PropertiesMapping

Карточки задач Kanban могут отображать определенные поля сущности задачи Kanban. Элемент `propertiesMapping` используется для установки сопоставления свойств сущности с полями карточки. Смотрите <<properties-mapping,пример>>.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`propertiesMapping`
|Java-класс
|`io.jmix.kanbanflowui.kit.component.JmixKanban.PropertiesMapping`
|Атрибуты
|<<propertyId, id>> -
<<propertyStatus, status>> -
<<propertyText, test>> -
<<propertyColor, color>> -
<<propertyDueDate, dueDate>> -
<<propertyPriority, priority>> -
<<propertyProgress, progress>> -
<<propertySwimlane, swimlane>> -
<<propertyTags, tags>> -
<<propertyUserAvatar, userAvatar>> -
<<propertyUsername, username>> -
|===

.Атрибуты
[cols="1h,5,1", grid=rows]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[propertyId]]id
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `id` карточки. `id` используется для идентификации карточки. Обязательный атрибут.
|`id`
|[[propertyStatus]]status
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `status` карточки. `status` используется для упорядочивания карточек в соответствующие столбцы. Обязательный атрибут.
|`status`
|[[propertyText]]text
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `text` карточки. `text` используется в качестве заголовка карточки. Обязательный атрибут.
|`text`
|[[propertyColor]]color
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `color` карточки. `color` применяется к левой границе карточки и также может использоваться в качестве фона с помощью атрибута <<taskColorEntireSurfaceEnabled, taskColorEntireSurfaceEnabled>>.
|–
|[[propertyDueDate]]dueDate
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `dueDate` карточки. `dueDate` отображается на карточке в виде даты. Если `dueDate` в прошлом, карточка будет выделена как просроченная.
|–
|[[propertyPriority]]priority
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `priority` карточки. `priority` отображается на карточке в виде иконки.
|–
|[[propertyProgress]]progress
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `progress` карточки. `progress` отображается на карточке в виде индикатора выполнения.
|–
|[[propertySwimlane]]swimlane
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `swimlane` карточки. `swimlane` используется для упорядочивания карточек в соответствующие полосы задач.
|–
|[[propertyTags]]tags
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `tags` карточки. `tags` отображаются на карточке в виде небольших значков с текстом.
|–
|[[propertyUserAvatar]]userAvatar
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `userAvatar` карточки. `userAvatar` используется для отображения аватара пользователя на карточке.
|–
|[[propertyUsername]]username
|Указывает имя атрибута сущности, которое будет сопоставлено со свойством `username` карточки. `username` используется для отображения ответственного за карточку.
|–
|===

[[see-also]]
== Смотрите также

Смотрите https://www.htmlelements.com/docs/kanban-api/[документацию Kanban^] для получения дополнительной информации.