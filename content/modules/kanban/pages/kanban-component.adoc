= Kanban 组件
:table-caption!:

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/kanban-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`kanban` UI 组件表示一个看板。其中看板列表示项目的不同阶段，项目的任务以卡片的形式展示。

[cols="2h,8", grid=none]
|===
|XML 元素
|`kanban`
|Java 类
|`io.jmix.kanbanflowui.component.Kanban`
|XML 属性
|xref:flow-ui:vc/common-attributes.adoc#id[id] -
xref:flow-ui:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<applyColumnColorToTasks,applyColumnColorToTasks>> -
<<autoColumnHeightEnabled,autoColumnHeightEnabled>> -
<<autoSave,autoSave>> -
xref:flow-ui:vc/common-attributes.adoc#classNames[classNames] -
<<collapsible,collapsible>> -
xref:flow-ui:vc/common-attributes.adoc#colspan[colspan] -
<<columnActionsEnabled,columnActionsEnabled>> -
<<columnColorEntireSurfaceEnabled,columnColorEntireSurfaceEnabled>> -
<<columnFooterVisible,columnFooterVisible>> -
<<columnHidingAllowed,columnHidingAllowed>> -
<<columnReorderingAllowed,columnReorderingAllowed>> -
<<columnSummaryEnabled,columnSummaryEnabled>> -
<<columnsWidth,columnsWidth>> -
xref:flow-ui:vc/common-attributes.adoc#css[css] -
xref:flow-ui:vc/common-attributes.adoc#dataContainer[dataContainer] -
<<dragAllowed,dragAllowed>> -
<<dropAllowed,dropAllowed>> -
<<dropPlaceholderAllowed,dropPlaceholderAllowed>> -
xref:flow-ui:vc/common-attributes.adoc#enabled[enabled] -
xref:flow-ui:vc/common-attributes.adoc#height[height] -
<<hierarchyMode,hierarchyMode>> -
xref:flow-ui:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:flow-ui:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:flow-ui:vc/common-attributes.adoc#minHeight[minHeight] -
xref:flow-ui:vc/common-attributes.adoc#minWidth[minWidth] -
<<swimlanesFrom,swimlanesFrom>> -
<<swimlanesTo,swimlanesTo>> -
<<taskColorEntireSurfaceEnabled,taskColorEntireSurfaceEnabled>> -
<<taskDueDateVisible,taskDueDateVisible>> -
<<taskPosition,taskPosition>> -
<<taskPriorityVisible,taskPriorityVisible>> -
<<taskProgressVisible,taskProgressVisible>> -
<<taskTagsVisible,taskTagsVisible>> -
<<taskUserAvatarVisible,taskUserAvatarVisible>> -
xref:flow-ui:vc/common-attributes.adoc#visible[visible] -
xref:flow-ui:vc/common-attributes.adoc#width[width]
|事件和处理器
|xref:flow-ui:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:flow-ui:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<KanbanColumnClickEvent,KanbanColumnClickEvent>> -
<<KanbanColumnDoubleClickEvent,KanbanColumnDoubleClickEvent>> -
<<KanbanColumnCollapseEvent,KanbanColumnCollapseEvent>> -
<<KanbanColumnExpandEvent,KanbanColumnExpandEvent>> -
<<KanbanColumnHideEvent,KanbanColumnHideEvent>> -
<<KanbanColumnReorderEvent,KanbanColumnReorderEvent>> -
<<KanbanColumnShowEvent,KanbanColumnShowEvent>> -
<<KanbanDragEndEvent,KanbanDragEndEvent>> -
<<KanbanDragStartEvent,KanbanDragStartEvent>> -
<<KanbanTaskClickEvent,KanbanTaskClickEvent>> -
<<KanbanTaskDoubleClickEvent,KanbanTaskDoubleClickEvent>> -
<<saveDelegate,saveDelegate>>
|XML 内部元素
|<<actions,actions>> -
<<columnFooterRendererFunction,columnFooterRendererFunction>> -
<<columnHeaderRendererFunction,columnHeaderRendererFunction>> -
<<columns,columns>> -
<<column,column>> -
<<swimlanes,swimlanes>> -
<<swimlane,swimlane>> -
<<propertiesMapping,propertiesMapping>> -
<<taskRendererFunction,taskRendererFunction>>
|===

[[basic]]
== 基本用法

使用 Jmix Studio 可以创建组件的 `kanban` XML 元素并与 xref:flow-ui:data/data-containers.adoc[数据容器] 绑定。

image::create-kanban-component.png[align="center", width="1318"]

新的 `kanban` 元素会添加至 *Jmix UI* 结构面板和 XML 文件中。与其他 xref:flow-ui:vc/components.adoc[UI 组件] 一样，可以配置 xref:flow-ui:vc/common-attributes.adoc#id[id]、xref:flow-ui:vc/common-attributes.adoc#height[height]、xref:flow-ui:vc/common-attributes.adoc#width[width] 等属性。

[source,xml,indent=0]
----
<kanban:kanban id="kanban"
               height="100%"
               width="100%"/>
----

如果不使用 Studio 的视图设计器，则可以在 XML 中手动声明 `kanban` 命名空间：

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=xmlns]
----

下一步，指定需要展示的数据和列：

* 配置列需要添加带 `columnsEnum` 属性的 <<columns,columns>> 元素。
* 配置实体字段映射需要添加 <<propertiesMapping,propertiesMapping>> 元素。

下面的示例创建了一个基本的 `kanban`：

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=data;collection-container;layout;basic]
----

image::kanban-basic.png[align="center",width="804"]

[[data-binding]]
== 数据绑定

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/kanban-data" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

数据绑定是指将组件与数据容器进行关联。Kanban 可以显示 xref:flow-ui:data/collection-container.adoc[集合容器] 或 xref:flow-ui:data/key-value-containers.adoc[键值对容器] 中的数据。

[[collection-container]]
=== 集合容器

通常，使用 `dataContainer` 属性在 XML 中以声明方式将 `kanban` 与数据绑定。该属性需指向一个 xref:flow-ui:data/collection-container.adoc[集合数据容器]，其中包含要显示的数据。请参阅上面的相关 <<basic, 示例>>。

[[key-value-containers-binding]]
=== 键值对容器

`kanban` 也可以与 xref:flow-ui:data/key-value-containers.adoc[键值对数据容器] 绑定。示例：

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=data;key-value-collection-container;layout;key-value]
----

[[programmatic-binding]]
=== 编程式绑定

如需以编程的方式定义一个数据容器，则需要删除 xref:flow-ui:vc/common-attributes.adoc#dataContainer[dataContainer] 属性：

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=programmatically]
----

然后在视图控制器中，用 `ContainerKanbanItems` 类将看板与数据容器关联：

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanban/KanbanView.java[tags=kanban;tasksDc;onInit;setItems]
----

[[properties-mapping]]
== 属性映射

通过属性映射可以定义实体中的数据如何在看板的卡片中展示。

* *Jmix 实体*：一个 Jmix 实体（例如，`KanbanTask`）用于表示应用程序中的任务。该实体有多个属性，如 `title`、`status`、`dueDate` 等。
* *看板卡片*：需要在应用程序中通过看板卡片展示任务的属性。
* *映射*：Jmix 的 `Kanban` 组件提供一个机制，可以将实体属性关联至看板卡片的特定字段。

`propertiesMapping` 元素定义一组实体属性与任务卡片字段的映射。看板中显示的任务卡片有一组预定义的字段：

[cols="1h,6", grid=rows]
|===
|*id*
|任务的唯一 ID。必需字段。
|*status*
|任务的状态。必须对应列或子列的 <<columnDataField, dataField>>。必需字段。
|*text*
|任务的描述。必需字段。
|*color*
|任务卡片的颜色。
|*dueDate*
|任务的到期时间。
|*priority*
|任务的优先级。
|*progress*
|任务的进度。可以是从 0 到 100 之间的一个数字。
|*swimlane*
|任务的泳道。必须对应泳道定义中泳道的 <<swimlaneDataField, dataField>> 属性，如果存在泳道的话。
|*tags*
|逗号分隔的标签。
|*userAvatar*
|分配该任务的用户头像。
|*username*
|分配该任务的用户名。
|===

=== 声明式映射

通常，`kanban` 实体属性的映射可以用 XML 的 <<propertiesMapping, propertiesMapping>> 元素定义。

请注意这里属性值的设置方式。既可以是根实体的直接属性（`text = "text"`）或子实体的属性（`username = "assignee.username"`）。

下面的示例中，一个 `kanban` 与任务实体的一些字段做了映射：

image::properties-mapping.png[align="center',width="800"]

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=properties-mapping-declarative]
----

=== 编程式映射

`propertiesMapping` 也可以编程式定义，此时不需要在 XML 中添加该元素，而是在视图控制器中，通过 `setPropertiesMapping(JmixKanban.PropertiesMapping)` 方法设置。

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=properties-mapping-programmatic]
----

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanban/KanbanView.java[tags=programmaticPropertiesMappingKanban;onInit;programmaticPropertiesMapping]
----

[[save-delegate]]
== 数据保存代理

++++
<div class="jmix-ui-live-demo-container">
    <a href="http://demo.jmix.io/ui-samples/sample/kanban-data-saving" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

通过 `kanban` 组件修改数据有三种方法：

* 修改映射至 <<propertyStatus, status>> 的属性，可以将看板任务从一列拖放至另一列。
* 修改映射至 <<propertyStatus, swimlane>> 的属性，可以将看板任务从一个泳道拖放至另一泳道。
* 修改映射至 <<propertyPriority, priority>> 的属性，可以通过对应的图标选择不同的优先级。

包括 `kanban` 在内的可视化组件会在数据容器中暂存修改后的数据，直到触发一个确认操作才会提交数据至数据库。

如需在用户编辑任务后自动提交，可以创建一个 <<saveDelegate, saveDelegate>>，并使用 xref:data-access:data-manager.adoc[DataManager] 保存更改：

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=data;collection-container;layout;save-delegate;]
----

[source,java,indent=0]
----
include::../examples/kanban-ex1/src/main/java/com/company/onboarding/view/kanban/KanbanView.java[tags=kanbanSaveDelegate]
----

[TIP]
====
如需自动保存 `kanban` 的改动，还可以使用 <<autoSave, autoSave>> 属性。
====

[[actions]]
== 操作

`kanban` 组件实现了 `HasActions` 接口，可以包含标准的 xref:flow-ui:actions/list-actions.adoc[列表操作] 和自定义操作。通过点击特定的按钮来调用操作。

以下示例演示了如何向组件添加操作：

[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=kanban-actions]
----

<1> 定义一个 `hbox` 容器，在组件上方显示操作按钮。
<2> 定义 `list_create` 标准操作。用于创建新条目。
<3> 定义 `getInfo` 自定义操作。xref:flow-ui:vc/common-attributes.adoc#text[text] 属性的值将作为按钮的文本。

image::kanban-actions.png[align="center",width="800"]

[TIP]
====
如需通过 Jmix Studio 添加 `action`，在 *Jmix UI* 结构面板或视图 XML 中选择组件，然后点击属性面板中的 xref:studio:screen-designer.adoc#add-action[Add->Action]。
====

[[hierarchical-columns]]
== 状态列层级结构

++++
<div class="jmix-ui-live-demo-container">
    <a href="http://demo.jmix.io/ui-samples/sample/kanban-hierarchical-columns" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`kanban` 组件支持具有层级结构的看板列。子列与父列具有相同的属性。

[NOTE]
====
子列无法与 <<swimlanes, swimlanes>> 或 <<columnsEnum, columnsEnum>> 同时使用。
====

下面的示例展示了带子列的 `kanban`：

image::hierarchical-columns.png[width=800]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=hierarchical-columns]
----
====

[[hierarchy-mode]]
=== 层级模式

层级列的展示有两种模式：

* `COLUMNS` - 子列以内部列的形式展示。
* `TABS` - 子列以文本标签页（tab）的形式展示。此时，设置子列的 <<columnSelected, selected>> 属性可以配置默认的选择列。

示例：

image::hierarchy-mode.png[align="center",width="800"]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=hierarchy-mode]
----
====

[[task-position]]
=== 任务位置

层级列可以只显示在叶子节点。任务的显示位置有两个选项：

* `ALL` - 任务可以显示在所有列层级中。
* `LEAF` - 任务仅能显示在列结构的叶子节点中。

示例：

image::task-position.png[align="center",width="800"]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=task-position]
----
====

[[renderers]]
== 渲染器

`kanban` 组件支持对卡片的展示进行自定义。使用渲染器（Renderer）可以自定义列表头、脚注以及看板任务卡片的文字。

[[taskRendererFunction]]
=== 任务渲染器

任务渲染器可以自定义任务的外观，通过一个回调函数定义。回调函数带 2 个参数：任务的 HTML 元素以及任务的数据。

示例：

image::task-renderer.png[align="center",width="800"]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=task-renderer]
----
====

[[columnHeaderRendererFunction]]
=== 列表头渲染器

列表头渲染器可以自定义看板列表头的外观，通过一个回调函数定义。回调函数带 3 个参数：列表头的 HTML 元素、列数据以及列的 dataField。

示例：

image::header-renderer.png[align="center",width="800"]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=header-renderer]
----
====

[[columnFooterRendererFunction]]
=== 列脚注渲染器

列脚注渲染器可以自定义看板列脚注的外观，通过一个回调函数定义。回调函数带 3 个参数：列脚注的 HTML 元素、列数据以及列的 dataField。

示例：

image::footer-renderer.png[align="center",width="800"]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::../examples/kanban-ex1/src/main/resources/com/company/onboarding/view/kanban/kanban-view.xml[tags=footer-renderer]
----
====

[[attributes]]
== XML 属性

在 Jmix 中，所有组件都有一些作用一致的 xref:flow-ui:vc/common-handlers.adoc[通用属性]。下面是 `kanban` 的特殊属性：

[TIP]
====
可以通过 Jmix Studio 的组件属性面板查看和编辑组件的属性。
====

[cols="1h,5,1", grid=rows, frame=none]
|===
|*名称*
|*描述*
|*默认值*
|[[applyColumnColorToTasks]]applyColumnColorToTasks
|如果为 `true`，<<columnColor, 列颜色>> 将会应用到列中的卡片上。如果卡片单独设置了 <<propertyColor, 卡片颜色>>，则优先级高于列颜色。
|`false`
|[[autoColumnHeightEnabled]]autoColumnHeightEnabled
|如果为 `true`，根据列内部的任务更新列的高度。当 <<columnColorEntireSurfaceEnabled, columnColorEntireSurfaceEnabled>> 为 `true` 时，可以看到该属性的效果。
|`false`
|[[autoSave]]autoSave
|如果为 `true`，设置一个 <<saveDelegate, saveDelegate>>，可以自动保存当前视图的 xref:flow-ui:data/data-context.adoc[DataContext]。该属性只能在 XML 中声明式定义。编程中需使用 <<saveDelegate, saveDelegate>>。参考 http://demo.jmix.io/ui-samples/sample/kanban-data-saving[在线示例^]。
|`false`
|[[collapsible]]collapsible
|如果为 `true`，启用收缩列的功能，列的收缩可以通过表头的对应按钮、表头右键菜单项，或双击表头实现。该属性的状态可以在 xref:flow-ui:facets/settings.adoc[用户设置] 中保存。
|`false`
|[[columnActionsEnabled]]columnActionsEnabled
|如果为 `true`，启用列的右键菜单。菜单中的操作依赖 <<collapsible, collapsible>> 和 <<columnHidingAllowed, columnHidingAllowed>> 属性的配置。
|`false`
|[[columnColorEntireSurfaceEnabled]]columnColorEntireSurfaceEnabled
|如果为 `true`，显示看板列的背景。
|`false`
|[[columnFooterVisible]]columnFooterVisible
|如果为 `true`，显示包含列摘要的脚注。与 <<columnSummaryEnabled, columnSummaryEnabled>> 属性结合使用。
|`false`
|[[columnHidingAllowed]]columnHidingAllowed
|如果为 `true`，在列表头邮件菜单中添加隐藏列的操作。该属性的状态可以在 xref:flow-ui:facets/settings.adoc[用户设置] 中保存。
|`true`
|[[columnReorderingAllowed]]columnReorderingAllowed
|如果为 `true`，允许通过拖放操作对列重排序。该属性的状态可以在 xref:flow-ui:facets/settings.adoc[用户设置] 中保存。
|`false`
|[[columnSummaryEnabled]]columnSummaryEnabled
|如果为 `true`，在每列的表头显示任务统计的信息。信息也可以在列脚注中显示。参阅 <<columnFooterVisible, columnFooterVisible>>。
|`false`
|[[columnsWidth]]columnsWidth
|设置所有列的宽度，单位为像素。
|`0`
|[[dragAllowed]]dragAllowed
|如果为 `true`，启用列和卡片的拖拽。
|`true`
|[[dropAllowed]]dropAllowed
|如果为 `true`，启用列和卡片的放置。
|`true`
|[[dropPlaceholderAllowed]]dropPlaceholderAllowed
|如果为 `true`，当一个任务与其他任务重叠时，会显示一个空白区域。
|`false`
|[[hierarchyMode]]hierarchyMode
|配置内部子列的层级模式。选项：`COLUMNS`、`TABS`。参阅 <<hierarchy-mode, 层级模式>>。
|`COLUMNS`
|[[swimlanesFrom]]swimlanesFrom
|设置泳道的起始列的索引位置。参阅 <<swimlanes, 泳道>>。
|`0`
|[[swimlanesTo]]swimlanesTo
|设置泳道的结束列的索引位置。
|-
|[[taskColorEntireSurfaceEnabled]]taskColorEntireSurfaceEnabled
|如果为 `true`，将任务卡片的背景设置为任务的颜色。该属性优先级高于 <<columnColor, 列颜色>>。
|`false`
|[[taskDueDateVisible]]taskDueDateVisible
|如果为 `ture`，显示任务的结束图标。参阅 <<propertyDueDate, dueDate>>。
|`false`
|[[taskPosition]]taskPosition
|设置任务在列中的位置。选项：`ALL`、`LEAF`。参阅 <<task-position, 任务位置>>。
|`ALL`
|[[taskPriorityVisible]]taskPriorityVisible
|如果为 `true`，显示任务卡片中优先级的图标。参阅 <<propertyPriority, priority>>。
|`true`
|[[taskProgressVisible]]taskProgressVisible
|如果为 `true`，显示任务卡片中的任务进度。参阅 <<propertyProgress, progress>>。
|`false`
|[[taskTagsVisible]]taskTagsVisible
|如果为 `true`，显示任务卡片的标签。参阅 <<propertyTags, tags>>。
|`true`
|[[taskUserAvatarVisible]]taskUserAvatarVisible
|如果为 `true`，显示任务卡片中分配人的头像。参阅 <<propertyUserAvatar, userAvatar>>。
|`false`
|===

[[handlers]]
== 事件和处理器

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/kanban-events" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

在 Jmix 中，所有组件都有一些 xref:flow-ui:vc/common-handlers.adoc[通用事件和处理器]，可以按相同的方法设置。下面是 `kanban` 的特殊事件和处理器：

include::flow-ui:vc/handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*名称*
|*描述*
|[[KanbanColumnClickEvent]]KanbanColumnClickEvent
|`KanbanColumnClickEvent` 当点击列表头时触发。对应 `columnClick` DOM 事件。
|[[KanbanColumnDoubleClickEvent]]KanbanColumnDoubleClickEvent
|`KanbanColumnDoubleClickEvent` 当双击列表头时触发。对应 `columnDoubleClick` DOM 事件。
|[[KanbanColumnCollapseEvent]]KanbanColumnCollapseEvent
|`KanbanColumnCollapseEvent` 当列被收起时触发。收起操作可以通过列的操作菜单、双击列表头或编程式修改 <<columnCollapsed, 列的 collapsed>> 属性实现。对应 `columnCollapse` DOM 事件。
|[[KanbanColumnExpandEvent]]KanbanColumnExpandEvent
|`KanbanColumnExpandEvent` 当列被展开时触发。展开操作可以通过双击列表头或编程式修改 <<columnCollapsed, 列的 collapsed>> 属性实现。对应 `columnExpand` DOM 事件。
|[[KanbanColumnHideEvent]]KanbanColumnHideEvent
|`KanbanColumnHideEvent` 当列被隐藏时触发。隐藏操作可以通过双击列表头或编程式修改 <<columnVisible, 列的 visible>> 属性实现。对应 `columnHide` DOM 事件。
|[[KanbanColumnReorderEvent]]KanbanColumnReorderEvent
|`KanbanColumnReorderEvent` 当列的顺序改变时触发。对应 `columnReorder` DOM 事件。
|[[KanbanColumnShowEvent]]KanbanColumnShowEvent
|`KanbanColumnShowEvent` 当列显示时触发。隐藏操作可以通过列的操作菜单或编程式修改 <<columnVisible, 列的 visible>> 属性实现。对应 `columnShow` DOM 事件。
|[[KanbanDragEndEvent]]KanbanDragEndEvent
|`KanbanDragEndEvent` 当放下任务卡片时触发。对应 `dragEnd` DOM 事件。
|[[KanbanDragStartEvent]]KanbanDragStartEvent
|`KanbanDragStartEvent` 当开始拖拽任务卡片时触发。对应 `dragStart` DOM 事件。
|[[KanbanTaskClickEvent]]KanbanTaskClickEvent
|`KanbanTaskClickEvent` 当点击任务时触发。对应 `taskClick` DOM 事件。
|[[KanbanTaskDoubleClickEvent]]KanbanTaskDoubleClickEvent
|`KanbanTaskDoubleClickEvent` 当双击任务时触发。对应 `taskDoubleClick` DOM 事件。
|[[saveDelegate]]saveDelegate
| 添加一个数据保存的代理函数，在使用看板更新数据时通过该函数保存。在通过拖放改变任务卡片状态或点击对应图标修改任务优先级时调用。参阅 <<save-delegate, 保存代理>>。
|===

[[elements]]
== XML 内部元素

`kanban` 内的 XML 元素提供了更多的选项控制列的外观、行为和功能。

[TIP]
====
如需通过 Studio 为选择的组件添加内部元素，可以点击组件属性面板的 xref:studio:screen-designer.adoc#add-column[Add] 按钮。
====

[[columns]]
=== Columns

`columns` 可以定义一组需要展示的列，可以显式设置值或者使用枚举设置。

[cols="1h,6", grid=none]
|===
|XML 元素
|`columns`
|属性
|<<columnsEnum,columnsEnum>>
|XML 内部元素
|<<column,column>>
|===

.XML 属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[columnsEnum]]columnsEnum
|设置列需要使用的枚举类的全限定名称（FQN）。枚举值作为列的 <<columnDataField, dataField>>，值的本地化信息作为列的 <<columnLabel, label>>。使用这种方式定义列时，不支持定义内部的子列。参考 http://demo.jmix.io/ui-samples/sample/kanban-columns-enum[在线示例^]。
|-
|===

[[column]]
=== Column

`column` 元素定义单独的一列。

[cols="1h,6", grid=none]
|===
|XML 元素
|`column`
|Java 类
|`io.jmix.kanbanflowui.kit.component.KanbanColumn`
|XML 属性
|<<columnDataField, dataField>> -
<<columnCollapsed, collapsed>> -
<<columnCollapsible, collapsible>> -
<<columnColor, color>> -
<<columnLabel, label>> -
<<columnOrientation, orientation>> -
<<columnReorder, reorder>> -
<<columnSelected, selected>> -
<<columnVisible, visible>> -
<<columnWidth, width>>
|XML 内部元素
|<<columns,columns>>
|===

.XML 属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[columnDataField]]dataField
|设置该列需要映射的标识符。`dataField` 也可以在后续使用 `getColumnByDataField(String)` 获取列时作为参数。

`dataField` 在一个看板内必须唯一，且设置后不能更改。该属性的值会被设置到任务实体的 `status` 属性。因此是一个必需属性。
|-
|[[columnCollapsed]]collapsed
|如果为 `true`，收起该列。
|`false`
|[[columnCollapsible]]collapsible
|如果为 `true`，启用列的收放功能。该属性应与看板的 <<collapsible, collapsible>> 属性结合使用。
|`true`
|[[columnColor]]color
|设置列的颜色属性，值需要是 CSS 的颜色格式。颜色应用在列的表头标题上，也可以应用到该列内部的卡片上。
|-
|[[columnLabel]]label
|设置列表头的文字。该属性的值可以是一个纯文本，或 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是键值，需要以 `msg://` 开头。
|-
|[[columnOrientation]]orientation
|设置列内部任务卡片的摆放方向，选项：`VERTICAL`（垂直）、`HORIZONTAL`（水平）。
|`VERTICAL`
|[[columnReorder]]reorder
|如果为 `true`，启用该列的可排序功能。与看板的 <<columnReorderingAllowed, columnReorderingAllowed>> 属性结合使用。
|`true`
|[[columnSelected]]selected
|如果为 `true`，在标签页层级模式中选中该列。仅在 <<hierarchyMode, hierarchyMode>> 为 `TABS` 时对子列有效。
|-
|[[columnVisible]]visible
|如果为 `true`，则列可见。
|`true`
|[[columnWidth]]width
|设置列的宽度，单位为像素。
|-
|===

[[swimlanes]]
=== Swimlanes

CAUTION: 该功能在预览阶段。其外观以及实现细节在将来的版本中可能发生重大变化。

`swimlaes` 元素可用于定义泳道，可以显式设置值或者使用枚举设置。泳道是将任务水平划分的横向条纹（责任区域），使用泳道时无法使用子列。

[cols="1h,6", grid=none]
|===
|XML 元素
|`swimlanes`
|XML 属性
|<<swimlanesEnum,swimlanesEnum>>
|XML 内部元素
|<<swimlane,swimlane>>
|===

.XML 属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[swimlanesEnum]]swimlanesEnum
|设置泳道需要使用的枚举类的全限定名称（FQN）。枚举值作为泳道的 <<swimlaneDataField, dataField>>，值的本地化信息作为泳道的 <<swimlaneLabel, label>>。
|-
|===

[[swimlane]]
=== Swimlane

`swimlane` 元素定义单一泳道。

[cols="1h,6", grid=none]
|===
|XML 元素
|`swimlane`
|Java 类
|`io.jmix.kanbanflowui.kit.component.KanbanSwimlane`
|XML 属性
|<<swimlaneDataField, dataField>> -
<<swimlaneColor, color>> -
<<swimlaneLabel, label>>
|===

.XML 属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[swimlaneDataField]]dataField
|设置该泳道需要映射的标识符。`dataField` 也可以在后续使用 `getSwimlaneByDataField(String)` 获取泳道时作为参数。

`dataField` 在一个看板内必须唯一，且设置后不能更改。是必需属性。
|-
|[[swimlaneColor]]color
|设置泳道的颜色。颜色应用于泳道的水平条纹。
|-
|[[swimlaneLabel]]label
|设置泳道的表头文本。该属性的值可以是一个纯文本，或 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是键值，需要以 `msg://` 开头。
|-
|===

[[propertiesMapping]]
=== PropertiesMapping

看板任务卡片可以展示看板任务实体的特定字段。使用 `propertiesMapping` 元素设置实体属性与看板字段的映射关系。参考 <<properties-mapping, 示例>>。

[cols="1h,6", grid=none]
|===
|XML 元素
|`propertiesMapping`
|Java 类
|`io.jmix.kanbanflowui.kit.component.JmixKanban.PropertiesMapping`
|XML 属性
|<<propertyId, id>> -
<<propertyStatus, status>> -
<<propertyText, test>> -
<<propertyColor, color>> -
<<propertyDueDate, dueDate>> -
<<propertyPriority, priority>> -
<<propertyProgress, progress>> -
<<propertySwimlane, swimlane>> -
<<propertyTags, tags>> -
<<propertyUserAvatar, userAvatar>> -
<<propertyUsername, username>> -
|===

.XML 属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[propertyId]]id
|设置实体属性的名称，该属性映射至卡片的 `id` 属性。`id` 是卡片的标识符。必需属性。
|`id`
|[[propertyStatus]]status
|设置实体属性的名称，该属性映射至卡片的 `status` 属性。`status` 用于将卡片分配在不同的看板列。必需属性。
|`status`
|[[propertyText]]text
|设置实体属性的名称，该属性映射至卡片的 `text` 属性。`text` 是卡片的标题。必需属性。
|`text`
|[[propertyColor]]color
|设置实体属性的名称，该属性映射至卡片的 `color` 属性。`color` 是卡片左边框的颜色，通过配置 <<taskColorEntireSurfaceEnabled, taskColorEntireSurfaceEnabled>> 属性也可以作为背景色。
|-
|[[propertyDueDate]]dueDate
|设置实体属性的名称，该属性映射至卡片的 `dueDate` 属性。`dueDate` 在卡片上显示任务的到期时间。如果 `dueDate` 已经逾期，则卡片会高亮显示。
|-
|[[propertyPriority]]priority
|设置实体属性的名称，该属性映射至卡片的 `priority` 属性。`priority` 在卡片上显示为一个优先级图标。
|-
|[[propertyProgress]]progress
|设置实体属性的名称，该属性映射至卡片的 `progress` 属性。`progress` 在卡片上显示为一个进度条。
|-
|[[propertySwimlane]]swimlane
|设置实体属性的名称，该属性映射至卡片的 `swimlane` 属性。`swimlane` 用于将卡片分配在不同的横向泳道中。
|-
|[[propertyTags]]tags
|设置实体属性的名称，该属性映射至卡片的 `tags` 属性。`tags` 在卡片中展示为带文本的小标签。
|-
|[[propertyUserAvatar]]userAvatar
|设置实体属性的名称，该属性映射至卡片的 `userAvatar` 属性。`userAvatar` 在卡片中显示用户的头像。
|-
|[[propertyUsername]]username
|设置实体属性的名称，该属性映射至卡片的 `username` 属性。`username` 在卡片中显示任务的责任人。
|-
|===

[[see-also]]
== 参考

https://www.htmlelements.com/docs/kanban-api/[Kanban 文档^]
