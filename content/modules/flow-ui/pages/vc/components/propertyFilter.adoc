= propertyFilter 属性过滤器
:page-aliases: vcl/components/property-filter.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/property-filter-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`propertyFilter` 可以基于某个 xref:data-model:entities.adoc[entity] 属性定义一个过滤器条件。

该组件可以独立使用或作为 xref:flow-ui:vc/components/genericFilter.adoc[genericFilter] 的一部分使用。

* XML 元素：`propertyFilter`

* Java 类：`PropertyFilter`

== 基本用法

最简单的情况下，`propertyFilter` 有一个输入控件，前面显示要过滤的属性名称和运算符。

image::flow-ui:visual-components/components/property-filter-basics.png[align="center", width="315"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/propertyfilter/property-filter-view.xml[tags=basics]
----
<1> <<dataLoader,dataLoader>>、<<operation,operation>> 和 <<property,property>> 都是必需属性。

该组件可以对加载到数据容器的数据进行过滤。通常与绑定到同一数据容器的 xref:vc/components/dataGrid.adoc[] 或 xref:vc/components/treeDataGrid.adoc[] 结合使用。可以精确控制表格中显示的内容。

== 过滤运算符

组件支持多种过滤 <<operation, 运算符>>。可以限制仅使用某个运算符，也可以通过 <<operationEditable,operationEditable>> 属性让用户在运行时选择运算符。

image::flow-ui:visual-components/components/property-filter-operation-editable.png[align="center", width="340"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/propertyfilter/property-filter-view.xml[tags=operationEditable]
----

组件根据属性类型决定可用的运算符。

== 数据绑定

数据绑定是指将组件与数据容器进行关联。可视化组件或相应数据容器中的更改可以触发彼此的更新。有关详细信息，请参阅 xref:data/data-examples.adoc[]。

属性过滤器可以过滤 xref:data/collection-container.adoc[集合容器] 或 xref:data/key-value-containers.adoc[键值对容器] 容器中的数据。

=== 集合容器

下面的示例展示配置 `propertyFilter` 对集合容器进行过滤：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/propertyfilter/property-filter-view.xml[tags=data;usersDc;layout;binding-collection]
----

=== 键值对集合容器

下面的示例展示配置 `propertyFilter` 对键值对集合容器进行过滤：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/propertyfilter/property-filter-view.xml[tags=data;statusesDc;layout;binding-key-value]
----

== 多重过滤

将多个 `propertyFilter` 组件绑定到单一数据容器可以同时使用多个过滤条件。例如，使用两个组件支持按部门和姓氏进行过滤：

image::flow-ui:visual-components/components/property-filter-multifiltering.png[align="center", width="666"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/propertyfilter/property-filter-view.xml[tags=multiple-filters]
----

== 自定义

还可以显式设置作为输入控件的组件，并设置其属性。这样就可以更改 `propertyFilter` 的默认外观，并使用其他组件提供的额外功能。例如：

image::flow-ui:visual-components/components/property-filter-custom-input-field.png[align="center", width="490"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/propertyfilter/property-filter-view.xml[tags=custom-input-field]
----

== 动态属性

该组件也支持通过 xref:dyn-attr:index.adoc[动态属性] 进行过滤。此时，视图中不需要包含 xref:dyn-attr:dynattr-view.adoc#using-dynamicattributes-facet[dynamicAttributes] facet。

如需指定动态属性，需以 `+` 开头：

[source, xml,indent=0]
----
include::dyn-attr:example$dyn-attr-ex1/src/main/resources/com/company/demo/view/car/car-list-view.xml[tags=property-filter-dynamic-attribute]
----

NOTE: 如果动态属性是一个实体，则不能通过该实体的属性进行过滤。

[[attributes]]
== XML 属性

xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
xref:vc/common-attributes.adoc#ariaLabel[ariaLabel] -
xref:vc/common-attributes.adoc#ariaLabelledBy[ariaLabelledBy] -
<<autoApply,autoApply>> -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
<<dataLoader,dataLoader>> -
<<defaultValue,defaultValue>> -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#errorMessage[errorMessage] -
xref:vc/common-attributes.adoc#focusShortcut[focusShortcut] -
xref:vc/common-attributes.adoc#height[height] -
xref:vc/common-attributes.adoc#helperText[helperText] -
xref:vc/common-attributes.adoc#invalid[invalid] -
<<label,label>> -
<<labelPosition,labelPosition>> -
<<labelVisible,labelVisible>> -
<<labelWidth,labelWidth>> -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<operation,operation>> -
<<operationEditable,operationEditable>> -
<<operationTextVisible,operationTextVisible>> -
<<parameterName,parameterName>> -
<<property,property>> -
xref:vc/common-attributes.adoc#readOnly[readOnly] -
xref:vc/common-attributes.adoc#required[required] -
xref:vc/common-attributes.adoc#requiredMessage[requiredMessage] -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]

[[autoApply]]
=== autoApply

设置该过滤器的条件值改变时，是否会自动在 `DataLoader` 应用新条件。默认为 `true`。

[[dataLoader]]
=== dataLoader

`dataLoader` 是一个必需属性。设置与当前 `propertyFilter` 关联的 xref:flow-ui:data-components.adoc[数据加载器]。

[[defaultValue]]
=== defaultValue

设置过滤条件的默认值。

[[label]]
=== label

设置该过滤器的自定义名称。如果未指定，则根据实体属性名和运算符名自动生成。

NOTE: 如果设置了 `label` 属性。运算符标签或选择器将会隐藏。

[[labelPosition]]
=== labelPosition

`labelPosition` 属性定义过滤器名称的位置：

* `TOP` - 名称展示在属性过滤器的上方。
* `ASIDE` - 名称展示在属性过滤器的旁边。

默认值为 `ASIDE`。

[[labelVisible]]
=== labelVisible

设置 <<label,label>> 是否可见。默认值为 `true`。

[[labelWidth]]
=== labelWidth

设置 <<label,label>> 的宽度。宽度值需要能被浏览器解析，例如，`"100px"` 或 `"2.5em"`。

[[operation]]
=== operation

`operation` 是必需属性，设置过滤运算符。有下列类型：

* `EQUAL` 适合字符串、数字、布尔、日期/时间、引用、枚举属性。结果中的实体实例要满足：其属性列与过滤器中的条件值匹配。
* `NOT_EQUAL` 适合字符串、数字、布尔、日期/时间、引用、枚举属性。结果中的实体实例要满足：其属性列与过滤器中的条件值不匹配。
* `GREATER` 适合数字和日期属性。结果中的实体实例要满足：其属性列大于过滤器中的条件值。
* `GREATER_OR_EQUAL` 适合数字和日期属性。结果中的实体实例要满足：其属性列大于等于过滤器中的条件值。
* `LESS` 适合数字和日期/时间属性。结果中的实体实例要满足：其属性列小于过滤器中的条件值。
* `LESS_OR_EQUAL` 适合数字和日期/时间属性。结果中的实体实例要满足：其属性列小于等于过滤器中的条件值。
* `CONTAINS` 适合字符串属性。结果中的实体实例要满足：其属性列包含过滤器中的条件值。
* `NOT_CONTAINS` 适合字符串属性。结果中的实体实例要满足：其属性列不包含过滤器中的条件值。
* `STARTS_WITH` 适合字符串属性。结果中的实体实例要满足：其属性列以过滤器中的条件值开头。
* `ENDS_WITH` 适合字符串属性。结果中的实体实例要满足：其属性列以过滤器中的条件值结尾。
* `IS_SET` 适合字符串、数字、布尔、日期/时间、引用、枚举属性。该运算符仅检测属性列的数据不是 null。为该运算符生成的 `comboBox` 仅包含两个值：`Yes` 和 `No`。如果用户选择 `Yes`，结果包含实体实例满足：该列有数据。否则，结果包含该列没有数据的实体实例。
* `IS_COLLECTION_EMPTY` 适合集合属性（`@OneToMany`、`@ManyToMany`）。用于检查实体的集合属性是否为空。
* `MEMBER_OF_COLLECTION` 适合集合属性（`@OneToMany`、`@ManyToMany`）。用于过滤实体，检查该实体是否存在于某个集合中。
* `NOT_MEMBER_OF_COLLECTION` 适合集合属性（`@OneToMany`、`@ManyToMany`）。

[[operationEditable]]
=== operationEditable

设置运算符选择器是否展示。可能值 `true` 和 `false`（默认为 `false`）。如果设置 `operationEditable = true`，运算符字段支持在运行时选择运算符。根据属性类型决定可选的运算符列表。

[[operationTextVisible]]
=== operationTextVisible

`operationTextVisible` 属性定义运算符标签是否可见。可能值 `true` 和 `false`（默认为 `true`）。

[[parameterName]]
=== parameterName

`parameterName` 属性设置关联的查询语句中条件使用的参数名称。如果未定义，则随机生成。

[[property]]
=== property

设置关联的实体属性名称或属性路径（例如，`name`、`order`、`order.date`）。

[[handlers]]
== 事件和处理器

xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
xref:vc/common-handlers.adoc#ComponentValueChangeEvent[ComponentValueChangeEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
<<OperationChangeEvent,OperationChangeEvent>> -
<<validator,validator>>

include::../handler-generation-tip.adoc[]

[[OperationChangeEvent]]
=== OperationChangeEvent

当运算符属性变更时发送 `OperationChangeEvent`。

[[validator]]
=== validator

为组件添加 xref:vc/miscellaneous/validator.adoc[validator] 实例。当值无效时，验证器需要抛出 `ValidationException` 异常。示例：

如果预定义的验证器不能满足需要，可以添加自定义的验证器实例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/propertyfilter/PropertyFilterView.java[tags=validator]
----

== XML 内部元素

xref:vc/components/tooltip.adoc[tooltip] -
xref:vc/miscellaneous/validator.adoc[validator]
