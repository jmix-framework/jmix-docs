= treeDataGrid 树形数据网格
:page-aliases: vcl/components/tree.adoc, vcl/components/tree-data-grid.adoc, vcl/components/tree-table.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/data-grid-tree" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

一个展示数据的表格，可以按其中一列折叠。与 xref:vc/components/dataGrid.adoc[] 类似，并支持其大部分功能，但更适合需要直观展示层级的数据集。

[cols="1h,6", grid=none]
|===
|XML 元素
|`treeDataGrid`
|Java 类
|`TreeDataGrid`
|XML 属性
|xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<allRowsVisible, allRowsVisible>> -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
<<columnReorderingAllowed, columnReorderingAllowed>> -
xref:vc/common-attributes.adoc#css[css] -
xref:vc/common-attributes.adoc#dataContainer[dataContainer] -
<<detailsVisibleOnClick, detailsVisibleOnClick>> -
<<dropMode, dropMode>> -
<<editorBuffered, editorBuffered>> -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#height[height] -
<<hierarchyProperty,hierarchyProperty>> -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/components/entityPicker.adoc#metaClass[metaClass] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<multiSort, multiSort>> -
<<multiSortOnShiftClickOnly, multiSortOnShiftClickOnly>> -
<<multiSortPriority, multiSortPriority>> -
<<nestedNullBehavior, nestedNullBehavior>> -
<<pageSize, pageSize>> -
<<rowDraggable, rowDraggable>> -
<<selectionMode, selectionMode>> -
<<showOrphans,showOrphans>> -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]
|事件和处理器
|xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
<<CellFocusEvent, CellFocusEvent>> -
<<CollapseEvent,CollapseEvent>> -
<<ColumnReorderEvent, ColumnReorderEvent>> -
<<ColumnResizeEvent, ColumnResizeEvent>> -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<ExpandEvent,ExpandEvent>> -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
<<GridDragEndEvent,GridDragEndEvent>> -
<<GridDragStartEvent, GridDragStartEvent>> -
<<GridDropEvent, GridDropEvent>> -
<<ItemClickEvent, ItemClickEvent>> -
<<ItemDoubleClickEvent, ItemDoubleClickEvent>> -
<<SortEvent, SortEvent>> -
<<dataGenerator, dataGenerator>> -
<<dragFilter, dragFilter>> -
<<dropFilter, dropFilter>> -
<<enterPressHandler, enterPressHandler>> -
<<partNameGenerator, partNameGenerator>> -
<<tooltipGenerator, tooltipGenerator>>
|XML 内部元素
|xref:flow-ui:vc/components/dataGrid.adoc#actions[actions] - <<columns, columns>> - <<column, column>> - <<context-menu-element, contextMenu>>
|===

== 基本用法

`treeDataGrid` 功能基本上与 xref:flow-ui:vc/components/dataGrid.adoc[dataGrid] 组件一致。

在视图 XML 中声明式定义 `treeDataGrid` 的示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/treedatagrid/tree-data-grid-view.xml[tags=data;departmentsDc;layout;basics]
----

<1> `Department` 实体的 xref:flow-ui:data/collection-container.adoc[集合容器]。
<2> `treeDataGrid` 通过 `dataContainer` 属性与 `departmentsDc` 容器绑定。
<3> `columns` 元素定义在树形网格中展示哪些实体属性。

image::visual-components/components/tree-data-grid-basics.png[align="center", width="563"]

[[actions]]
== 操作

`treeDataGrid` 组件实现了 `HasActions` 接口，可以包含标准 xref:flow-ui:actions/list-actions.adoc[列表操作] 和自定义操作。操作通过相应的按钮或 <<context-menu, 右键菜单>> 调用。

image::visual-components/components/tree-data-grid-actions.png[align="center", width="563"]

[TIP]
====
如需在 Jmix Studio 中添加 `action`，可以在视图 XML 或 *Jmix UI* 结构中选择组件，然后在组件属性面板中点击 xref:studio:screen-designer.adoc#add-action[Add->Action] 按钮。
====

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/treedatagrid/tree-data-grid-view.xml[tags=actions]
----

<1> 定义一个 `hbox` 包含操作按钮。
<2> 定义 `list_create` 标准操作。
<3> 定义 `getInfo` 自定义操作。其 xref:flow-ui:vc/common-attributes.adoc#text[text] 属性的值用于在右键菜单中显示该操作，并作为按钮的标题。
====

[[context-menu]]
== 右键菜单

右键菜单提供了另一种访问 <<actions, 操作>> 的方式。每个操作显示为一个菜单项。

使用 `contextMenu` 元素可以优化菜单项列表，使用分隔符或层次结构进行组织。

image::visual-components/components/tree-data-grid-context-menu.png[align="center", width="563"]

.显示代码
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/treedatagrid/tree-data-grid-view.xml[tags=context-menu]
----
<1> 隐藏菜单中所有的操作。或者使用 xref:vc/common-attributes.adoc#visible[visible] 属性隐藏特定操作。
<2> 为需要的操作显式添加菜单项。
<3> 菜单项互相包含以创建层级结构。

====

== XML 属性

在 Jmix 中，所有组件都有一些作用一致的 xref:vc/common-attributes.adoc[通用属性]。
下面是 `treeDataGrid` 的特殊属性：

[cols="1h,5,1", grid=rows, frame=none]
|===
|*名称*
|*描述*
|*默认值*
|[[allRowsVisible]]allRowsVisible
|如果设置为 `true`，表格会一次显示所有的行，不带滚动条。也就是说，此时不会仅显示那些可见行，等用户滚动到底部才加载更多数据，而是会直接在 DOM 中同时渲染所有的数据。

*如果有大量数据，会有性能问题，此时不推荐使用该功能。*
|`false`
|[[columnReorderingAllowed]]columnReorderingAllowed
|如果设置为 `true`，则用户可以修改表格列的顺序。
|`false`
|[[detailsVisibleOnClick]]detailsVisibleOnClick
|如果设置为 `true`，当用户点击特定行时，显示 xref:flow-ui:vc/components/dataGrid.adoc#item-details[条目详情]。
|`true`
|[[dropMode]]dropMode
|设置行的拖放模式。支持 `BETWEEN`、`ON_TOP`、`ON_TOP_OR_BETWEEN`、`ON_GRID`。该功能可用于行的顺序调整或在不同表格之间拖放数据。
|-
|[[editorBuffered]]editorBuffered
|如果设置为 `true`，则启用缓存模式的 xref:flow-ui:vc/components/dataGrid.adoc#inline-editing[行内编辑]，只有当用户点击保存按钮时才会提交改动。该模式下用户也可以取消修改。在非缓存模式时，改动会自动提交。
|`false`
|[[hierarchyProperty]]hierarchyProperty
|定义引用自身实体属性的名称，即树形结构的键值属性。
|-
|[[multiSort]]multiSort
|如果设置为 `true`，则启用多列排序。
|`false`
|[[multiSortOnShiftClickOnly]]multiSortOnShiftClickOnly
|如果设置为 `true`，仅当按住 `Shift` 键并单击列标题时，才会激活多列排序。
|`false`
|[[multiSortPriority]]multiSortPriority
|设置点击的列添加到排序列中的位置。支持 `PREPEND`、`APPEND`。
|`PREPEND`
|[[nestedNullBehavior]]nestedNullBehavior
|设置解析可能包含 `null` 值的内部属性时的行为。支持 `THROW`、`ALLOW_NULLS`。
|`THROW`
|[[pageSize]]pageSize
|设置每页展示的行数，这个数值也是每次从数据提供器中获取的数量。
|`50`
|[[rowDraggable]]rowDraggable
|如果设置为 `true`，启用表格的行拖放功能。
|`false`
|[[selectionMode]]selectionMode
|设置选择模式。支持 `SINGLE` 和 `MULTI`。
|`SINGLE`
|[[showOrphans]]showOrphans
|如果设置为 `false`，则组件不会显示孤立记录。如果为 `true`，孤立记录会作为树的顶层根节点展示。

孤立记录是指不存在的父记录的子记录。通常这是由于过滤或分页，导致从数据库中仅加载了部分数据造成的。在使用过滤器时，隐藏孤立记录更符合人们的习惯。但是，这样会导致分页有问题，某些页可能是空的或者只有一半数据，所以在使用 `treeDataGrid` 时，最好不要使用 `simplePagination` 组件。

|`false`
|===

== 事件和处理器

在 Jmix 中，所有组件都有一些 xref:vc/common-handlers.adoc[通用事件和处理器]，可以按相同的方法设置。
下面是 `treeDataGrid` 的特殊事件和处理器：

include::../handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*名称*
|*描述*
|[[CellFocusEvent]]CellFocusEvent
|`com.vaadin.flow.component.grid.CellFocusEvent` 当数据网格的某个单元格获得焦点时发送。对应 `grid-cell-focus` DOM 事件。
|[[CollapseEvent]]CollapseEvent
|`com.vaadin.flow.component.treegrid.CollapseEvent` 当节点收起时发送。
|[[ColumnReorderEvent]]ColumnReorderEvent
|`com.vaadin.flow.component.grid.ColumnReorderEvent` 当数据网格的列重排时发送。对应 `column-reorder-all-columns` DOM 事件。
|[[ColumnResizeEvent]]ColumnResizeEvent
|`com.vaadin.flow.component.grid.ColumnResizeEvent` 当用户改变数据网格列大小时发送。对应 `column-drag-resize` DOM 事件。
|[[ExpandEvent]]ExpandEvent
|`com.vaadin.flow.component.treegrid.ExpandEvent` 当节点展开时发送。
|[[GridDragEndEvent]]GridDragEndEvent
|`com.vaadin.flow.component.grid.dnd.GridDragEndEvent` 当数据网格的行拖放结束时发送。对应 `grid-dragend` DOM 事件。
|[[GridDragStartEvent]]GridDragStartEvent
|`com.vaadin.flow.component.grid.dnd.GridDragStartEvent` 当数据网格的行拖放开始时发送。对应 `grid-dragstart` DOM 事件。
|[[GridDropEvent]]GridDropEvent
|`com.vaadin.flow.component.grid.dnd.GridDropEvent` 当拖放至数据网格或数据行时发送。对应 `grid-drop` DOM 事件。
|[[ItemClickEvent]]ItemClickEvent
|`com.vaadin.flow.component.grid.ItemClickEvent` 当点击数据网格条目时发送。对应 `item-click` DOM 事件。
|[[ItemDoubleClickEvent]]ItemDoubleClickEvent
|`com.vaadin.flow.component.grid.ItemDoubleClickEvent` 当双击数据网格条目时发送。对应 `item-double-click` DOM 事件。
|[[SortEvent]]SortEvent
|`com.vaadin.flow.data.event.SortEvent` 描述 `DataProvider` 中排序变化的事件。由 `SortNotifiers` 触发。
|[[dataGenerator]]dataGenerator
|为数据网格添加数据生成器。如果已经添加，则不做操作。参考 `com.vaadin.flow.data.provider.HasDataGenerators` 接口。
|[[dragFilter]]dragFilter
|用于控制特定行是否可拖放，而不是通过 <<rowDraggable, rowDraggable>> 设置所有行的拖放。
|[[dropFilter]]dropFilter
|用于设置哪些行可以作为拖放的目的地。
|[[enterPressHandler]]enterPressHandler
|用户按下回车键的处理器。
|[[partNameGenerator]]partNameGenerator
|按照条件为单元格生成 CSS 类的 part。可以根据数据自定义单元格的外观。
|[[tooltipGenerator]]tooltipGenerator
|按照给定条件为列单元格生成提示窗。参考 https://demo.jmix.io/ui-samples/sample/data-grid-tooltip-generator[在线示例^]。
|===


== XML 内部元素

`dataGrid` 的 XML 内部元素提供很多选项来控制列的外观、行为和功能，既可以集中控制列，也可以单独控制列的功能。

[TIP]
====
如需为选择的组件添加内部元素，可以使用 *Jmix UI* 组件属性面板中的 xref:studio:screen-designer.adoc#add-column[Add] 按钮添加。
====

[[columns]]
=== columns

`columns` 元素可以设置一组需要展示的属性，并设置所有列的行为。

[cols="1h,6", grid=none]
|===
|XML 元素
|`columns`
|属性
|<<exclude,exclude>> - <<includeAll,includeAll>> - <<resizable-columns,resizable>> - <<sortable-columns,sortable>>
|XML 内部元素
|<<column,column>>
|===

.属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[exclude]]exclude
|排除特定的属性卡不予展示。多个属性需要使用逗号分隔。示例：`exclude = "id, version, sortValue"`。
|-
|[[includeAll]]includeAll
|如果为 `true`，则包含数据容器 fetch plan 中的所有属性。
|-
|[[resizable-columns]]resizable
|如果设置为 `true`，所有列都支持用户改变宽度。
|`false`
|[[sortable-columns]]sortable
|如果设置为 `true`，所有列都支持排序。
|`true`
|===

[[column]]
=== column

`column` 元素定义一个单独的列。为单独列设置的属性会覆盖为所有列设置的属性。

[cols="1h,6", grid=none]
|===
|XML 元素
|`column`
|属性
|<<autowidth,autowidth>> - <<editable,editable>> - <<filterable,filterable>> - <<flexGrow,flexGrow>> - <<footer,footer>> - <<frozen,frozen>> - <<header,header>> - <<key,key>> - <<property,property>> - <<resizable-column,resizable>> - <<sortable-column,sortable>> - <<textAlign,textAlign>> - <<visible,visible>> - <<width,width>>
|事件和处理器
|xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] - <<DataGridColumnVisibilityChangedEvent,DataGridColumnVisibilityChangedEvent>> - xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] - <<partNameGenerator-column,partNameGenerator>> - <<renderer,renderer>> - <<tooltipGenerator-column,tooltipGenerator>>
|XML 内部元素
|xref:vc/components/dataGrid.adoc#aggregating[Aggregation] - xref:vc/components/dataGrid.adoc#local-date-renderer[LocalDateRenderer] - xref:vc/components/dataGrid.adoc#local-date-time-renderer[LocalDateTimeRenderer] - xref:vc/components/dataGrid.adoc#number-renderer[NumberRenderer]
|===

.属性
[cols="1h,5,1", grid=rows]
|===
|*名称*
|*描述*
|*默认值*
|[[autowidth]] autoWidth
|如果设置为 `true`，列宽根据内容自动调整。
|`false`
|[[editable]]editable
|如果设置为 `true`，列可编辑。参阅 xref:vc/components/dataGrid.adoc#inline-editing[行内编辑]。
|`false`
|[[filterable]]filterable
|如果设置为 `true`，启用该列的过滤。参阅 xref:vc/components/dataGrid.adoc#column-filtering[表头过滤]。
|`false`
|[[flexGrow]]flexGrow
|设置列的 flex grow 比例。当设置为 `0` 时，列宽固定。
|`0`
|[[footer]]footer
|为列设置一个 footer 文本。该属性可以是文本本身或者 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是消息包键值，则必须以 `msg://` 开头。
| -
|[[frozen]]frozen
|如果设置为 `true`，则锁住该列。用户在水平滚动表格时会一直显示锁住的列。建议从左至右依次锁定列。
|`false`
|[[header]]header
|为列设置一个 header 文本。该属性可以是文本本身或者 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是消息包键值，则必须以 `msg://` 开头。
| -
|[[key]]key
|设置用户定义的列映射 id。这个键值可以用来通过 `getColumnByKey(String)` 方法获取该列。

键值必须在同一个数据网格中唯一，设定后不能更改。
|-
|[[property]]property
|指定列中需要显示的实体属性。可以是根实体的属性 `property = "user"`，也可以是子实体的属性 `property = "user.department.name"`（并通过 “.” 变量对象图）。
|-
|[[resizable-column]]resizable
|如果设置为 `true`，用户可以手动调整列宽。
|`false`
|[[sortable-column]]sortable
|如果设置为 `true`，列可排序。
|`false`
|[[textAlign]]textAlign
|设置文本的对其方式，支持 `START`、`CENTER`、`END`。参考文本对齐。
|`START`
|[[visible]]visible
|如果设置为 `true`，则列可见。
|`true`
|[[width]]width
|用 CSS 字符串设置列宽。
|-
|===

.事件和处理器
[cols="1h,6", grid=rows]
|===
|*名称*
|*描述*
|[[DataGridColumnVisibilityChangedEvent]]DataGridColumnVisibilityChangedEvent
|通过 xref:flow-ui:vc/components/gridColumnVisibility.adoc[] 组件修改列可见性时发送。
|[[partNameGenerator-column]]partNameGenerator
|按照给定条件为列生成 CSS 类的 part。此功能可以根据展示的数据修改单元格的外观。参考 https://demo.jmix.io/ui-samples/sample/data-grid-part-name-generator[在线示例^]。
|[[renderer]]renderer
|使用文本或组件选人列内容。参阅 xref:vc/components/dataGrid.adoc#text-renderer[文本渲染器] 和 xref:vc/components/dataGrid.adoc#component-renderer[组件渲染器]。
|[[tooltipGenerator-column]]tooltipGenerator
|按照给定条件为列生成提示窗。参考 https://demo.jmix.io/ui-samples/sample/data-grid-tooltip-generator[在线示例^]。
|===

[[context-menu-element]]
=== contextMenu

`contextMenu` 元素可以使用与其默认排列方式不同的方式组织右键菜单的条目。请参阅 <<context-menu, 示例>>。

[cols="1h,6", grid=none]
|===
|XML 元素
|`contextMenu`
|属性

|xref:vc/common-attributes.adoc#id[id] - xref:vc/common-attributes.adoc#classNames[classNames] - xref:vc/common-attributes.adoc#css[css] - xref:vc/common-attributes.adoc#enabled[enabled] - xref:vc/common-attributes.adoc#visible[visible]
|事件和处理器
|xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] - xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] - <<GridContextMenuOpenedEvent,GridContextMenuOpenedEvent>> - <<openedChangeEvent,openedChangeEvent>> - <<dynamicContentHandler,dynamicContentHandler>>
|XML 内部元素
|item - separator
|===

.事件和处理器
[cols="1h,6", grid=rows]
|===
|*名称*
|*描述*
|[[GridContextMenuOpenedEvent]]GridContextMenuOpenedEvent
|当右键菜单的打开状态变化时触发。可以返回目标菜单项本身或 id，能根据点击事件调整菜单项的展示。
|[[openedChangeEvent]]openedChangeEvent
|当右键菜单的打开状态变化时触发。
|[[dynamicContentHandler]]dynamicContentHandler
|在菜单打开时处理菜单的动态更新，例如添加菜单项或其内容。请参阅 xref:vc/components/dataGrid.adoc#context-menu[示例]。
|===

== 参考

{vaadin-docs}/components/tree-grid[Vaadin 文档^]
