= entityComboBox 实体下拉框

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/entity-combobox" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`entityComboBox` 支持用户从一个下拉列表中选择单一 xref:data-model:entities.adoc[实体] 实例。该组件还可以提供针对该实例进行的额外操作。

事实上，`entityComboBox` 是 xref:flow-ui:vc/components/comboBox.adoc[comboBox] 和 xref:flow-ui:vc/components/entityPicker.adoc[entityPicker] 的组合。

* XML 元素：`entityComboBox`

* Java 类：`EntityComboBox`

== 基本用法

满足下列情况可以使用 `entityComboBox`：

* 字段值是实体实例。
* 用户需要选择单一选项。
* 如果选项列表对于 xref:flow-ui:vc/components/radioButtonGroup.adoc[radioButtonGroup] 或 xref:flow-ui:vc/components/listBox.adoc[listBox] 太长时，用下拉列表更方便。
* 用户需要对关联的实体实例做一些操作。

`entityComboBox` 是一个带有实体实例滚动列表的文本控件。支持自定义和预定义的操作：

image::visual-components/components/entity-combobox-basics.png[align="center", width="280"]

如需创建连接至数据的 `entityComboBox`，可以用 XML 的 xref:vc/common-attributes.adoc#dataContainer[dataContainer] 和 xref:vc/common-attributes.adoc#property[property] 属性。而 <<itemsContainer,itemsContainer>> 属性用来创建选项列表：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/entitycombobox/entity-combobox-view.xml[tags=data;userDc;departmentsDc;layout;basics]
----

<1> `InstanceContainer` - `User` 主实体。
<2> 数据容器内实体的 fetch plan。
<3> `CollectionContainer` - `Department` 实体列表容器。
<4> `entityComboBox` 将 `departmentsDc` 作为选项容器，展示部门列表。

NOTE: 如果选项数量很大（数千或更多），请不要使用 `entityComboBox`。`entityComboBox` 会将全部选项列表加载到用户的浏览器和服务器内存中。如需从大量选项列表中进行选择，请使用 xref:flow-ui:vc/components/entityPicker.adoc[EntityPicker]。

[[actions]]
== 操作

`entityComboBox` 初始化时并不带任何操作，需要显式地添加，示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/entitycombobox/entity-combobox-view.xml[tags=actions]
----

[TIP]
====
如需在 Jmix Studio 中添加 `action`，可以在视图 XML 或者 *Jmix UI* 层级结构面板中选择组件，然后在组件面板点击 xref:studio:view-designer.adoc#add-picker-action[Add->Action] 按钮。
====

自定义和预定义操作的详细信息请参阅 `entityPicker` 的 xref:flow-ui:vc/components/entityPicker.adoc#actions[操作] 部分。

// [[filtering]]
// == 自定义过滤

// `entityComboBox` 的过滤特性默认配置为仅展示包含输入内容的选项。同时也支持自定义过滤，例如，如果想展示以用户输入内容开头的选项：

// [source,java,indent=0]
// ----
// include::example$/onboarding/src/main/java/com/company/onboarding/view/component/entitycombobox/EntityComboBoxView.java[tags=departmentsDc;filterEntityComboBox;filter]
// ----

== XML 属性

xref:vc/common-attributes.adoc#id[id] -
<<allowCustomValue,allowCustomValue>> -
xref:vc/common-attributes.adoc#allowedCharPattern[allowedCharPattern] -
xref:vc/components/comboBox.adoc#autoOpen[autoOpen] -
xref:vc/common-attributes.adoc#autofocus[autofocus] -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#dataContainer[dataContainer] -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#errorMessage[errorMessage] -
xref:vc/common-attributes.adoc#height[height] -
xref:vc/common-attributes.adoc#helperText[helperText] -
xref:vc/common-attributes.adoc#invalid[invalid] -
<<itemsContainer,itemsContainer>> -
xref:vc/common-attributes.adoc#label[label] -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/components/entityPicker.adoc#metaClass[metaClass] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<opened,opened>> -
xref:vc/components/comboBox.adoc#pageSize[pageSize] -
xref:vc/common-attributes.adoc#pattern[pattern] -
xref:vc/common-attributes.adoc#placeholder[placeholder] -
xref:vc/common-attributes.adoc#property[property] -
xref:vc/common-attributes.adoc#readOnly[readOnly] -
xref:vc/common-attributes.adoc#required[required] -
xref:vc/common-attributes.adoc#requiredIndicatorVisible[requiredIndicatorVisible] -
xref:vc/common-attributes.adoc#requiredMessage[requiredMessage] -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#title[title] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]

[[allowCustomValue]]
=== allowCustomValue

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://vaadin.com/docs/latest/components/combo-box/#custom-value-entry" class="vaadin-docs-btn" target="_blank">Vaadin</a>
</div>
++++

如果 `allowCustomValue` 属性为 `true`，用户可以输入不匹配任何选项的字符串值，此时会触发 <<CustomValueSetEvent,CustomValueSetEvent>>。

注意，`entityComboBox` 不会自动处理自定义字符串。请使用 `CustomValueSetEvent` 进行处理。

默认值为 `false`。

[[itemsContainer]]
=== itemsContainer

设置包含选项列表的数据容器名称。组件将实体的 xref:data-model:entities.adoc#instance-name[实例名] 作为选项展示。

[[opened]]
=== opened

设置下拉列表是否默认打开。

默认值为 `false`。

== 事件和处理器

xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
xref:vc/common-handlers.adoc#ComponentValueChangeEvent[ComponentValueChangeEvent] -
<<CustomValueSetEvent,CustomValueSetEvent>> -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
xref:vc/components/comboBox.adoc#itemLabelGenerator[itemLabelGenerator] -
xref:vc/common-handlers.adoc#statusChangeHandler[statusChangeHandler] -
xref:vc/components/textField.adoc#validator[validator]

include::../handler-generation-tip.adoc[]

[[CustomValueSetEvent]]
=== CustomValueSetEvent

当用户输入非空值，且不匹配任何已有选项时，发出 `com.vaadin.flow.component.combobox.ComboBoxBase.CustomValueSetEvent` 事件。如需启用自定义输入，请设置 <<allowCustomValue,allowCustomValue>> 属性为 `true`。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/entitycombobox/entity-combobox-view.xml[tags=departmentField]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/entitycombobox/EntityComboBoxView.java[tags=departmentsDc;departmentField;dataManager;CustomValueSetEvent]
----

<1> 创建一个新实例合并至上下文。
<2> 为新创建的 `department` 实体设置名称。
<3> 添加合并的实体。

== XML 内部元素

<<actions,actions>> -
xref:vc/components/tooltip.adoc[tooltip] -
xref:vc/miscellaneous/validator.adoc[validator]
