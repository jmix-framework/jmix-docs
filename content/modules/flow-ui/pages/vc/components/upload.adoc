= upload
:page-aliases: vcl/components/file-multi-upload-field.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/upload" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Компонент `upload` позволяет пользователям загружать один или несколько файлов. Он отображает прогресс загрузки и статус каждого файла. Файлы можно загрузить, нажав кнопку *Upload files* или перетащив их в компонент.

[cols="1h,6", grid=none]
|===
|XML-элемент
|`upload`
|Java-класс
|`JmixUpload`
|Атрибуты
|xref:vc/common-attributes.adoc#id[id] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#acceptedFileTypes[acceptedFileTypes] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<autoUpload,autoUpload>> -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#dropAllowed[dropAllowed] -
<<dropLabel,dropLabel>> -
<<dropLabelIcon,dropLabelIcon>> -
xref:vc/common-attributes.adoc#height[height] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#maxFileSize[maxFileSize] -
<<maxFiles,maxFiles>> -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<receiverFqn,receiverFqn>> -
<<receiverType,receiverType>> -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#uploadIcon[uploadIcon] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#uploadText[uploadText] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]
|Обработчики
|<<AllFinishedEvent,AllFinishedEvent>> -
xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<FailedEvent,FailedEvent>> -
<<FileRejectedEvent,FileRejectedEvent>> -
<<FinishedEvent,FinishedEvent>> -
<<ProgressUpdateEvent,ProgressUpdateEvent>> -
<<StartedEvent,StartedEvent>> -
<<SucceededEvent,SucceededEvent>> -
<<receiver,receiver>>
|===

== Основы

Пример использования компонента `upload`:

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/upload/upload-view.xml[tags=basics]
----

image::visual-components/components/upload-basics.png[align="center", width="332"]

[[auto-upload]]
== Автозагрузка

Атрибут `autoUpload` определяет, должны ли файлы загружаться автоматически сразу после выбора или же пользователю необходимо явно инициировать загрузку.

* Если значение `true`, файлы загружаются сразу после выбора. Отображается индикатор прогресса загрузки, и пользователь может отменить загрузку, если это необходимо.
* Если значение `false`, файлы не загружаются автоматически. Пользователю необходимо нажать кнопку *Upload*, чтобы запустить процесс загрузки.

Значение по умолчанию - `true`.

[[drag-drop]]
== Drag & Drop

Компонент `upload` поддерживает функциональность перетаскивания, позволяя пользователям загружать файлы, просто перетаскивая их из своей файловой системы и сбрасывая на компонент.

Функциональность drag & drop включена по умолчанию. Чтобы отключить ее, установите атрибут xref:flow-ui:vc/components/fileStorageUploadField.adoc#dropAllowed[dropAllowed] в значение `false`.

Атрибут `dropLabel` позволяет настроить сообщение, которое подсказывает пользователям сбросить файлы в область загрузки.

Значение атрибута может быть либо самим текстом, либо ключом в xref:localization:message-bundles.adoc[пакете сообщений]. В случае ключа, значение должно начинаться с префикса `msg://`.

Атрибут `dropLabelIcon` позволяет указать иконку, который будет отображаться вместе с текстом `dropLabel`.

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/upload/upload-view.xml[tags=drag-drop]
----

image::visual-components/components/upload-drag-drop.png[align="center", width="395"]

[[file-count]]
== Лимит файлов

По умолчанию, компонент `upload` не имеет ограничения на количество загружаемых файлов. Вы можете установить лимит количества файлов с помощью атрибута `maxFiles`.

Этот атрибут задает максимальное количество файлов для загрузки. Если значение установлено в единицу, то стандартный файловый браузер не позволит выбрать несколько файлов.

Исключения, которые возникают, по умолчанию не отображаются в пользовательском интерфейсе. Используйте событие <<FileRejectedEvent,FileRejectedEvent>> для перехвата этих исключений и, например, уведомление, чтобы проинформировать пользователя о проблеме.

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/upload/UploadView.java[tags=notifications;FileRejectedEvent]
----

[[receivers]]
== Обработчики файлов

Атрибут `receiverFqn` задает полное имя Java-класса, который будет обрабатывать загруженные файлы. Этот класс должен реализовывать интерфейс `Receiver`.

NOTE: Если обработчик не реализует интерфейс `MultiFileReceiver`, то загрузка будет автоматически настроена на прием только одного файла.

Атрибут `receiverType` определяет тип обработчика, используемого для обработки загруженных файлов. Он определяет, как загруженные файлы будут обрабатываться и храниться. Доступные значения:

* `MemoryBuffer`
+
Обрабатывает загрузку одного файла за раз. Записывает данные файла в буфер в памяти. Использование `MemoryBuffer` автоматически настраивает компонент так, чтобы можно было выбрать только один файл.
* `MultiFileMemoryBuffer`
+
Обрабатывает загрузку нескольких файлов одновременно. Записывает данные файлов в набор буферов в памяти.
* `FileTemporaryStorageBuffer`
+
Обрабатывает загрузку одного файла за раз. Сохраняет файл во xref:files:file-storage.adoc[временное хранилище]. Использование `FileTemporaryStorageBuffer` автоматически настраивает компонент так, чтобы можно было выбрать только один файл.
* `MultiFileTemporaryStorageBuffer`
+
Обрабатывает загрузку нескольких файлов одновременно. Для каждого файла он сохраняет его во временное хранилище.

Тип обработчика по умолчанию - `MemoryBuffer`.

== Атрибуты

В Jmix есть множество xref:vc/common-attributes.adoc[общих атрибутов], которые выполняют одну и ту же функцию для всех компонентов.

Ниже приведены атрибуты, специфичные для `upload`:

[cols="1h,5,1", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[autoUpload]]autoUpload
|Устанавливает, разрешает ли компонент начать загрузку сразу после выбора файлов. Смотрите <<auto-upload,Автозагрузка>>.
|`true`
|[[dropLabel]]dropLabel
|Задает текст подсказки, которая отображается пользователю, чтобы он мог сбросить файлы в компонент `upload`. Смотрите <<drag-drop,Drag & Drop>>.
|
|[[dropLabelIcon]]dropLabelIcon
|Устанавливает иконку для подсказки. Смотрите <<drag-drop,Drag & Drop>>.
|
|[[maxFiles]]maxFiles
|Задает максимальное количество файлов для загрузки. Смотрите <<file-count,Лимит файлов>>.
|unlimited
|[[receiverFqn]]receiverFqn
|Устанавливает реализацию обработчика, которая должна использоваться для этого компонента `upload`. Смотрите <<receivers,Обработчики файлов>>.
|
|[[receiverType]]receiverType
|Задает тип реализации `Receiver`. Смотрите <<receivers,Обработчики файлов>>.
|`MemoryBuffer`
|===

== Обработчики

В Jmix существует множество xref:vc/common-handlers.adoc[общих обработчиков], которые конфигурируются одинаково для всех компонентов.

Ниже приведены обработчики, специфичные для `upload`.

include::../handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|[[AllFinishedEvent]]AllFinishedEvent
|Событие `com.vaadin.flow.component.upload.AllFinishedEvent` отправляется, когда `upload` обработал все файлы в очереди загрузки, независимо от того, были ли все операции приема успешными или нет.
|[[FailedEvent]]FailedEvent
|Событие `com.vaadin.flow.component.upload.FailedEvent` отправляется, когда загрузка принята, но прием был прерван по какой-либо причине.
|[[FileRejectedEvent]]FileRejectedEvent
|Событие `com.vaadin.flow.component.upload.FileRejectedEvent` отправляется, когда выбранный для загрузки файл не соответствует ограничениям, заданным для загрузки, например, xref:flow-ui:vc/components/fileStorageUploadField.adoc#maxFileSize[ограничение размера файла] или <<maxFiles,ограничение количества файлов>>. Смотрите <<file-count,Лимит файлов>>.
|[[FinishedEvent]]FinishedEvent
|Событие `com.vaadin.flow.component.upload.FinishedEvent` отправляется, когда `upload` получает файл, независимо от того, была ли операция приема успешной или завершилась с ошибкой. Если вы хотите различать эти два случая, используйте <<SucceededEvent,SucceededEvent>> или <<FailedEvent,FailedEvent>>, которые являются подклассами `FinishedEvent`.
|[[ProgressUpdateEvent]]ProgressUpdateEvent
|Событие `com.vaadin.flow.component.upload.ProgressUpdateEvent` отправляется для отслеживания прогресса загрузки.
|[[StartedEvent]]StartedEvent
|Событие `com.vaadin.flow.component.upload.StartedEvent` отправляется, когда загрузка запускается для приема.
|[[SucceededEvent]]SucceededEvent
|Событие `com.vaadin.flow.component.upload.SucceededEvent` отправляется, когда загрузка успешно завершена.
Наш демонстрационный проект Samples содержит https://demo.jmix.io/ui-samples/sample/upload[пример использования^] `MultiFileMemoryBuffer` для управления несколькими файлами в `com.vaadin.flow.component.upload.SucceededEvent`.
|[[receiver]]receiver
|Устанавливает реализацию обработчика, которая должна использоваться для этого компонента `upload`. Смотрите атрибуты <<receiverFqn,receiverFqn>> и <<receiverType,receiverType>>.
|===

== Смотрите также

Смотрите {vaadin-docs}/components/upload[документацию Vaadin^] для получения дополнительной информации.