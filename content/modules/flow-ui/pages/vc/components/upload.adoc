= upload 上传

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/upload" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`upload` 支持用户上传一个或多个文件，并显示每个文件的上传进度和状态。可以通过单击 *Upload files* 按钮或将文件拖放至组件进行上传。

[cols="1h,6", grid=none]
|===
|XML 元素
|`upload`
|Java 类
|`JmixUpload`
|XML 属性
|xref:vc/common-attributes.adoc#id[id] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#acceptedFileTypes[acceptedFileTypes] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<autoUpload,autoUpload>> -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#dropAllowed[dropAllowed] -
<<dropLabel,dropLabel>> -
<<dropLabelIcon,dropLabelIcon>> -
xref:vc/common-attributes.adoc#height[height] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#maxFileSize[maxFileSize] -
<<maxFiles,maxFiles>> -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<receiverFqn,receiverFqn>> -
<<receiverType,receiverType>> -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#uploadIcon[uploadIcon] -
xref:flow-ui:vc/components/fileStorageUploadField.adoc#uploadText[uploadText] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]
|事件和处理器
|<<AllFinishedEvent,AllFinishedEvent>> -
xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
<<FailedEvent,FailedEvent>> -
<<FileRejectedEvent,FileRejectedEvent>> -
<<FinishedEvent,FinishedEvent>> -
<<ProgressUpdateEvent,ProgressUpdateEvent>> -
<<StartedEvent,StartedEvent>> -
<<SucceededEvent,SucceededEvent>> -
<<receiver,receiver>>
|===

== 基本用法

`upload` 的示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/upload/upload-view.xml[tags=basics]
----

image::visual-components/components/upload-basics.png[align="center", width="332"]

[[auto-upload]]
== 自动上传

`autoUpload` 属性设置组件是否在用户选择了文件之后自动上传，或者是需要用户主动触发上传。

* 当设置为 `true` 时，文件会在选择后自动上传。此时会显示上传进度，用户还可以按需取消上传。
* 当设置为 `false` 时，文件不会自动上传。用户必须点击 *Upload* 按钮开始上传。

默认值为 `true`。

[[drag-drop]]
== 拖放

`upload` 组件支持拖放功能，用户可以从文件系统直接拖拽文件至该组件实现上传。

拖放功能默认开启。如需禁用，请设置 xref:flow-ui:vc/components/fileStorageUploadField.adoc#dropAllowed[dropAllowed] 属性为 `false`。

`dropLabel` 属性设置组件中引导用户拖放文件的文本。

该属性的值可以是一个纯文本，或 xref:localization:message-bundles.adoc[消息包] 中的一个键值。如果是键值，需要以 `msg://` 开头。

`dropLabelIcon` 属性设置一个 `dropLabel` 文本旁边可以显示的图标。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/upload/upload-view.xml[tags=drag-drop]
----

image::visual-components/components/upload-drag-drop.png[align="center", width="395"]

[[file-count]]
== 文件计数

默认情况下，`upload` 不限制用户可以上传的文件数量。可以通过 `maxFiles` 属性控制用户能上传的文件数。

设置允许用户上传的最大文件个数。如果设置为 1，则系统原生的文件选择器将不允许选择多个文件。

默认不会在 UI 显示文件上传的异常。请使用 <<FileRejectedEvent,FileRejectedEvent>> 捕捉异常，然后可以使用通知为用户展示异常。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/upload/UploadView.java[tags=notifications;FileRejectedEvent]
----

[[receivers]]
== 接收器

`receiverFqn` 属性设置将会处理上传文件的 Java 类的全限定名称。该类必须实现 `Receiver` 接口。

NOTE: 如果接收器未实现 `MultiFileReceiver`，则 `upload` 组件自动设置为仅接受单文件上传。

`receiverType` 属性指定处理上传文件的接收器类型。决定如何处理并存储上传的文件。可以是：

* `MemoryBuffer`
+
一次只处理单个文件上传。将文件数据写入内存中。使用 `MemoryBuffer` 时，会自动将组件配置成仅能选择单文件上传。
* `MultiFileMemoryBuffer`
+
处理多个文件上传。将文件数据写入内存中。
* `FileTemporaryStorageBuffer`
+
一次只处理单个文件上传。将文件保存至 xref:files:file-storage.adoc[临时文件存储]。使用 `FileTemporaryStorageBuffer` 时，会自动将组件配置成仅能选择单文件上传。
* `MultiFileTemporaryStorageBuffer`
+
处理多个文件上传。将文件数据写入内存中。将文件保存至 xref:files:file-storage.adoc[临时文件存储]。

默认接收类型为 `MemoryBuffer`。

== XML 属性

在 Jmix 中，所有组件都有一些作用一致的 xref:vc/common-attributes.adoc[通用属性]。

下面是 `upload` 的特殊属性：

[cols="1h,5,1", grid=rows, frame=none]
|===
|*名称*
|*描述*
|*默认值*
|[[autoUpload]]autoUpload
|设置组件是否在选择文件后自动上传。参阅 <<auto-upload,自动上传>>。
|`true`
|[[dropLabel]]dropLabel
|设置组件中引导用户拖放文件的文本。参阅 <<drag-drop,拖放>>。
|
|[[dropLabelIcon]]dropLabelIcon
|设置 dropLabel 的图标。用户可以拖放文件时该图标可见。参阅 <<drag-drop,拖放>>。
|
|[[maxFiles]]maxFiles
|设置允许上传的最大文件数量。参阅 <<file-count,文件计数>>
|无限制
|[[receiverFqn]]receiverFqn
|设置 `upload` 组件使用的接收器的实现。参阅 <<receiver,接收器>>。
|
|[[receiverType]]receiverType
|设置 `Receiver` 接口实现的类型。参阅 <<receiver,接收器>>。
|`MemoryBuffer`
|===

== 事件和处理器

在 Jmix 中，所有组件都有一些 xref:vc/common-handlers.adoc[通用事件和处理器]，可以按相同的方法设置。

下面是 `upload` 的特殊事件和处理器：

include::../handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*名称*
|*描述*
|[[AllFinishedEvent]]AllFinishedEvent
|`com.vaadin.flow.component.upload.AllFinishedEvent` 当 `upload` 组件处理完队列中所有的文件之后发送，无论上传是否成功。
|[[FailedEvent]]FailedEvent
|`com.vaadin.flow.component.upload.FailedEvent` 当 `upload` 组件上传的文件被接收但由于某些原因中断时发送。
|[[FileRejectedEvent]]FileRejectedEvent
|`com.vaadin.flow.component.upload.FileRejectedEvent` 当选择的文件不满足 `upload` 的要求时发送，例如，xref:flow-ui:vc/components/fileStorageUploadField.adoc#maxFileSize[文件大小限制] 或 <<maxFiles,文件数量限制>>。参阅 See <<file-count,文件数量>>。
|[[FinishedEvent]]FinishedEvent
|`com.vaadin.flow.component.upload.FinishedEvent` 当 `upload` 接收了文件后发送，不论是否成功。如需区别是否成功，请使用 <<SucceededEvent,SucceededEvent>> 或 <<FailedEvent,FailedEvent>>，这两个都是 `FinishedEvent` 的子类。
|[[ProgressUpdateEvent]]ProgressUpdateEvent
|`com.vaadin.flow.component.upload.ProgressUpdateEvent` 用于跟踪上传文件的进度。
|[[StartedEvent]]StartedEvent
|`com.vaadin.flow.component.upload.StartedEvent` 当 `upload` 开始接收文件时发送。
|[[SucceededEvent]]SucceededEvent
|`com.vaadin.flow.component.upload.SucceededEvent` 当 `upload` 成功接收文件时发送。在示例应用程序中，有一个 https://demo.jmix.io/ui-samples/sample/upload[示例^] 是在 `com.vaadin.flow.component.upload.SucceededEvent` 事件中通过 `MultiFileMemoryBuffer` 管理多个文件。
|[[receiver]]receiver
|设置 `upload` 组件使用的接收器。<<receiverFqn>> 和 <<receiverType>> 属性。
|===

== 参考

{vaadin-docs}/components/upload[Vaadin 文档^]
