= multiSelectComboBox
:page-aliases: vcl/components/tag-field.adoc, vcl/components/tag-picker.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/multi-select-combo-box-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`multiSelectComboBox` позволяет пользователям выбирать один или несколько элементов из выпадающего списка. Этот компонент похож на xref:vc/components/comboBox.adoc[comboBox].
[cols="1h,6", grid=none]
|===
|XML-элемент
|`multiSelectComboBox`
|Java-класс
|`JmixMultiSelectComboBox`
|Атрибуты
|xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
xref:vc/components/comboBox.adoc#allowCustomValue[allowCustomValue] -
xref:vc/common-attributes.adoc#allowedCharPattern[allowedCharPattern] -
xref:vc/common-attributes.adoc#ariaLabel[ariaLabel] -
xref:vc/common-attributes.adoc#ariaLabelledBy[ariaLabelledBy]
<<autoExpand,autoExpand>> -
xref:vc/components/comboBox.adoc#autoOpen[autoOpen] -
xref:vc/common-attributes.adoc#autofocus[autofocus] -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/components/textField.adoc#clearButtonVisible[clearButtonVisible] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
xref:vc/common-attributes.adoc#dataContainer[dataContainer] -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#errorMessage[errorMessage] -
xref:vc/common-attributes.adoc#focusShortcut[focusShortcut] -
xref:vc/common-attributes.adoc#height[height] -
xref:vc/common-attributes.adoc#helperText[helperText] -
xref:vc/components/entityComboBox.adoc#itemsContainer[itemsContainer]
xref:vc/components/comboBox.adoc#items-enum[itemsEnum] -
xref:vc/common-attributes.adoc#label[label] -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
<<metaClass,metaClass>> -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<opened,opened>> -
xref:vc/components/comboBox.adoc#overlayClass[overlayClass] -
xref:vc/components/comboBox.adoc#pageSize[pageSize] -
xref:vc/common-attributes.adoc#placeholder[placeholder] -
xref:vc/common-attributes.adoc#property[property] -
xref:vc/common-attributes.adoc#readOnly[readOnly] -
xref:vc/common-attributes.adoc#required[required] -
xref:vc/common-attributes.adoc#requiredMessage[requiredMessage] -
<<selectedItemsOnTop,selectedItemsOnTop>> -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/components/comboBox.adoc#theme-variants[themeNames] -
xref:vc/common-attributes.adoc#title[title] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]
|Обработчики
|xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
xref:vc/common-handlers.adoc#ClientValidatedEvent[ClientValidatedEvent] -
xref:vc/common-handlers.adoc#ComponentValueChangeEvent[ComponentValueChangeEvent] -
xref:vc/components/comboBox.adoc#CustomValueSetEvent[CustomValueSetEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
xref:vc/common-handlers.adoc#TypedValueChangeEvent[TypedValueChangeEvent] -
<<itemLabelGenerator,itemLabelGenerator>> -
<<itemsFetchCallback,itemsFetchCallback>> -
<<renderer,renderer>> -
xref:vc/components/textField.adoc#validator[validator]
|Элементы
|<<itemsQuery,itemsQuery>> -
xref:vc/components/tooltip.adoc[tooltip] -
<<validation,validator>>
|===

== Основы

Выпадающий список открывается, когда пользователь щелкает по полю с помощью мыши. Использование клавиш `Up` и `Down` или ввод символа при фокусе на поле также открывает выпадающий список.

image::visual-components/components/multi-select-combo-box-basics.png[align="center", width="274"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/multiselectcombobox/multi-select-combo-box-view.xml[tags=basics]
----

[[data-binding]]
== Data Binding

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/multi-select-combo-box-dataaware" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Привязка данных означает связывание визуального компонента с xref:data/data-containers.adoc[контейнером данных]. Изменения в визуальном компоненте или соответствующем контейнере данных могут вызывать обновления друг друга. Смотрите xref:flow-ui:data/data-examples.adoc[Использование компонентов данных] для получения дополнительной информации.

Чтобы создать `multiSelectComboBox`, связанный с данными, используйте атрибуты xref:vc/common-attributes.adoc#dataContainer[dataContainer] и xref:vc/common-attributes.adoc#property[property]. Атрибут xref:vc/components/entityComboBox.adoc#itemsContainer[itemsContainer] используется для создания списка элементов. В следующем примере показан `multiSelectComboBox`, связанный с данными.

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/multiselectcombobox/multi-select-combo-box-view.xml[tags=data;userDc;hobbiesDc;layout;itemsContainer]
----

<1> `InstanceContainer` для сущности `User`.
<2> Встроенный план выборки экземпляра сущности, находящегося в контейнере.
<3> `CollectionContainer` для сущности `Hobby`.
<4> `multiSelectComboBox` получает `hobbiesDc` в качестве контейнера элементов, чтобы в выпадающем списке отображался список хобби.

Значение компонента возвращает список выбранных элементов.

[[meta-class]]
== MultiSelectComboBox c MetaClass

Вы можете использовать `multiSelectComboBox` без прямой ссылки на данные, то есть без указания атрибутов `dataContainer` и `property`. В этом случае используйте атрибут `metaClass` для указания типа сущности для `multiSelectComboBox`. Чтобы указать набор экземпляров для выбора, используйте атрибут `itemsContainer`.

Например, компонент может работать с сущностью `Hobby`, которая имеет имя класса метаданных `Hobby`.

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/multiselectcombobox/multi-select-combo-box-view.xml[tags=metaClass]
----

== Общие функции comboBox

`multiSelectComboBox` поддерживает следующие функции из обычного `comboBox`:

* xref:vc/components/comboBox.adoc#custom-items[Пользовательские элементы]
* xref:vc/components/comboBox.adoc#custom-filtering[Пользовательская фильтрация]
* xref:vc/components/comboBox.adoc#custom-value-entry[Обработка пользовательского ввода]
* xref:vc/components/comboBox.adoc#rendering-items[Рендеринг элементов]

[[auto-expand]]
== Автоматическое расширение

Вы можете настроить `multiSelectComboBox` для автоматического увеличения ширины, чтобы вместить теги, представляющие выбранные элементы. Расширение работает только с неопределенным размером в нужном направлении (например, установка `max-width` ограничивает ширину компонента). Возможные значения:

* `VERTICAL` - поле расширяется вертикально, и теги переносятся на следующую строку.
+
image::visual-components/components/auto-expand-vertical.png[align="center", width="211"]
* `HORIZONTAL` - поле расширяется горизонтально, пока не достигнет максимальной ширины (`max-width`), затем сворачивается, чтобы отобразить переполняющий тег.
+
image::visual-components/components/auto-expand-horizontal.png[align="center", width="579"]
* `BOTH` - поле расширяется горизонтально, пока не достигнет максимальной ширины (`max-width`), затем расширяется вертикально, и теги переносятся на следующую строку.
+
image::visual-components/components/auto-expand-both.png[align="center", width="469"]
* `NONE` - поле не расширяется и сворачивается, чтобы отобразить переполняющий тег.
+
image::visual-components/components/auto-expand-none.png[align="center", width="208"]

[[selected-items-on-top]]
== Отображение выбранных элементов

Атрибут `selectedItemsOnTop` управляет способом отображения выбранных элементов в выпадающем списке.

Как это работает:

* Если `selectedItemsOnTop` установлен в `true`, выбранные элементы отображаются в верхней части выпадающего списка, а не выбранные остаются внизу. Такое расположение может быть визуально привлекательным и интуитивно понятным, особенно если пользователи часто выбирают подмножество элементов и нуждаются в быстром доступе к последним выбранным.
* Если `selectedItemsOnTop` установлен в `false` (значение по умолчанию), выбранные элементы отображаются в том порядке, в котором они были выбраны, без перемещения в верхнюю часть выпадающего списка. Такое расположение сохраняет порядок выбора и может быть предпочтительным в сценариях, где порядок имеет решающее значение, или если важна визуальная согласованность с другими элементами интерфейса.

[[items-fetch-callback]]
== Получение элементов списка

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/multi-select-combo-box-items-query" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`multiSelectComboBox` может загружать элементы по частям в ответ на действия пользователя.

Например, когда пользователь вводит `foo`, компонент загружает из базы данных не более 50 элементов, содержащих `foo` в названии, и показывает их в выпадающем списке. Когда пользователь прокручивает список вниз, компонент извлекает следующую группу из 50 элементов с тем же запросом и добавляет их в список.

[[itemsQuery]]
=== Декларативная конфигурация

Для реализации этого поведения определите вложенный элемент `itemsQuery`.

Элемент `itemsQuery` должен содержать текст запроса JPQL во вложенном элементе `query` и несколько дополнительных атрибутов, определяющих, что и как загружать данные:

* `escapeValueForLike` - включает поиск значений, содержащих специальные символы: `%,` `\`, и так далее. Значение по умолчанию - `false`.
* `searchStringFormat` - строка Groovy. C её помощью вы можете использовать любые допустимые строковые выражения Groovy.
* `class` (необязательный) - указывает полное имя класса сущности, экземпляры которой будут получены.
* `fetchPlan` - необязательный атрибут, указывающий план выборки, который будет использоваться для загрузки запрошенной сущности.

Элемент `itemsQuery` содержит следующие вложенные элементы:

* `query` - элемент, содержащий запрос JPQL.
* `fetchPlan` - необязательный элемент, указывающий встроенный план выборки.

Пример использования `itemsQuery` в `multiSelectComboBox`:

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/multiselectcombobox/multi-select-combo-box-view.xml[tags=itemsQuery]
----
<1> Атрибут `pageSize` определяет размер пакета при загрузке данных из базы данных. По умолчанию он равен 50.

[[itemsFetchCallback-handler]]
=== Программная конфигурация

Извлечение элементов также может быть определено программно с помощью обработчика `itemsFetchCallback`. Например:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/multiselectcombobox/MultiSelectComboBoxView.java[tags=load-hobbies;onInit;itemsFetchCallback]
----

В этом примере данные извлекаются с помощью xref:data-access:data-manager.adoc[DataManager], но вы можете использовать этот подход для загрузки из собственного сервиса.

[[validation]]
== Валидация

Чтобы проверить значения, введенные в компонент `multiSelectComboBox`, вы можете использовать xref:vc/miscellaneous/validator.adoc[валидатор] в элементе `validators`.

Доступны следующие предопределенные валидаторы для `multiSelectComboBox`:

[cols="1h,6", grid=none]
|===
|XML-элемент
|`validators`
|Предопределенные валидаторы
|xref:vc/miscellaneous/validator.adoc#custom-validator[custom] - xref:vc/miscellaneous/validator.adoc#NotEmptyValidator[notEmpty] - xref:vc/miscellaneous/validator.adoc#NotNullValidator[notNull] - xref:vc/miscellaneous/validator.adoc#SizeValidator[size]
|===

== Атрибуты

В Jmix есть множество xref:vc/common-attributes.adoc[общих атрибутов], которые выполняют одну и ту же функцию для всех компонентов.

Ниже приведены атрибуты, специфичные для `multiSelectComboBox`:

[cols="1h,5,1", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[autoExpand]]autoExpand
|Управляет поведением компонента, когда недостаточно места для отображения всех выбранных элементов в виде тегов в пределах текущей ширины поля. Смотрите <<auto-expand,Автоматическое расширение>>.
|`NONE`
|[[metaClass]]metaClass
|Определяет класс сущности для `multiSelectComboBox`.
Задайте этот атрибут, если компонент не связан с контейнером данных. В противном случае тип сущности определяется контейнером данных. Смотрите <<meta-class,MultiSelectComboBox c MetaClass>>.
|
|[[opened]]opened
|Определяет, следует ли открывать выпадающий список или нет.
|`false`
|[[selectedItemsOnTop]]selectedItemsOnTop
|Включает или отключает группировку выбранных элементов в верхней части выпадающего списка. Смотрите <<selected-items-on-top,Отображение выбранных элементов>>.
|`false`
|===

== Обработчики

В Jmix существует множество xref:vc/common-handlers.adoc[общих обработчиков], которые конфигурируются одинаково для всех компонентов.

Ниже приведены обработчики, специфичные для  `multiSelectComboBox`.

include::../handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|[[itemLabelGenerator]]itemLabelGenerator
|`com.vaadin.flow.component.ItemLabelGenerator` можно использовать для настройки строки, отображаемой пользователю для элемента. Смотрите xref:vc/components/comboBox.adoc#itemLabelGenerator[itemLabelGenerator] для `comboBox` и https://demo.jmix.ru/ui-samples/sample/multi-select-combo-box-item-label[демонстрацию^].
|[[itemsFetchCallback]]itemsFetchCallback
|Этот обработчик извлекает данные только по мере необходимости. Смотрите <<itemsFetchCallback-handler,Получение элементов списка>>.
|[[renderer]]renderer
|Устанавливает `Renderer`, ответственный за отрисовку отдельных элементов в списке возможных вариантов `multiSelectComboBox`. Это не влияет на то, как отображается выбранный элемент - это можно настроить с помощью <<itemLabelGenerator,ItemLabelGenerator>>. Смотрите https://demo.jmix.ru/ui-samples/sample/multi-select-combo-box-custom-renderer[демонстрацию^].
|===

== Смотрите также

Смотрите {vaadin-docs}/components/multi-select-combo-box[документацию Vaadin^] для получения дополнительной информации.