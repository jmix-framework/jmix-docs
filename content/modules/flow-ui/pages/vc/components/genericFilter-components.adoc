= genericFilter 的组件
:page-aliases: vcl/components/filter-components.adoc

对 `genericFilter` 的一些固定配置可以在 xref:vc/components/genericFilter.adoc#run-time-configuration[运行时] 或 xref:vc/components/genericFilter.adoc#design-time-configuration[设计时] 进行配置。本章提供设计时 `genericFilter` 的配置说明，包含三种预定义的过滤器组件：

* <<property-filter, propertyFilter>>
* <<jpql-filter, jpqlFilter>>
* <<group-filter, groupFilter>>

TIP: 框架支持自定义过滤器组件，并在 `genericFilter` 中使用。参阅 <<filter-compponent-registration, 注册过滤器组件>> 章节。

[[property-filter]]
== propertyFilter

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/generic-filter-property-condition" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`propertyFilter - 属性过滤器` 可以基于实体的特定属性添加过滤条件。

NOTE: 该组件也可以单独使用。参阅 xref:vc/components/propertyFilter.adoc[]。

本节的声明式和编程式配置都可以在视图中创建如下过滤器：

image::flow-ui:visual-components/components/generic-filter-components-property-filter.png[align="center", width="780"]


=== 声明式配置

`genericFilter` 的配置可以在视图的 XML 文件中声明式指定。以下示例展示如何配置 `propertyFilter`：

[source, xml,indent=0]
----
include::example$onboarding/src/main/resources/com/company/onboarding/view/component/genericfiltercomponents/generic-filter-components-view.xml[tags=layout;generic-filter-property]
----

<1> `genericFilter` 组件的绑定了数据加载器。
<2> `propertyFilter` 根据 `age` 属性配置了一个过滤条件。

=== 编程式配置

另一种定义的方式是在视图控制器中编程式配置：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/genericfiltercomponents/GenericFilterComponentsView.java[tags=UiComponents;pfdtcGenericFilter;SingleFilterSupport;onInit;programmaticPropertyFilter]
----

<1> 添加一个设计时配置。方法接收两个参数：配置id和配置名。
<2> 创建一个 `PropertyFilter` 实例并设置其属性。
<3> 基于 metaClass、属性和运算符为该过滤器创建一个组件。
<4> 将过滤器添加至配置中。`LogicalFilterComponent` 是配置的根元素。
<5> 设置为当前配置。

[[jpql-filter]]
== jpqlFilter

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/generic-filter-jpql-condition" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`jpqlFilter - JPQL 过滤器` 支持使用 JPQL 查询进行过滤。原理是修改数据加载器的查询语句，添加可选的 `join` 和必需的 `where` 子句，实现对查询结果的修改。

本节的声明式和编程式配置都可以在视图中创建如下过滤器：

image::flow-ui:visual-components/components/generic-filter-jpql-filter.png[align="center", width="780"]

=== 声明式配置

A `genericFilter` configuration can be specified declaratively, inside the XML view descriptor. See the following example for configuration with `jpqlFilter`:

[source, xml,indent=0]
----
include::example$onboarding/src/main/resources/com/company/onboarding/view/component/genericfiltercomponents/generic-filter-components-view.xml[tags=layout;generic-filter-jpql]
----

<1> `genericFilter` 组件的绑定了数据加载器。
<2> 可选的 `join` 子句。
<3> 必需的 `where` 子句。`?` 表示需要由用户输入的参数。

//todo: add example with hasInExpression="true" upon completing jmix ticket #1442

=== 编程式配置

另一种定义的方式是在视图控制器中编程式配置：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/genericfiltercomponents/GenericFilterComponentsView.java[tags=UiComponents;jfdtcGenericFilter;JpqlFilterSupport;SingleFilterSupport;onInit;programmaticJpqlFilter]
----

=== 无参数过滤器

`jpqlFilter` 还支持创建无参数条件，用户只能选择是否使用该条件。

例如，直接在 `where` 子句中设置城市的名称。用户只能选择显示该城市的客户：

image::flow-ui:visual-components/components/generic-filter-jpql-filter-no-parameter.png[align="center", width="780"]

[source, xml,indent=0]
----
include::example$onboarding/src/main/resources/com/company/onboarding/view/component/genericfiltercomponents/generic-filter-components-view.xml[tags=layout;generic-filter-jpql-no-parameter]
----

<1> `parameterClass="java.lang.Void"` 表示过滤器无参数，`defaultValue=true` 表示会使用该条件。
<2> 城市名固定为 'London' 且无法在运行时修改。

另一种定义的方式是在视图控制器中编程式配置：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/genericfiltercomponents/GenericFilterComponentsView.java[tags=UiComponents;jfdtcGenericFilterNoParameter;JpqlFilterSupport;SingleFilterSupport;onInit;programmaticJpqlFilterNoParameter]
----

[[group-filter]]
== groupFilter

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/generic-filter-group-condition" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`groupFilter - 组合条件过滤器` 是将多个条件绑定为一组。组内的条件可以使用逻辑运算符（`AND` 或 `OR`）连接。本节的声明式和编程式配置都可以在视图中创建如下过滤器：

image::flow-ui:visual-components/components/generic-filter-group-filter.png[align="center", width="770"]

=== 声明式配置

`genericFilter` 的配置可以在视图的 XML 文件中声明式指定。以下示例展示如何配置 `groupFilter`，组合了两个 `propertyFilter`：

[source, xml,indent=0]
----
include::example$onboarding/src/main/resources/com/company/onboarding/view/component/genericfiltercomponents/generic-filter-components-view.xml[tags=generic-filter-group]
----

=== 编程式配置

另一种定义的方式是在视图控制器中编程式配置：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/genericfiltercomponents/GenericFilterComponentsView.java[tags=UiComponents;gfdtcGenericFilter;SingleFilterSupport;onInit;programmaticGroupFilter]
----

<1> 添加一个设计时配置，方法接收两个参数：配置id和配置名。
<2> 创建 `GroupFilter` 组件，并设置其属性。
<3> 设置 `OR` 运算符。
<4> 添加 `PropertyFilter` 作为第一个条件，按照奖励点数对用户进行过滤。
<5> 添加 `PropertyFilter` 作为第二个条件，按照爱好对用户进行过滤。
<6> 将创建的组过滤器添加至配置。

[[filter-compponent-registration]]
== 注册过滤器组件

如需在框架内创建并注册 UI 过滤器组件，需要以下对象：

* 一个组件类 - UI 组件，展示在 `genericFilter` 内部。
* 一个模型类 - 保存过滤器组件的非持久化状态。模型类用来保存过滤器组件状态至数据库并在运行时展示该状态。模型类需要继承 `FilterCondition` 类。参考 `PropertyFilterCondition` 类作为示例。
* 一个转换器类 - 在组件和模型之间转换。转换器类需实现 `FilterConverter` 接口。
* 一个模型的详情界面。其标识符可以通过 `withDetailViewId` 方法指定。如果未指定标识符，则标识符默认为 `JmixEnity` 获取的模型名称加上 `ViewRegistry.DETAIL_VIEW_SUFFIX` 后缀。

`PropertyFilter` 注册示例：

```
@Bean("flowui_PropertyFilterRegistration")
public FilterComponentRegistration registerPropertyFilter() {
    return FilterComponentRegistrationBuilder.create(PropertyFilter.class,
                    PropertyFilterCondition.class,
                    PropertyFilterConverter.class)
            .build();
}
```

所有注册的过滤器组件都在 *Add condition* 对话框的 *xref:vc/components/genericFilter.adoc#creating-conditions[Create]* 中显示。

可以替换 Jmix 框架中注册的过滤器组件为自定义的组件，只需在 `FilterComponentRegistration` bean 使用 `@Order` 注解提高自定义组件的优先级。

== XML 属性

TIP: 使用 xref:studio:view-designer.adoc#component-inspector[Jmix UI inspector] 查看和编辑组件的属性。

=== propertyFilter 属性

参阅 xref:vc/components/propertyFilter.adoc#attributes[propertyFilter 属性].

=== jpqlFilter 属性

xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
<<defaultValue, defaultValue>> -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#errorMessage[errorMessage] -
//todo: improve IN expression description upon completing jmix ticket #1442
<<hasInExpression, hasInExpression>> -
xref:vc/common-attributes.adoc#helperText[helperText] -
xref:vc/common-attributes.adoc#invalid[invalid] -
xref:vc/common-attributes.adoc#label[label] -
<<labelVisible, labelVisible>> -
<<parameterClass, parameterClass>> -
xref:vc/common-attributes.adoc#readOnly[readOnly] -
xref:vc/common-attributes.adoc#required[required] -
xref:vc/common-attributes.adoc#requiredIndicatorVisible[requiredIndicatorVisible] -
xref:vc/common-attributes.adoc#requiredMessage[requiredMessage] -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]

[[defaultValue]]
==== defaultValue

设置默认值。

[[hasInExpression]]
==== hasInExpression

是否可以使用集合值，以及 `IN` 子句。

[[labelVisible]]
==== labelVisible

设置 label 的可见性。

[[paramterClass]]
==== parameterClass

指定参数的类型。例如 `java.lang.String`。

=== groupFilter 属性

xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#enabled[enabled] -
<<operation, operation>> -
<<operationTextVisible, operationTextVisible>> -
<<summaryText, summaryText>> -
xref:vc/common-attributes.adoc#visible[visible]

[[operation]]
==== operation

设置组内条件连接的逻辑运算符。支持 `AND`、`OR`。

[[operationTextVisible]]
==== operationTextVisible

是否显示运算符的名称。

[[summaryText]]
==== summaryText

为该条件设置一个摘要描述。

== 事件和处理器

=== propertyFilter 的事件

参阅 xref:vc/components/propertyFilter.adoc#handlers[propertyFilter 的事件].

=== jpqlFilter 的事件

xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
xref:vc/common-handlers.adoc#ComponentValueChangeEvent[ComponentValueChangeEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
//todo: add labelDelegate
// <<labelDelegate, labelDelegate>> -
<<validator, validator>>

[[validator]]
==== validator
为组件添加一个 xref:vc/miscellaneous/validator.adoc[validator] 实例。

=== groupFilter 的事件

xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent]
//todo: add FilterComponentsChangeEvent
// <<FilterComponentsChangeEvent, FilterComponentsChangeEvent>>
