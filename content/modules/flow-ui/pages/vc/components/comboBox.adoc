= comboBox 下拉列表

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-simple" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`comboBox` 支持用户从一组预定义的选项中选择单一值。
[cols="1h,6", grid=none]
|===
|XML 元素
|`comboBox`
|Java 类
|`JmixComboBox`
|XML 属性
|xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<allowCustomValue,allowCustomValue>> -
xref:vc/common-attributes.adoc#ariaLabel[ariaLabel] -
xref:vc/common-attributes.adoc#ariaLabelledBy[ariaLabelledBy] -
<<autoOpen,autoOpen>> -
xref:vc/common-attributes.adoc#autofocus[autofocus] -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/components/textField.adoc#clearButtonVisible[clearButtonVisible] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
xref:vc/common-attributes.adoc#dataContainer[dataContainer] -
xref:vc/common-attributes.adoc#datatype[datatype] -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#errorMessage[errorMessage] -
xref:vc/common-attributes.adoc#focusShortcut[focusShortcut] -
xref:vc/common-attributes.adoc#height[height] -
xref:vc/common-attributes.adoc#helperText[helperText] -
<<items-enum,itemsEnum>> -
xref:vc/common-attributes.adoc#label[label] -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<overlay,overlayClass>> -
<<pageSize,pageSize>> -
xref:vc/common-attributes.adoc#pattern[pattern] -
xref:vc/common-attributes.adoc#placeholder[placeholder] -
xref:vc/common-attributes.adoc#property[property] -
xref:vc/common-attributes.adoc#readOnly[readOnly] -
xref:vc/common-attributes.adoc#required[required] -
xref:vc/common-attributes.adoc#requiredMessage[requiredMessage] -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#title[title] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]
|事件和处理器
|xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
xref:vc/common-handlers.adoc#ClientValidatedEvent[ClientValidatedEvent] -
xref:vc/common-handlers.adoc#ComponentValueChangeEvent[ComponentValueChangeEvent] -
<<CustomValueSetEvent,CustomValueSetEvent>> -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
<<itemLabelGenerator,itemLabelGenerator>> -
<<itemsFetchCallback-handler,itemsFetchCallback>> -
<<rendering-items,renderer>> -
xref:vc/common-handlers.adoc#statusChangeHandler[statusChangeHandler] -
xref:vc/components/textField.adoc#validator[validator]
|XML 内部元素
|<<itemsQuery,itemsQuery>> -
xref:vc/miscellaneous/prefix-suffix.adoc[prefix] -
xref:vc/components/tooltip.adoc[tooltip] -
<<validation,validator>>
|===

== 基本用法

`comboBox` 在用户输入文本时提供对选项值的过滤，以及选项的分页展示。

满足下列情况可以使用 `comboBox`：

* *动态过滤*。用户需要根据输入的值对选项进行过滤。`comboBox` 提供了内置的过滤功能。
* *选项数量大*。当选项的数量特别大时，`comboBox` 可以对选项进行分页，每次仅展示有限的部分选项，以提升渲染性能。
* *自定义渲染*。希望自定义下拉选项的外观，比如可以带有其他信息或样式。`comboBox` 为自定义选项的渲染方式提供了更大的灵活性。

使用 `comboBox` 的最简单情况是为实体属性选择枚举值。例如，`User` 实体具有 `OnboardingStatus` 枚举类型的 `onboardingStatus` 属性。

image::visual-components/components/combo-box-basic.png[align="center", width="268"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=data;userDc;layout;basics]
----
<1> `User` 实体的 `InstanceContainer` 容器。
<2> 容器内实体的内联 fetch plan。
<3> 将组件与数据容器和属性进行关联。`dataContainer` 属性使用 `userDc` 数据容器，`property` 引用 `onboardingStatus` 实体属性。

// == Basics
//
// `comboBox` provides filtering of values as the user enters some text, and pagination of available values.
//
// Use `comboBox` if:
//
// * Users need to select a single item.
// * The list should be compact. It can be useful when the list of items is too long for xref:flow-ui:vc/components/radioButtonGroup.adoc[radioButtonGroup].
//
// By default, Jmix Studio generates `comboBox` when creating an entity detail view with an enum attribute. For example, the `User` entity has the `onboardingStatus` attribute of the `OnboardingStatus` type, which is an enumeration.
//
// image::visual-components/components/combo-box-basic.png[align="center", width="268"]
//
// [source,xml,indent=0]
// ----
// include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=data;userDc;layout;basics]
// ----
// <1> `InstanceContainer` for the `User` entity.
// <2> Inline fetch plan of the entity instance located in the container.
// <3> Binding the component to a data container and property. The `dataContainer` attribute contains a link to the `userDc` data container, and the `property` attribute refers to the `onboardingStatus` entity attribute.

[[custom-items]]
== 自定义选项

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-custom-items" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

[[items-list]]
=== 选项列表

`comboBox` 的选项列表还可以通过 `setItems()` 方法设置。

首先在 XML 描述中声明组件：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=data;stepDc;layout;custom-options]
----

然后将组件注入控制器，在 `onInit()` 方法中设置选项列表：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=durationComboBox;onInit;setItems]
----

组件的下拉列表中会显示 `1`、`2`、`3`、`4` 和 `5`。选择的值会设置到 `stepDc` 数据容器中的 `duration` 属性上。

[[items-map]]
=== 选项映射

`ComponentUtils.setItemsMap()` 可以为每个选项值指定一个字符串标签。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=setItemsMap;onInit]
----

[[items-enum]]
=== 选项枚举

`comboBox` 枚举类型的选项可以通过声明式或编程式的方式设置。

`itemsEnum` 属性定义枚举类作为控件的选项列表。下拉列表中会显示枚举值的本地化名称；组件的值则为枚举的值。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=itemsEnum]
----

下面的示例展示了编程式设置的方法。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=setItemsEnum;onInit]
----

[[custom-filtering]]
== 自定义过滤

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-custom-filtering" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

默认情况下，`comboBox` 在对选项进行过滤时使用不区分大小写的子串匹配的方法。也就是说，选项会显示任意位置包含用户输入文本的选项，且不分大小写。

如需自定义过滤行为，可以使用 `setItems()` 方法的第一个参数：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=setFiltering;onInit]
----

[[custom-value-entry]]
== 自定义选项值

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-user-input" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`comboBox` 通过配置可以支持用户输入不在选项列表中的值。

如果 `allowCustomValue` 属性为 `true`，用户可以输入不匹配任何选项的字符串值，此时会触发 <<CustomValueSetEvent,CustomValueSetEvent>>。

NOTE: `comboBox` 不会自动处理自定义字符串。请使用 `CustomValueSetEvent` 进行处理。

下面的示例中展示了如何为选项列表添加新的值，并在将来使用：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=allowCustomValue]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=colorComboBox;onInit;setColorItems;CustomValueSetEvent]
----

[[lazy-loading]]
== 选项获取回调
//Lazy Loading
++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-items-query" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

`comboBox` 可以根据用户输入批量加载选项。

例如，当用户输入 `foo` 时，组件会从数据库中加载最多 50 个名称中包含 `foo` 的选项，并在下拉列表显示。当用户向下滚动列表时，组件会获取具有相同查询语句的下一批 50 个选项，并将添加到选项列表中。

// Jmix automatically handles the asynchronous fetching of items for the `comboBox`. When `comboBox` needs to load items, it:
//
// . Executes the query defined in the `itemsQuery` element against your database.
// . Provides data to `comboBox`: the fetched data is processed and provided to the `comboBox` component.

[[itemsQuery]]
=== 声明式配置

要实现这个功能，需要定义内部的 `itemsQuery` 元素。

`itemsQuery` 元素需要在内部的 `query` 元素中定义 JPQL 查询语句，以及通过几个属性配置如何加载数据：

// `itemsQuery` is an optional element that enables defining a query for selecting suggested values.
//
// Attributes in the `itemsQuery` element provide control over the fetching process. They are as follows:

* `escapeValueForLike` - 启用搜索包含特殊符号的值：`%`、`\` 等。默认为 `false`。
* `searchStringFormat` - 一个包含变量占位符的字符串，该占位符在查询时将替换为实际值。

`comboBox` 中配置 `itemsQuery` 的示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=itemsQuery]
----
<1> 组件的 `pageSize` 选项设置每个请求加载选项的最大数量，默认为 50。
<2> 可以看到，`comboBox` 内的 `itemsQuery` 不需要定义 `class` 和 `fetchPlan` 属性，因为查询语句需要返回标量值的一个列表（注意这里使用了 `e.name`）。如需处理实体，请使用 xref:vc/components/entityComboBox.adoc[entityComboBox] 组件。

[[itemsFetchCallback-handler]]
=== 编程式配置

选项的获取也可以通过 `itemsFetchCallback` 处理器编程式定义。示例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=load-users;onInit;itemsFetchCallback]
----

示例中，数据通过 xref:data-access:data-manager.adoc[DataManager] 获取，但是也可以自定义一个 service 获取。

[[customizing-item-labels]]
== 自定义选项标签

`itemLabelGenerator` 可以自定选项在列表中如何展示，即控制用户看到的文本，从而能够以更友好或特定于上下文的方式显示信息。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=itemLabelGenerator]
----

[[rendering-items]]
== 选项渲染
//Custom Item Presentation
++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-custom-renderer" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

框架提供了自定义选项渲染的功能。可以使用 `setRenderer()` 方法或 `@Supply` 注解实现。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=render-combo-box]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=renderer]
----

[[overlay]]
== Overlay

Overlay 是一个半透明或不透明的图层，用于显示选项的下拉列表。

`overlayClass` 属性可以为 overlay 元素添加自定义的 CSS 类。

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=overlayClass]
----

在 css 文件中自定义样式：

[source,css,indent=0]
----
include::example$/onboarding/frontend/themes/onboarding/onboarding.css[tags=overlay]
----

[[theme-variants]]
== 样式版本

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.io/ui-samples/sample/combobox-theme-variant" class="live-demo-btn" target="_blank">在线示例</a>
</div>
++++

使用 xref:vc/common-attributes.adoc#themeNames[themeNames] 属性可以调整文本对齐、帮助文本显示位置或组件的尺寸。

[[alignment]]
*对齐方式*

支持三种对齐方式：`align-left`（默认）、`align-right`、`align-center`。

image::visual-components/components/combo-box-alignment.png[align="center", width="627"]

.XML 代码
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=themeNames-align]
----
====

[[helper-text-position]]
*帮助文本显示位置*

设置 `helper-above-field` 会将帮助文字显示在控件上方而不是默认的下方：

image::visual-components/components/combo-box-helper-above-field.png[align="center", width="414"]

.XML 代码
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=themeNames-helper-above-field]
----
====

[[size]]
*尺寸*

支持两种尺寸：默认大小或 `small`。

image::visual-components/components/combo-box-size.png[align="center", width="389"]

.XML 代码
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=themeNames-size]
----
====

[[validation]]
== 验证

如需检查 `comboBox` 组件输入的值，可以通过内部元素 `validators` 使用 xref:vc/miscellaneous/validator.adoc[validator]。

下面是 `comboBox` 可以使用的预定义验证器：

[cols="1h,6", grid=none]
|===
|XML 元素
|`validators`
|预定义验证器
|xref:vc/miscellaneous/validator.adoc#custom-validator[custom] - xref:vc/miscellaneous/validator.adoc#DecimalMaxValidator[decimalMax] - xref:vc/miscellaneous/validator.adoc#DecimalMinValidator[decimalMin] - xref:vc/miscellaneous/validator.adoc#DigitsValidator[digits] - xref:vc/miscellaneous/validator.adoc#DoubleMaxValidator[doubleMax] - xref:vc/miscellaneous/validator.adoc#DoubleMinValidator[doubleMin] - xref:vc/miscellaneous/validator.adoc#EmailValidator[email] - xref:vc/miscellaneous/validator.adoc#MaxValidator[max] - xref:vc/miscellaneous/validator.adoc#MinValidator[min] - xref:vc/miscellaneous/validator.adoc#NegativeOrZeroValidator[negativeOrZero] - xref:vc/miscellaneous/validator.adoc#NegativeValidator[negative] - xref:vc/miscellaneous/validator.adoc#NotBlankValidator[notBlank] - xref:vc/miscellaneous/validator.adoc#NotEmptyValidator[notEmpty] - xref:vc/miscellaneous/validator.adoc#NotNullValidator[notNull] - xref:vc/miscellaneous/validator.adoc#PositiveOrZeroValidator[positiveOrZero] - xref:vc/miscellaneous/validator.adoc#PositiveValidator[positive] - xref:vc/miscellaneous/validator.adoc#RegexpValidator[regexp] - xref:vc/miscellaneous/validator.adoc#SizeValidator[size]
|===

== XML 属性

在 Jmix 中，所有组件都有一些作用一致的 xref:vc/common-attributes.adoc[通用属性]。
下面是 `comboBox` 的特殊属性：

[cols="1h,5,1", grid=rows, frame=none]
|===
|*名称*
|*描述*
|*默认值*
|[[allowCustomValue]]allowCustomValue
|如果 `allowCustomValue` 属性为 `true`，用户可以输入不匹配任何选项的字符串值，此时会触发 <<CustomValueSetEvent,CustomValueSetEvent>>。参阅 <<custom-value-entry, 自定义值>>。
|`false`
|[[autoOpen]]autoOpen
|当 `autoOpen` 属性设置为 `true` 时，`comboBox` 的下拉列表会在控件获得焦点（鼠标点击或手指点击）时或用户输入内容时自动展示。设置为 `false` 禁用该功能。
|`true`
|[[itemsEnum]]itemsEnum
|`itemsEnum` 属性为选项列表定义一个枚举类。参阅 <<items-enum, 选项枚举>>。
|
|[[overlayClass]]overlayClass
|定义需要在 overlay 元素上设置的 CSS 类列表，以空格分隔。参阅 <<overlay, Overlay>>。
|
|[[pageSize]]pageSize
|设置每个请求获取选项的最大数量，值必须大于 0。参阅 <<itemsQuery,选项获取回调>>。
|`50`
|===

== 事件和处理器

在 Jmix 中，所有组件都有一些 xref:vc/common-handlers.adoc[通用事件和处理器]，可以按相同的方法设置。
下面是 `comboBox` 的特殊事件和处理器：

include::../handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*名称*
|*描述*
|[[CustomValueSetEvent]]CustomValueSetEvent
|`com.vaadin.flow.component.combobox.ComboBoxBase.CustomValueSetEvent` 当用户输入非空值，且不匹配任何已有选项时触发。如需启用自定义输入，请设置 <<allowCustomValue,allowCustomValue>> 属性为 `true`。
|[[itemLabelGenerator]]itemLabelGenerator
|`com.vaadin.flow.component.ItemLabelGenerator` 可以自定义某个选项展示给用户的名称。参阅 <<customizing-item-labels, 自定义选项标签>>。
|[[itemsFetchCallback]]itemsFetchCallback
|仅在需要时加载选项数据。参阅 <<itemsFetchCallback-handler,选项获取回调>>。
|[[renderer]]renderer
|用于设置 `Renderer`，为列表中的每个选项自定义渲染。但这不会改变已选择选项的渲染方式，这可以通过 <<itemLabelGenerator,ItemLabelGenerator>> 配置。参阅 <<rendering-items, Rendering Items>>。
|===

== 参考

{vaadin-docs}/components/combo-box[Vaadin 文档^]
