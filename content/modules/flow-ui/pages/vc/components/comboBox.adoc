= comboBox
:page-aliases: vcl/components/combo-box.adoc, vcl/components/suggestion-field.adoc

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-simple" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`comboBox` позволяет пользователям выбрать одно значение из предопределенного списка элементов.
[cols="1h,6", grid=none]
|===
|XML-элемент
|`comboBox`
|Java-класс
|`JmixComboBox`
|Атрибуты
|xref:vc/common-attributes.adoc#id[id] -
xref:vc/common-attributes.adoc#alignSelf[alignSelf] -
<<allowCustomValue,allowCustomValue>> -
xref:vc/common-attributes.adoc#ariaLabel[ariaLabel] -
xref:vc/common-attributes.adoc#ariaLabelledBy[ariaLabelledBy] -
<<autoOpen,autoOpen>> -
xref:vc/common-attributes.adoc#autofocus[autofocus] -
xref:vc/common-attributes.adoc#classNames[classNames] -
xref:vc/components/textField.adoc#clearButtonVisible[clearButtonVisible] -
xref:vc/common-attributes.adoc#colspan[colspan] -
xref:vc/common-attributes.adoc#css[css] -
xref:vc/common-attributes.adoc#dataContainer[dataContainer] -
xref:vc/common-attributes.adoc#datatype[datatype] -
xref:vc/common-attributes.adoc#enabled[enabled] -
xref:vc/common-attributes.adoc#errorMessage[errorMessage] -
xref:vc/common-attributes.adoc#focusShortcut[focusShortcut] -
xref:vc/common-attributes.adoc#height[height] -
xref:vc/common-attributes.adoc#helperText[helperText] -
<<items-enum,itemsEnum>> -
xref:vc/common-attributes.adoc#label[label] -
xref:vc/common-attributes.adoc#maxHeight[maxHeight] -
xref:vc/common-attributes.adoc#maxWidth[maxWidth] -
xref:vc/common-attributes.adoc#minHeight[minHeight] -
xref:vc/common-attributes.adoc#minWidth[minWidth] -
<<overlay,overlayClass>> -
<<pageSize,pageSize>> -
xref:vc/common-attributes.adoc#pattern[pattern] -
xref:vc/common-attributes.adoc#placeholder[placeholder] -
xref:vc/common-attributes.adoc#property[property] -
xref:vc/common-attributes.adoc#readOnly[readOnly] -
xref:vc/common-attributes.adoc#required[required] -
xref:vc/common-attributes.adoc#requiredMessage[requiredMessage] -
xref:vc/common-attributes.adoc#tabIndex[tabIndex] -
xref:vc/common-attributes.adoc#themeNames[themeNames] -
xref:vc/common-attributes.adoc#title[title] -
xref:vc/common-attributes.adoc#visible[visible] -
xref:vc/common-attributes.adoc#width[width]
|Обработчики
|xref:vc/common-handlers.adoc#AttachEvent[AttachEvent] -
xref:vc/common-handlers.adoc#BlurEvent[BlurEvent] -
xref:vc/common-handlers.adoc#ClientValidatedEvent[ClientValidatedEvent] -
xref:vc/common-handlers.adoc#ComponentValueChangeEvent[ComponentValueChangeEvent] -
<<CustomValueSetEvent,CustomValueSetEvent>> -
xref:vc/common-handlers.adoc#DetachEvent[DetachEvent] -
xref:vc/common-handlers.adoc#FocusEvent[FocusEvent] -
<<itemLabelGenerator,itemLabelGenerator>> -
<<itemsFetchCallback-handler,itemsFetchCallback>> -
<<rendering-items,renderer>> -
xref:vc/common-handlers.adoc#statusChangeHandler[statusChangeHandler] -
xref:vc/components/textField.adoc#validator[validator]
|Элементы
|<<itemsQuery,itemsQuery>> -
xref:vc/miscellaneous/prefix-suffix.adoc[prefix] -
xref:vc/components/tooltip.adoc[tooltip] -
<<validation,validator>>
|===

== Основы

`comboBox` предоставляет возможность фильтровать значения по мере ввода текста пользователем, а также реализовать постраничный вывод доступных значений.

Используйте `comboBox`, когда вам нужны:

* *Динамическая фильтрация*. Вам необходимо, чтобы пользователи могли фильтровать элементы в выпадающем списке по мере ввода текста. `comboBox` предоставляет встроенные возможности фильтрации.
* *Большие наборы данных*. Вы работаете с большим количеством элементов в выпадающем списке. `comboBox` обрабатывает пагинацию, позволяя отображать только ограниченное количество вариантов за раз, что повышает производительность.
* *Настройка отображения*. Вы хотите настроить внешний вид элементов в выпадающем списке, возможно, с дополнительной информацией или стилями. `comboBox` предлагает большую гибкость для настройки отображения элементов.

Простейший случай использования `comboBox` - это выбор значения перечисления для атрибута сущности. Например, сущность `User` имеет атрибут `onboardingStatus` типа `OnboardingStatus`, который является перечислением.

image::visual-components/components/combo-box-basic.png[align="center", width="268"]

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=data;userDc;layout;basics]
----
<1> `InstanceContainer` для сущности `User`.
<2> Встроенный план выборки экземпляра сущности, находящегося в контейнере.
<3> Привязка компонента к контейнеру данных и свойству. Атрибут `dataContainer` содержит ссылку на контейнер данных `userDc`, а атрибут `property` ссылается на атрибут сущности `onboardingStatus`.

// == Basics
//
// `comboBox` provides filtering of values as the user enters some text, and pagination of available values.
//
// Use `comboBox` if:
//
// * Users need to select a single item.
// * The list should be compact. It can be useful when the list of items is too long for xref:flow-ui:vc/components/radioButtonGroup.adoc[radioButtonGroup].
//
// By default, Jmix Studio generates `comboBox` when creating an entity detail view with an enum attribute. For example, the `User` entity has the `onboardingStatus` attribute of the `OnboardingStatus` type, which is an enumeration.
//
// image::visual-components/components/combo-box-basic.png[align="center", width="268"]
//
// [source,xml,indent=0]
// ----
// include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=data;userDc;layout;basics]
// ----
// <1> `InstanceContainer` for the `User` entity.
// <2> Inline fetch plan of the entity instance located in the container.
// <3> Binding the component to a data container and property. The `dataContainer` attribute contains a link to the `userDc` data container, and the `property` attribute refers to the `onboardingStatus` entity attribute.

[[custom-items]]
== Пользовательские элементы

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-custom-items" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

[[items-list]]
=== Список элементов

Вы можете задать список элементов `comboBox` с помощью метода `setItems()`.

Сначала объявите компонент в XML-дескрипторе:

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=data;stepDc;layout;custom-options]
----

Затем инжектируйте компонент в контроллер и задайте список элементов в методе `onInit()`:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=durationComboBox;onInit;setItems]
----

В выпадающем списке компонента будут отображаться значения `1`, `2`, `3`, `4` и `5`. Выбранное значение будет помещено в атрибут `duration` сущности, находящейся в контейнере данных `stepDc`.

[[items-map]]
=== Список элементов с описаниями

Метод `ComponentUtils.setItemsMap()` позволяет явно задать строковые описания для каждого значения элемента.

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=setItemsMap;onInit]
----

[[items-enum]]
=== Список значений перечисления

Вы можете использовать декларативный или программный подход для установки значений перечисления как элементов `comboBox`.

Атрибут `itemsEnum` определяет класс перечисления для создания списка элементов. В выпадающем списке будут отображаться локализованные имена значений перечисления; значение компонента будет являться значением перечисления.

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=itemsEnum]
----

Пример ниже использует программный подход.

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=setItemsEnum;onInit]
----

[[custom-filtering]]
== Пользовательская фильтрация

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-custom-filtering" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

По умолчанию `comboBox` выполняет нечувствительное к регистру сопоставление подстрок для фильтрации. Это означает, что он будет показывать любые элементы, где введенный текст встречается где-либо в названии элемента, независимо от регистра.

Вы также можете настроить фильтрацию. Чтобы установить собственный фильтр для `comboBox`, используйте метод `setItems()`.

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=setFiltering;onInit]
----

[[custom-value-entry]]
== Обработка пользовательского ввода

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-user-input" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`comboBox` позволяет вам настроить его для принятия пользовательских значений, отсутствующих в списке элементов.

Когда атрибут `allowCustomValue` установлен в `true`, пользователи могут вводить произвольные строковые значения, не совпадающие с существующими элементами. Это приводит к событию <<CustomValueSetEvent,CustomValueSetEvent>>.

NOTE: `comboBox` автоматически не обрабатывает строку с пользовательским значением. Используйте событие `CustomValueSetEvent`, чтобы определить, как следует обработать введенное пользователем значение.

Этот пример демонстрирует возможность добавления новых значений в список элементов, делая их доступными для будущего выбора:

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=allowCustomValue]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=colorComboBox;onInit;setColorItems;CustomValueSetEvent]
----

[[lazy-loading]]
== Получение элементов списка
//Lazy Loading
++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-items-query" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

`comboBox` может загружать элементы по частям в ответ на действия пользователя.

Например, когда пользователь вводит `foo`, компонент загружает из базы данных не более 50 элементов, содержащих `foo` в названии, и показывает их в выпадающем списке. Когда пользователь прокручивает список вниз, компонент извлекает следующую группу из 50 элементов с тем же запросом и добавляет их в список.

[[itemsQuery]]
=== Декларативная конфигурация

Для реализации этого поведения определите вложенный элемент `itemsQuery`.

Элемент `itemsQuery` должен содержать текст запроса JPQL во вложенном элементе `query` и несколько дополнительных атрибутов, определяющих, что и как загружать данные:

* `escapeValueForLike` - включает поиск значений, содержащих специальные символы: `%,` `\`, и так далее. Значение по умолчанию - `false`.
* `searchStringFormat` - строка Groovy. C её помощью вы можете использовать любые допустимые строковые выражения Groovy.

Пример `itemsQuery` в `comboBox`:

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=itemsQuery]
----
<1> Атрибут `pageSize` определяет размер пакета при загрузке данных из базы данных. По умолчанию он равен 50.
<2> Как вы можете видеть, `itemsQuery` в `comboBox` не требует атрибутов `class` и `fetchPlan`, поскольку предполагается, что запрос возвращает список скалярных значений (обратите внимание на `e.name` в результирующем наборе). Для работы с сущностями используйте компонент xref:vc/components/entityComboBox.adoc[entityComboBox].

[[itemsFetchCallback-handler]]
=== Программная конфигурация

Извлечение элементов также может быть определено программно с помощью обработчика `itemsFetchCallback`. Например:

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=load-users;onInit;itemsFetchCallback]
----

В этом примере данные извлекаются с помощью xref:data-access:data-manager.adoc[DataManager], но вы можете использовать этот подход для загрузки из собственного сервиса.

[[customizing-item-labels]]
== Настройка отображения элементов

`itemLabelGenerator` позволяет вам настроить отображение элементов в выпадающем списке. Это дает вам контроль над текстом, который видят пользователи, позволяя представлять информацию более удобным для пользователя или контекстно-специфичным образом.

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=itemLabelGenerator]
----

[[rendering-items]]
== Рендеринг элементов
//Custom Item Presentation
++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-custom-renderer" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Фреймворк предоставляет гибкость в настройке отображения элементов. Вы можете использовать либо метод `setRenderer()`, либо аннотацию `@Supply`, чтобы добиться этого.

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=render-combo-box]
----

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/combobox/ComboBoxView.java[tags=renderer]
----

[[overlay]]
== Оверлей

Оверлей - это полупрозрачный или непрозрачный слой, который используется для создания выпадающего списка элементов.

Атрибут `overlayClass` позволяет вам добавлять пользовательские CSS-классы к элементу оверлея.

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=overlayClass]
----

Определите свой собственный стиль в вашем CSS-файле:

[source,css,indent=0]
----
include::example$/onboarding/frontend/themes/onboarding/onboarding.css[tags=overlay]
----

[[theme-variants]]
== Варианты оформления

++++
<div class="jmix-ui-live-demo-container">
    <a href="https://demo.jmix.ru/ui-samples/sample/combobox-theme-variant" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a>
</div>
++++

Используйте атрибут xref:vc/common-attributes.adoc#themeNames[themeNames] для настройки выравнивания текста, размещения подсказки и размера компонента.

[[alignment]]
*Выравнивание*

Выберите один из трёх вариантов выравнивания: `align-left` (по умолчанию), `align-right` (по правому краю), `align-center` (по центру).

image::visual-components/components/combo-box-alignment.png[align="center", width="627"]

.XML code
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=themeNames-align]
----
====

[[helper-text-position]]
*Позиция подсказки*

Установив `helper-above-field`, вы переместите подсказку с её стандартного положения под полем на позицию над ним.

image::visual-components/components/combo-box-helper-above-field.png[align="center", width="414"]

.XML code
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=themeNames-helper-above-field]
----
====

[[size]]
*Размер*

Доступны два варианта размера: размер по умолчанию и `small`.

image::visual-components/components/combo-box-size.png[align="center", width="389"]

.XML code
[%collapsible]
====
[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/combobox/combo-box-view.xml[tags=themeNames-size]
----
====

[[validation]]
== Валидация

Чтобы проверить значения, введенные в компонент `comboBox`, вы можете использовать xref:vc/miscellaneous/validator.adoc[валидатор] в элементе `validators`.

Доступны следующие предопределенные валидаторы для `comboBox`:

[cols="1h,6", grid=none]
|===
|XML-элемент
|`validators`
|Предопределенные валидаторы
|xref:vc/miscellaneous/validator.adoc#custom-validator[custom] - xref:vc/miscellaneous/validator.adoc#DecimalMaxValidator[decimalMax] - xref:vc/miscellaneous/validator.adoc#DecimalMinValidator[decimalMin] - xref:vc/miscellaneous/validator.adoc#DigitsValidator[digits] - xref:vc/miscellaneous/validator.adoc#DoubleMaxValidator[doubleMax] - xref:vc/miscellaneous/validator.adoc#DoubleMinValidator[doubleMin] - xref:vc/miscellaneous/validator.adoc#EmailValidator[email] - xref:vc/miscellaneous/validator.adoc#MaxValidator[max] - xref:vc/miscellaneous/validator.adoc#MinValidator[min] - xref:vc/miscellaneous/validator.adoc#NegativeOrZeroValidator[negativeOrZero] - xref:vc/miscellaneous/validator.adoc#NegativeValidator[negative] - xref:vc/miscellaneous/validator.adoc#NotBlankValidator[notBlank] - xref:vc/miscellaneous/validator.adoc#NotEmptyValidator[notEmpty] - xref:vc/miscellaneous/validator.adoc#NotNullValidator[notNull] - xref:vc/miscellaneous/validator.adoc#PositiveOrZeroValidator[positiveOrZero] - xref:vc/miscellaneous/validator.adoc#PositiveValidator[positive] - xref:vc/miscellaneous/validator.adoc#RegexpValidator[regexp] - xref:vc/miscellaneous/validator.adoc#SizeValidator[size]
|===

== Атрибуты

В Jmix есть множество xref:vc/common-attributes.adoc[общих атрибутов], которые выполняют одну и ту же функцию для всех компонентов.

Ниже приведены атрибуты, специфичные для `comboBox`:

[cols="1h,5,1", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|*Значение по умолчанию*
|[[allowCustomValue]]allowCustomValue
|Если атрибут `allowCustomValue` установлен в `true`, пользователь может вводить строковые значения, которые не соответствуют ни одному из существующих названий элементов, что вызовет событие <<CustomValueSetEvent,CustomValueSetEvent>>. Смотрите <<custom-value-entry, Ввод пользовательских значений>>.
|`false`
|[[autoOpen]]autoOpen
|Если атрибут `autoOpen` установлен в `true`, выпадающий список `comboBox` автоматически открывается при фокусировке поля с помощью мыши или сенсорного экрана, а также при вводе пользователем в поле. Установите в `false`, чтобы отключить это поведение.
|`true`
|[[itemsEnum]]itemsEnum
|Атрибут `itemsEnum` определяет класс перечисления для создания списка элементов. Смотрите <<items-enum, Список значений перечисления>>.
|
|[[overlayClass]]overlayClass
|Определяет список CSS-классов, разделенных пробелами, для установки на элемент оверлея. Смотрите <<overlay, Оверлей>>.
|
|[[pageSize]]pageSize
|Устанавливает максимальное количество элементов, отправляемых за один запрос, которое должно быть больше нуля. Смотрите <<itemsQuery,Получение элементов списка>>.
|`50`
|===

== Обработчики

В Jmix существует множество xref:vc/common-handlers.adoc[общих обработчиков], которые конфигурируются одинаково для всех компонентов.

Ниже приведены обработчики, специфичные для `comboBox`.

include::../handler-generation-tip.adoc[]

[cols="1h,6", grid=rows, frame=none]
|===
|*Название*
|*Описание*
|[[CustomValueSetEvent]]CustomValueSetEvent
|Событие `com.vaadin.flow.component.combobox.ComboBoxBase.CustomValueSetEvent` срабатывает, когда пользователь вводит непустое значение, которое не совпадает ни с одним из существующих элементов. Чтобы разрешить ввод пользовательских значений, установите атрибут <<allowCustomValue,allowCustomValue>> в `true`.
|[[itemLabelGenerator]]itemLabelGenerator
|`com.vaadin.flow.component.ItemLabelGenerator` можно использовать для настройки строки, отображаемой пользователю для элемента. Смотрите <<customizing-item-labels,Настройка отображения элементов>>.
|[[itemsFetchCallback]]itemsFetchCallback
|Этот обработчик извлекает данные только по мере необходимости. Смотрите <<itemsFetchCallback-handler,Получение элементов списка>>.
|[[renderer]]renderer
|Устанавливает `Renderer`, ответственный за отрисовку отдельных элементов в списке возможных вариантов `comboBox`. Это не влияет на то, как отображается выбранный элемент - это можно настроить с помощью <<itemLabelGenerator,ItemLabelGenerator>>. Смотрите <<rendering-items, Рендеринг элементов>>.
|===

== Смотрите также

Смотрите https://vaadin.com/docs/latest/components/combo-box[документацию Vaadin^] для получения дополнительной информации.