= Validator 验证器

`Validator - 验证器` 用来检查可视化组件中输入的值。

NOTE: 需要区分验证和输入检查的不同，输入检查是说：假设一个文本组件（比如，xref:vc/components/textField.adoc[textField]）的数据类型设置的不是字符串（这种情况可能出现在绑定实体属性或者手动设置控件的 xref:vc/common-attributes.adoc#datatype[datatype]），那么即使没有验证器，这个组件也会阻止用户输入不符合它定义的数据类型的值。当这个组件失去焦点时或者用户按了回车，会显示验证错误信息。

框架包含了一组验证器实现，可以直接在项目中使用。

通常，在视图的 XML 中，组件的验证器可以通过内部的 `validators` 元素定义。

[TIP]
====
如需在 Jmix Studio 中添加内部的 `validators` 元素，可以在视图 XML 或者 *Jmix UI* 结构面板中选择组件或者其内部元素，然后点击 *Jmix UI* 组件面板的 *Add* 按钮。

下面是给 xref:vc/components/textField.adoc[textField] 组件添加验证器的例子：

image::visual-components/add-validator.png[align="center",width="632"]
====

为组件添加验证器时，可以指定错误消息。如果未指定，则使用默认的错误消息。后面的内容中，针对每个验证器我们都介绍了框架中使用的默认消息键值。可以在项目中定义相同的键值进行覆盖。

有些验证器的错误消息中可以带参数（例如，`++${value}++`）。这些参数会考虑用户的 locale 配置进行格式化。

标准的验证器都使用 `Prototype Bean` 定义，如果希望在 Java 代码中创建，需要使用 `ApplicationContext` 或 `ObjectProvider`，参考下面的示例。

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=validator]
----

[[DecimalMaxValidator]]
== DecimalMaxValidator

检查值小于等于指定的最大值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer` 以及使用当前 locale 表示 `BigDecimal` 的 `String` 类型。

支持下列属性：

* `value` - 最大值（必需）；
* `inclusive` - 当设置成 `true` 时，值应当小于或等于指定的最大值。设置成 `false` 时，值应当小于指定的最大值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 和 `$max` 参数。

默认消息键值：

* `validation.constraints.decimalMaxInclusive`；
* `validation.constraints.decimalMax`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=decimalMax]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addDecimalMaxValidator]
----

[[DecimalMinValidator]]
== DecimalMinValidator

检查值大于等于指定的最小值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer` 以及使用当前 locale 表示 `BigDecimal` 的 `String` 类型。

支持下列属性：

* `value` - 最小值（必需）；
* `inclusive` - 当设置成 `true` 时，值应当大于或等于指定的最小值。设置成 `false` 时，值应当大于指定的最小值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 和 `$min` 参数。

默认消息键值：

* `validation.constraints.decimalMinInclusive`；
* `validation.constraints.decimalMin`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=decimalMin]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addDecimalMinValidator]
----

[[DigitsValidator]]
== DigitsValidator

检查值是一个指定范围内的数字。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer` 以及使用当前 locale 表示 `BigDecimal` 的 `String` 类型。

支持下列属性：

* `integer` - 整数部分数字的个数（必需）；
* `fraction` - 小数部分数字的个数（必需）；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value`、`$integer` 和 `$fraction` 参数。

默认消息键值：

* `validation.constraints.digits`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=digits]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addDigitsValidator]
----

[[DoubleMaxValidator]]
== DoubleMaxValidator

检查值是否小于或等于指定的最大值。支持的类型：`Double` 以及使用当前 locale 表示 `Double` 值的 `String` 类型。

支持下列属性：

* `value` - 最大值（必需）；
* `inclusive` - 当设置成 `true` 时，值应当小于或等于指定的最大值。设置成 `false` 时，值应当小于指定的最大值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 和 `$max` 参数。

默认消息键值：

* `validation.constraints.decimalMaxInclusive`；
* `validation.constraints.decimalMax`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=doubleMax]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addDoubleMaxValidator]
----

[[DoubleMinValidator]]
== DoubleMinValidator

检查值大于等于指定的最小值。支持的类型：`Double` 以及使用当前 locale 表示 `Double` 值的 `String` 类型。

支持下列属性：

* `value` - 最小值（必需）;
* `inclusive` - 当设置成 `true` 时，值应当大于或等于指定的最小值。设置成 `false` 时，值应当大于指定的最小值。默认值是 `true`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 和 `$min` 参数。

默认消息键值：

* `validation.constraints.decimalMinInclusive`；
* `validation.constraints.decimalMin`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=doubleMin]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addDoubleMinValidator]
----

[[EmailValidator]]
== EmailValidator

检查 `String` 类型的值是否是电子邮件地址或者包含多个用英文分号、逗号分隔的电子邮件地址。支持类型：`String`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.invalidEmail`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=email]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addEmailValidator]
----

[[FutureOrPresentValidator]]
== FutureOrPresentValidator

检查日期或时间是否是将来时间或者当前时间。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置成 `true` 时，验证器使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.futureOrPresent`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=futureOrPresent]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addFutureOrPresentValidator]
----

[[FutureValidator]]
== FutureValidator

检查日期或时间是否是将来时间。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置成 `true` 时，验证器使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.future`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=future]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addFutureValidator]
----

[[MaxValidator]]
== MaxValidator

检查值是否小于或等于指定的最大值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`。

支持下列属性：

* `value` - 最大值（必需）；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 和 `$max` 参数。

默认消息键值：

* `validation.constraints.max`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=max]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addMaxValidator]
----

[[MinValidator]]
== MinValidator

检查值大于等于指定的最小值。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`。

支持下列属性：

* `value` - 最小值（必需）;
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 和 `$min` 参数。 

默认消息键值：

* `validation.constraints.min`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=min]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addMinValidator]
----

[[NegativeOrZeroValidator]]
== NegativeOrZeroValidator

检查值小于等于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 参数。

默认消息键值：

* `validation.constraints.negativeOrZero`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=negativeOrZero]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addNegativeOrZeroValidator]
----

[[NegativeValidator]]
== NegativeValidator

检查值严格小于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 参数。

默认消息键值：

* `validation.constraints.negative`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=negative]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addNegativeValidator]
----

[[NotBlankValidator]]
== NotBlankValidator

检查值至少包含一个非空字符。支持的类型：`String`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.notBlank`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=notBlank]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addNotBlankValidator]
----

[[NotEmptyValidator]]
== NotEmptyValidator

检查值不是 null 也非空。支持的类型：`Collection` 和 `String`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 参数，只对 `String` 类型有效。

默认消息键值：

* `validation.constraints.notEmpty`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=notEmpty]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addNotEmptyValidator]
----

[[NotNullValidator]]
== NotNullValidator

检查值不是 null。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.notNull`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=notNull]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addNotNullValidator]
----

[[PastOrPresentValidator]]
== PastOrPresentValidator

检查日期或时间是过去时间或者当前时间。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置为 `true` 时，验证器使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.pastOrPresent`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=pastOrPresent]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addPastOrPresentValidator]
----

[[PastValidator]]
== PastValidator

检查日期或时间是过去时间。支持的类型：`java.util.Date`、`LocalDate`、`LocalDateTime`、`LocalTime`、`OffsetDateTime`、`OffsetTime`。

支持下列属性：

* `checkSeconds` - 当设置成 `true` 时，验证器使用秒和毫秒比较日期或者时间。默认值是 `false`；
* `message` - 自定义的消息，在验证失败时展示。

默认消息键值：

* `validation.constraints.past`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=past]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addPastValidator]
----

[[PositiveOrZeroValidator]]
== PositiveOrZeroValidator

检查值大于等于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 参数。

默认消息键值：

* `validation.constraints.positiveOrZero`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=positiveOrZero]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addPositiveOrZeroValidator]
----

[[PositiveValidator]]
== PositiveValidator

检查值严格大于 0。支持的类型：`BigDecimal`、`BigInteger`、`Long`、`Integer`、`Double`、`Float`。

支持下列属性：

* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 参数。

默认消息键值：

* `validation.constraints.positive`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=positive]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addPositiveValidator]
----

[[RegexpValidator]]
== RegexpValidator

检查 `String` 的值是否能匹配提供的正则表达式。支持的类型：`String`。

支持下列属性：

* `regexp` - 一个用于匹配的正则表达式（必需）；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value` 参数。

默认消息键值：

* `validation.constraints.regexp`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=regexp]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addRegexpValidator]
----

[[SizeValidator]]
== SizeValidator

检查值在一定范围内。支持的类型：`Collection` 和 `String`。

支持下列属性：

* `min` - 最小值（含），不能小于 `0`。默认值是 `0`；
* `max` - 最大值（含），不能小于 `0`。默认值是 `Integer.MAX_VALUE`；
* `message` - 自定义的消息，在验证失败时展示。该消息可以包含 `$value`（只对 `String` 类型有效），`$min`、`$max` 参数。 

默认消息键值：

* `validation.constraints.collectionSizeRange`；
* `validation.constraints.sizeRange`。

XML 描述中用法：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=size]
----

Java 代码用法：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addSizeValidator]
----

[[custom-validator]]
== 创建自定义验证器

可以自定义一个 prototype bean 的验证器 Java 类。需实现 `Validator` 接口。

示例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/validators/ZipValidator.java[tags=ZipValidator]
----

在视图 XML 中，自定义验证器可以在内部的 `custom` 元素定义，示例：

[source,xml,indent=0]
----
include::example$/onboarding/src/main/resources/com/company/onboarding/view/component/validator/validator-view.xml[tags=zipField]
----

验证器也可以用过 lambda 函数编程式定义，示例：

[source,java,indent=0]
----
include::example$/onboarding/src/main/java/com/company/onboarding/view/component/validator/ValidatorView.java[tags=addCustomValidator]
----
